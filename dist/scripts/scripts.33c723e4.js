"use strict";angular.module("webtorrentClientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","Services","Resources","AuthServices","Torrents","luegg.directives","LocalForageModule","LocalStorageModule","ngLodash","angular-clipboard"]).constant("ENDPOINT_URI","https://webtorrent-chat-server.herokuapp.com/").constant("TESTING_MODE",!0).constant("USER_ROLES",{all:"*",admin:"admin",user:"user",guest:"guest"}).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).config(["$routeProvider","localStorageServiceProvider","USER_ROLES",function(a,b,c){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",data:{authorizedRoles:[c.all]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about",data:{authorizedRoles:[c.all]}}).when("/messenger",{templateUrl:"views/messenger.html",controller:"MessengerCtrl",controllerAs:"messenger",data:{authorizedRoles:[c.admin,c.user]}}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",data:{authorizedRoles:[c.all]}}).otherwise({redirectTo:"/"}),b.setPrefix("webtorrentClientApp").setStorageType("localStorage").setNotify(!0,!0)}]).run(["$rootScope","AUTH_EVENTS","AuthService",function(a,b,c){a.$on("$routeChangeStart",function(d,e){var f=e&&e.data?e.data.authorizedRoles:null;return f?void(-1!==f.indexOf("*")||c.isAuthorized(f)||(d.preventDefault(),c.isAuthenticated()?a.$broadcast(b.notAuthorized):a.$broadcast(b.notAuthenticated))):void d.preventDefault()})}]),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){const c={iceServers:[{urls:"stun:stun.l.google.com:19305"}]},d={rtcConfig:c};var e=angular.module("Torrents",[]);e.factory("TorrentFactory",["$localForage","$timeout","$interval","DhtFactory","MessagesFactory","lodash","TESTING_MODE",function(c,e,f,g,h,i,j){function k(a){g.get({dhtId:a},function(a){R=a.infohash},J)}function l(a,b){i.forEachRight(a,function(a){a&&i.forEach(a,function(a){var c=a.message.content.infoHashes,d=h.getLevelFromLength(c.length),e=h.getMessagesByInfoHash(b,c);h.changeLevelForMessages(b,0,d,e);var f=i.sortBy(e,"infoHash"),g=i.map(f,G),j=F(a.message,"control");g.push(j),O.seed(g,{name:"control"+d})})})}function m(a){i.forEach(a,function(a){O.seed(G(a.message))})}function n(a){var b=[];return i.forEach(a,function(c){var d=i.filter(a,function(a){return a.infoHash!==c.infoHash&&a.message.content.infoHashes.length<c.message.content.infoHashes.length&&i.intersection(a.message.content.infoHashes,c.message.content.infoHashes).length>0});d.length>0&&b.push(d)}),b}function o(a){var b=i.chain(a).flattenDeep().thru(n).map("infoHash").value();h.removeControlMessagesByInfoHash(b)}function p(){o(h.control),o(h.otherControl),l(h.control,h.my),m(h.my[0]);var a=[[],[],[],[],[],[],[]];i.forEach(h.otherControl,function(b){var c=h.getLevelFromLength(b.message.content.infoHashes.length);a[c].push(b)});var b=[[],[],[],[],[],[],[]];b[0]=i.concat(b[0],h.other),l(a,b),m(b[0])}function q(a){O=new N({tracker:d}),S=a,k(a),h.init(a).then(p)}function r(a){f(function(){i.forEach(a,function(a){O.get(a)&&O.remove(a,K)})},5e3,1,!0)}function s(a,b){var c=i.find(a,i.matchesProperty("infoHash",b));return!!c}function t(a){return"magnet:?xt=urn:btih:"+a+"&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.fastcast.nz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com"}function u(a){if(40===a.length){var b=t(a),c=O.get(b);c||O.add(b,z)}}function v(a){a&&!s(h.getMessagesAndControl(),a)&&(console.log("adding previous "+a),u(a))}function w(a,b,c){s(h.getMessagesAndControl(),a)||(h.add(a,b,S,c),console.log(i.now()+" should apply "+b.content),L(b.content))}function x(a,b,c){b.getBuffer(function(d,e){var f=H(e);"text"===b.name?w(f.infoHash,f.message,c):"control"===b.name&&(r(f.content.infoHashes),r(f.content.controlMessages),h.removeControlMessagesByInfoHash(f.content.controlMessages),h.add(a.infoHash,f,S),v(f.previousInfoHash))})}function y(a,b){b.getBuffer(function(b,c){var d=H(c);w(a.infoHash,d),v(d.previousInfoHash)})}function z(a){if(a.name.startsWith("control")){var b=i.parseInt(a.name.slice(7));a.files.forEach(function(c){x(a,c,b)})}else"text"===a.name&&a.files.forEach(function(b){y(a,b)})}function A(a){g.get({dhtId:a},function(a){var b=a,c=i.find(Q,{_id:b._id});(!c||c.infohash!==b.infohash&&!s(h.getMessagesAndControl(),b.infohash))&&(u(b.infohash),i.pull(Q,c),Q.push(b))},J)}function B(a){D(S,a),T.length>0?I(T.shift()):U=!1}function C(a){var b=h.my[a].length,c=h.numberOfMessagesForLevel(a);if(!(b>=c))return!0;var d=i.sortBy(h.my[a],"infoHash"),e=i.map(d,G),f=i.minBy(d,"message.timestamp").message.previousInfoHash,g=i.map(d,"infoHash"),j=i.sortBy(h.control[a],"infoHash"),k=i.map(j,"infoHash"),l={infoHashes:g,controlMessages:k},m=E(l,S,f,"control"),n=F(m,"control");e.push(n),r(g),r(k),h.moveLevelUp(a);var o=a+1;return O.seed(e,{name:"control"+o},function(b){R=b.infoHash,h.add(b.infoHash,m,S),h.removeControlMessagesFromLevel(a);var c=C(a+1);c&&B(b.infoHash)}),!1}function D(a,b){var c={_id:a,infohash:b};g.update({},c,null,function(a){console.error(a)})}function E(a,b,c,d){return{type:d||"text",content:a,timestamp:i.now(),sender:b,previousInfoHash:c}}function F(a,c){var d=c||"text",e=new b(angular.toJson(a));return e.name=d,e}function G(a){return F(a,"text")}function H(a){return angular.fromJson(a.toString("utf8"))}function I(a){var b=E(a,S,R,null),c=G(b);O.seed(c,function(a){R=a.infoHash,h.add(a.infoHash,b,S);var c=C(0);c&&B(a.infoHash)})}function J(a){console.error("dht error: "+a)}function K(a){a&&console.error(a)}function L(a){j&&a.startsWith("AUTO_REPLY_REQUEST")&&M.sendMessage("reply for "+a)}var M={},N=a("webtorrent"),O=new N({tracker:d});const P=a("events").EventEmitter;P.defaultMaxListeners=1e3;var Q=[],R="",S="";M.init=function(a){O&&!O.destroyed?O.destroy(function(b){return b?console.error(b):void q(a)}):q(a)},M.checkMessages=function(a){i.forEach(a,function(a){i.forEach(a,function(a){A(a)})})};var T=[],U=!1;return M.sendMessage=function(a){U?T.push(a):(U=!0,I(a))},M.exit=function(){O.destroy()},M.getAllTorrents=function(){return O.torrents},M.getLastInfoHashes=function(){return Q},O.on("error",function(a){console.error("WEBTORRENT ERROR: "+a.message)}),M}])}).call(this,a("buffer").Buffer)},{buffer:39,events:70,webtorrent:223}],2:[function(a,b,c){var d=/^\[?([^\]]+)\]?:(\d+)$/,e={},f=0;b.exports=function(a){if(1e5===f&&b.exports.reset(),!e[a]){var c=d.exec(a);if(!c)throw new Error("invalid addr: "+a);e[a]=[c[1],Number(c[2])],f+=1}return e[a]},b.exports.reset=function(){e={},f=0}},{}],3:[function(a,b,c){function d(a){var b=a.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===a[b-2]?2:"="===a[b-1]?1:0}function e(a){return 3*a.length/4-d(a)}function f(a){var b,c,e,f,g,h,i=a.length;g=d(a),h=new l(3*i/4-g),e=g>0?i-4:i;var j=0;for(b=0,c=0;e>b;b+=4,c+=3)f=k[a.charCodeAt(b)]<<18|k[a.charCodeAt(b+1)]<<12|k[a.charCodeAt(b+2)]<<6|k[a.charCodeAt(b+3)],h[j++]=f>>16&255,h[j++]=f>>8&255,h[j++]=255&f;return 2===g?(f=k[a.charCodeAt(b)]<<2|k[a.charCodeAt(b+1)]>>4,h[j++]=255&f):1===g&&(f=k[a.charCodeAt(b)]<<10|k[a.charCodeAt(b+1)]<<4|k[a.charCodeAt(b+2)]>>2,h[j++]=f>>8&255,h[j++]=255&f),h}function g(a){return j[a>>18&63]+j[a>>12&63]+j[a>>6&63]+j[63&a]}function h(a,b,c){for(var d,e=[],f=b;c>f;f+=3)d=(a[f]<<16)+(a[f+1]<<8)+a[f+2],e.push(g(d));return e.join("")}function i(a){for(var b,c=a.length,d=c%3,e="",f=[],g=16383,i=0,k=c-d;k>i;i+=g)f.push(h(a,i,i+g>k?k:i+g));return 1===d?(b=a[c-1],e+=j[b>>2],e+=j[b<<4&63],e+="=="):2===d&&(b=(a[c-2]<<8)+a[c-1],e+=j[b>>10],e+=j[b>>4&63],e+=j[b<<2&63],e+="="),f.push(e),f.join("")}c.byteLength=e,c.toByteArray=f,c.fromByteArray=i;for(var j=[],k=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=m.length;o>n;++n)j[n]=m[n],k[m.charCodeAt(n)]=n;k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63},{}],4:[function(a,b,c){(function(a){function c(a,b,c){for(var d=0,e=1,f=b;c>f;f++){var g=a[f];if(58>g&&g>=48)d=10*d+(g-48);else if(f!==b||43!==g){if(f!==b||45!==g){if(46===g)break;throw new Error("not a number: buffer["+f+"] = "+g)}e=-1}}return d*e}function d(b,c,e,f){return null==b||0===b.length?null:("number"!=typeof c&&null==f&&(f=c,c=void 0),"number"!=typeof e&&null==f&&(f=e,e=void 0),d.position=0,d.encoding=f||null,d.data=a.isBuffer(b)?b.slice(c,e):new a(b),d.bytes=d.data.length,d.next())}d.bytes=0,d.position=0,d.data=null,d.encoding=null,d.next=function(){switch(d.data[d.position]){case 100:return d.dictionary();case 108:return d.list();case 105:return d.integer();default:return d.buffer()}},d.find=function(a){for(var b=d.position,c=d.data.length,e=d.data;c>b;){if(e[b]===a)return b;b++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(a)+'" [0x'+a.toString(16)+"]")},d.dictionary=function(){d.position++;for(var a={};101!==d.data[d.position];)a[d.buffer()]=d.next();return d.position++,a},d.list=function(){d.position++;for(var a=[];101!==d.data[d.position];)a.push(d.next());return d.position++,a},d.integer=function(){var a=d.find(101),b=c(d.data,d.position+1,a);return d.position+=a+1-d.position,b},d.buffer=function(){var a=d.find(58),b=c(d.data,d.position,a),e=++a+b;return d.position=e,d.encoding?d.data.toString(d.encoding,a,e):d.data.slice(a,e)},b.exports=d}).call(this,a("buffer").Buffer)},{buffer:39}],5:[function(a,b,c){(function(a){function c(b,d,e){var f=[],g=null;return c._encode(f,b),g=a.concat(f),c.bytes=g.length,a.isBuffer(d)?(g.copy(d,e),d):g}c.bytes=-1,c._floatConversionDetected=!1,c._encode=function(b,d){if(a.isBuffer(d))return b.push(new a(d.length+":")),void b.push(d);if(null!=d)switch(typeof d){case"string":c.buffer(b,d);break;case"number":c.number(b,d);break;case"object":d.constructor===Array?c.list(b,d):c.dict(b,d);break;case"boolean":c.number(b,d?1:0)}};var d=new a("e"),e=new a("d"),f=new a("l");c.buffer=function(b,c){b.push(new a(a.byteLength(c)+":"+c))},c.number=function(b,d){var e=2147483648,f=d/e<<0,g=d%e<<0,h=f*e+g;b.push(new a("i"+h+"e")),h===d||c._floatConversionDetected||(c._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+d+'":','Bencoding only defines support for integers, value was converted to "'+h+'"'),console.trace())},c.dict=function(a,b){a.push(e);for(var f,g=0,h=Object.keys(b).sort(),i=h.length;i>g;g++)f=h[g],null!=b[f]&&(c.buffer(a,f),c._encode(a,b[f]));a.push(d)},c.list=function(a,b){var e=0,g=b.length;for(a.push(f);g>e;e++)null!=b[e]&&c._encode(a,b[e]);a.push(d)},b.exports=c}).call(this,a("buffer").Buffer)},{buffer:39}],6:[function(a,b,c){var d=b.exports;d.encode=a("./encode"),d.decode=a("./decode"),d.byteLength=d.encodingLength=function(a){return d.encode(a).length}},{"./decode":4,"./encode":5}],7:[function(a,b,c){b.exports=function(a,b,c,d,e){var f,g;if(void 0===d)d=0;else if(d=0|d,0>d||d>=a.length)throw new RangeError("invalid lower bound");if(void 0===e)e=a.length-1;else if(e=0|e,d>e||e>=a.length)throw new RangeError("invalid upper bound");for(;e>=d;)if(f=d+(e-d>>1),g=+c(a[f],b,f,a),0>g)d=f+1;else{if(!(g>0))return f;e=f-1}return~d}},{}],8:[function(a,b,c){(function(a){function c(a,b){return this instanceof c?(0===arguments.length&&(a=0),this.grow=b&&(isFinite(b.grow)&&d(b.grow)||b.grow)||0,("number"==typeof a||void 0===a)&&(a=new e(d(a)),a.fill&&!a._isBuffer&&a.fill(0)),void(this.buffer=a)):new c(a,b)}function d(a){var b=a>>3;return a%8!==0&&b++,b}var e="undefined"!=typeof a?a:"undefined"!=typeof Int8Array?Int8Array:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=0};c.prototype.get=function(a){var b=a>>3;return b<this.buffer.length&&!!(this.buffer[b]&128>>a%8)},c.prototype.set=function(a,b){var c=a>>3;b||1===arguments.length?(this.buffer.length<c+1&&this._grow(Math.max(c+1,Math.min(2*this.buffer.length,this.grow))),this.buffer[c]|=128>>a%8):c<this.buffer.length&&(this.buffer[c]&=~(128>>a%8))},c.prototype._grow=function(a){if(this.buffer.length<a&&a<=this.grow){var b=new e(a);if(b.fill&&b.fill(0),this.buffer.copy)this.buffer.copy(b,0);else for(var c=0;c<this.buffer.length;c++)b[c]=this.buffer[c];this.buffer=b}},"undefined"!=typeof b&&(b.exports=c)}).call(this,a("buffer").Buffer)},{buffer:39}],9:[function(a,b,c){function d(a,b,c,d){this.piece=a,this.offset=b,this.length=c,this.callback=d}function e(){return this instanceof e?(p.Duplex.call(this),this._debugId=n(4).toString("hex"),this._debug("new wire"),this.peerId=null,this.peerIdBuffer=null,this.type=null,this.amChoking=!0,this.amInterested=!1,this.peerChoking=!0,this.peerInterested=!1,this.peerPieces=new i(0,{grow:q}),this.peerExtensions={},this.requests=[],this.peerRequests=[],this.extendedMapping={},this.peerExtendedMapping={},this.extendedHandshake={},this.peerExtendedHandshake={},this._ext={},this._nextExt=1,this.uploaded=0,this.downloaded=0,this.uploadSpeed=o(),this.downloadSpeed=o(),this._keepAliveInterval=null,this._timeout=null,this._timeoutMs=0,this.destroyed=!1,this._finished=!1,this._parserSize=0,this._parser=null,this._buffer=[],this._bufferSize=0,this.on("finish",this._onFinish),void this._parseHandshake()):new e}function f(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if(f.piece===b&&f.offset===c&&f.length===d)return g(a,e),f}return null}b.exports=e;var g=a("unordered-array-remove"),h=a("bencode"),i=a("bitfield"),j=a("safe-buffer").Buffer,k=a("debug")("bittorrent-protocol"),l=a("xtend"),m=a("inherits"),n=a("randombytes"),o=a("speedometer"),p=a("readable-stream"),q=4e5,r=55e3,s=j.from("BitTorrent protocol"),t=j.from([0,0,0,0]),u=j.from([0,0,0,1,0]),v=j.from([0,0,0,1,1]),w=j.from([0,0,0,1,2]),x=j.from([0,0,0,1,3]),y=[0,0,0,0,0,0,0,0],z=[0,0,0,3,9,0,0];m(e,p.Duplex),e.prototype.setKeepAlive=function(a){var b=this;b._debug("setKeepAlive %s",a),clearInterval(b._keepAliveInterval),a!==!1&&(b._keepAliveInterval=setInterval(function(){b.keepAlive()},r))},e.prototype.setTimeout=function(a,b){this._debug("setTimeout ms=%d unref=%s",a,b),this._clearTimeout(),this._timeoutMs=a,this._timeoutUnref=!!b,this._updateTimeout()},e.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this._debug("destroy"),this.emit("close"),this.end())},e.prototype.end=function(){this._debug("end"),this._onUninterested(),this._onChoke(),p.Duplex.prototype.end.apply(this,arguments)},e.prototype.use=function(a){function b(){}var c=a.prototype.name;if(!c)throw new Error('Extension class requires a "name" property on the prototype');this._debug("use extension.name=%s",c);var d=this._nextExt,e=new a(this);"function"!=typeof e.onHandshake&&(e.onHandshake=b),"function"!=typeof e.onExtendedHandshake&&(e.onExtendedHandshake=b),"function"!=typeof e.onMessage&&(e.onMessage=b),this.extendedMapping[d]=c,this._ext[c]=e,this[c]=e,this._nextExt+=1},e.prototype.keepAlive=function(){this._debug("keep-alive"),this._push(t)},e.prototype.handshake=function(a,b,c){var d,e;if("string"==typeof a?d=j.from(a,"hex"):(d=a,a=d.toString("hex")),"string"==typeof b?e=j.from(b,"hex"):(e=b,b=e.toString("hex")),20!==d.length||20!==e.length)throw new Error("infoHash and peerId MUST have length 20");this._debug("handshake i=%s p=%s exts=%o",a,b,c);var f=j.from(y);f[5]|=16,c&&c.dht&&(f[7]|=1),this._push(j.concat([s,f,d,e])),this._handshakeSent=!0,this.peerExtensions.extended&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()},e.prototype._sendExtendedHandshake=function(){var a=l(this.extendedHandshake);a.m={};for(var b in this.extendedMapping){var c=this.extendedMapping[b];a.m[c]=Number(b)}this.extended(0,h.encode(a)),this._extendedHandshakeSent=!0},e.prototype.choke=function(){if(!this.amChoking){for(this.amChoking=!0,this._debug("choke");this.peerRequests.length;)this.peerRequests.pop();this._push(u)}},e.prototype.unchoke=function(){this.amChoking&&(this.amChoking=!1,this._debug("unchoke"),this._push(v))},e.prototype.interested=function(){this.amInterested||(this.amInterested=!0,this._debug("interested"),this._push(w))},e.prototype.uninterested=function(){this.amInterested&&(this.amInterested=!1,this._debug("uninterested"),this._push(x))},e.prototype.have=function(a){this._debug("have %d",a),this._message(4,[a],null)},e.prototype.bitfield=function(a){this._debug("bitfield"),j.isBuffer(a)||(a=a.buffer),this._message(5,[],a)},e.prototype.request=function(a,b,c,e){return e||(e=function(){}),this._finished?e(new Error("wire is closed")):this.peerChoking?e(new Error("peer is choking")):(this._debug("request index=%d offset=%d length=%d",a,b,c),this.requests.push(new d(a,b,c,e)),this._updateTimeout(),void this._message(6,[a,b,c],null))},e.prototype.piece=function(a,b,c){this._debug("piece index=%d offset=%d",a,b),this.uploaded+=c.length,this.uploadSpeed(c.length),this.emit("upload",c.length),this._message(7,[a,b],c)},e.prototype.cancel=function(a,b,c){this._debug("cancel index=%d offset=%d length=%d",a,b,c),this._callback(f(this.requests,a,b,c),new Error("request was cancelled"),null),this._message(8,[a,b,c],null)},e.prototype.port=function(a){this._debug("port %d",a);var b=j.from(z);b.writeUInt16BE(a,5),this._push(b)},e.prototype.extended=function(a,b){if(this._debug("extended ext=%s",a),"string"==typeof a&&this.peerExtendedMapping[a]&&(a=this.peerExtendedMapping[a]),"number"!=typeof a)throw new Error("Unrecognized extension: "+a);var c=j.from([a]),d=j.isBuffer(b)?b:h.encode(b);this._message(20,[],j.concat([c,d]))},e.prototype._read=function(){},e.prototype._message=function(a,b,c){var d=c?c.length:0,e=j.allocUnsafe(5+4*b.length);e.writeUInt32BE(e.length+d-4,0),e[4]=a;for(var f=0;f<b.length;f++)e.writeUInt32BE(b[f],5+4*f);this._push(e),c&&this._push(c)},e.prototype._push=function(a){return this._finished?void 0:this.push(a)},e.prototype._onKeepAlive=function(){this._debug("got keep-alive"),this.emit("keep-alive")},e.prototype._onHandshake=function(a,b,c){var d=a.toString("hex"),e=b.toString("hex");this._debug("got handshake i=%s p=%s exts=%o",d,e,c),this.peerId=e,this.peerIdBuffer=b,this.peerExtensions=c,this.emit("handshake",d,e,c);var f;for(f in this._ext)this._ext[f].onHandshake(d,e,c);c.extended&&this._handshakeSent&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()},e.prototype._onChoke=function(){for(this.peerChoking=!0,this._debug("got choke"),this.emit("choke");this.requests.length;)this._callback(this.requests.pop(),new Error("peer is choking"),null)},e.prototype._onUnchoke=function(){this.peerChoking=!1,this._debug("got unchoke"),this.emit("unchoke")},e.prototype._onInterested=function(){this.peerInterested=!0,this._debug("got interested"),this.emit("interested")},e.prototype._onUninterested=function(){this.peerInterested=!1,this._debug("got uninterested"),this.emit("uninterested")},e.prototype._onHave=function(a){this.peerPieces.get(a)||(this._debug("got have %d",a),this.peerPieces.set(a,!0),this.emit("have",a))},e.prototype._onBitField=function(a){this.peerPieces=new i(a),this._debug("got bitfield"),this.emit("bitfield",this.peerPieces)},e.prototype._onRequest=function(a,b,c){var e=this;if(!e.amChoking){e._debug("got request index=%d offset=%d length=%d",a,b,c);var g=function(d,g){return h===f(e.peerRequests,a,b,c)?d?e._debug("error satisfying request index=%d offset=%d length=%d (%s)",a,b,c,d.message):void e.piece(a,b,g):void 0},h=new d(a,b,c,g);e.peerRequests.push(h),e.emit("request",a,b,c,g)}},e.prototype._onPiece=function(a,b,c){this._debug("got piece index=%d offset=%d",a,b),this._callback(f(this.requests,a,b,c.length),null,c),this.downloaded+=c.length,this.downloadSpeed(c.length),this.emit("download",c.length),this.emit("piece",a,b,c)},e.prototype._onCancel=function(a,b,c){this._debug("got cancel index=%d offset=%d length=%d",a,b,c),f(this.peerRequests,a,b,c),this.emit("cancel",a,b,c)},e.prototype._onPort=function(a){this._debug("got port %d",a),this.emit("port",a)},e.prototype._onExtended=function(a,b){if(0===a){var c;try{c=h.decode(b)}catch(d){this._debug("ignoring invalid extended handshake: %s",d.message||d)}if(!c)return;this.peerExtendedHandshake=c;var e;if("object"==typeof c.m)for(e in c.m)this.peerExtendedMapping[e]=Number(c.m[e].toString());for(e in this._ext)this.peerExtendedMapping[e]&&this._ext[e].onExtendedHandshake(this.peerExtendedHandshake);this._debug("got extended handshake"),this.emit("extended","handshake",this.peerExtendedHandshake)}else this.extendedMapping[a]&&(a=this.extendedMapping[a],this._ext[a]&&this._ext[a].onMessage(b)),this._debug("got extended message ext=%s",a),this.emit("extended",a,b)},e.prototype._onTimeout=function(){this._debug("request timed out"),this._callback(this.requests.shift(),new Error("request has timed out"),null),this.emit("timeout")},e.prototype._write=function(a,b,c){for(this._bufferSize+=a.length,this._buffer.push(a);this._bufferSize>=this._parserSize;){var d=1===this._buffer.length?this._buffer[0]:j.concat(this._buffer);this._bufferSize-=this._parserSize,this._buffer=this._bufferSize?[d.slice(this._parserSize)]:[],this._parser(d.slice(0,this._parserSize))}c(null)},e.prototype._callback=function(a,b,c){a&&(this._clearTimeout(),this.peerChoking||this._finished||this._updateTimeout(),a.callback(b,c))},e.prototype._clearTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null)},e.prototype._updateTimeout=function(){var a=this;a._timeoutMs&&a.requests.length&&!a._timeout&&(a._timeout=setTimeout(function(){a._onTimeout()},a._timeoutMs),a._timeoutUnref&&a._timeout.unref&&a._timeout.unref())},e.prototype._parse=function(a,b){this._parserSize=a,this._parser=b},e.prototype._onMessageLength=function(a){var b=a.readUInt32BE(0);b>0?this._parse(b,this._onMessage):(this._onKeepAlive(),this._parse(4,this._onMessageLength))},e.prototype._onMessage=function(a){switch(this._parse(4,this._onMessageLength),a[0]){case 0:return this._onChoke();case 1:return this._onUnchoke();case 2:return this._onInterested();case 3:return this._onUninterested();case 4:return this._onHave(a.readUInt32BE(1));case 5:return this._onBitField(a.slice(1));case 6:return this._onRequest(a.readUInt32BE(1),a.readUInt32BE(5),a.readUInt32BE(9));case 7:return this._onPiece(a.readUInt32BE(1),a.readUInt32BE(5),a.slice(9));case 8:return this._onCancel(a.readUInt32BE(1),a.readUInt32BE(5),a.readUInt32BE(9));case 9:return this._onPort(a.readUInt16BE(1));case 20:return this._onExtended(a.readUInt8(1),a.slice(2));default:return this._debug("got unknown message"),this.emit("unknownmessage",a)}},e.prototype._parseHandshake=function(){var a=this;a._parse(1,function(b){var c=b.readUInt8(0);a._parse(c+48,function(b){var d=b.slice(0,c);return"BitTorrent protocol"!==d.toString()?(a._debug("Error: wire not speaking BitTorrent protocol (%s)",d.toString()),void a.end()):(b=b.slice(c),a._onHandshake(b.slice(8,28),b.slice(28,48),{dht:!!(1&b[7]),extended:!!(16&b[5])}),void a._parse(4,a._onMessageLength))})})},e.prototype._onFinish=function(){for(this._finished=!0,this.push(null);this.read(););for(clearInterval(this._keepAliveInterval),this._parse(Number.MAX_VALUE,function(){});this.peerRequests.length;)this.peerRequests.pop();for(;this.requests.length;)this._callback(this.requests.pop(),new Error("wire was closed"),null)},e.prototype._debug=function(){var a=[].slice.call(arguments);a[0]="["+this._debugId+"] "+a[0],k.apply(null,a)}},{bencode:6,bitfield:8,debug:66,inherits:87,randombytes:147,"readable-stream":18,"safe-buffer":164,speedometer:190,"unordered-array-remove":215,xtend:243}],10:[function(a,b,c){var d={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==d.call(a)}},{}],11:[function(a,b,c){function d(a){return this instanceof d?(j.call(this,a),k.call(this,a),a&&a.readable===!1&&(this.readable=!1),a&&a.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",e)):new d(a)}function e(){this.allowHalfOpen||this._writableState.ended||h(f,this)}function f(a){a.end()}var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};b.exports=d;var h=a("process-nextick-args"),i=a("core-util-is");i.inherits=a("inherits");var j=a("./_stream_readable"),k=a("./_stream_writable");i.inherits(d,j);for(var l=g(k.prototype),m=0;m<l.length;m++){var n=l[m];d.prototype[n]||(d.prototype[n]=k.prototype[n])}},{"./_stream_readable":13,"./_stream_writable":15,"core-util-is":54,inherits:87,"process-nextick-args":140}],12:[function(a,b,c){function d(a){return this instanceof d?void e.call(this,a):new d(a)}b.exports=d;var e=a("./_stream_transform"),f=a("core-util-is");f.inherits=a("inherits"),f.inherits(d,e),d.prototype._transform=function(a,b,c){c(null,a)}},{"./_stream_transform":14,"core-util-is":54,inherits:87}],13:[function(a,b,c){(function(c){function d(a,b,c){return"function"==typeof a.prependListener?a.prependListener(b,c):void(a._events&&a._events[b]?E(a._events[b])?a._events[b].unshift(c):a._events[b]=[c,a._events[b]]:a.on(b,c))}function e(b,c){C=C||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof C&&(this.objectMode=this.objectMode||!!b.readableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.buffer=new N,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(M||(M=a("string_decoder/").StringDecoder),this.decoder=new M(b.encoding),this.encoding=b.encoding)}function f(b){return C=C||a("./_stream_duplex"),this instanceof f?(this._readableState=new e(b,this),this.readable=!0,b&&"function"==typeof b.read&&(this._read=b.read),void G.call(this)):new f(b)}function g(a,b,c,d,e){var f=k(b,c);if(f)a.emit("error",f);else if(null===c)b.reading=!1,l(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var g=new Error("stream.push() after EOF");a.emit("error",g)}else if(b.endEmitted&&e){var i=new Error("stream.unshift() after end event");a.emit("error",i)}else{var j;!b.decoder||e||d||(c=b.decoder.write(c),j=!b.objectMode&&0===c.length),e||(b.reading=!1),j||(b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&m(a))),o(a,b)}else e||(b.reading=!1);return h(b)}function h(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function i(a){return a>=P?a=P:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}function j(a,b){return 0>=a||0===b.length&&b.ended?0:b.objectMode?1:a!==a?b.flowing&&b.length?b.buffer.head.data.length:b.length:(a>b.highWaterMark&&(b.highWaterMark=i(a)),a<=b.length?a:b.ended?b.length:(b.needReadable=!0,0))}function k(a,b){var c=null;return H.isBuffer(b)||"string"==typeof b||null===b||void 0===b||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function l(a,b){if(!b.ended){if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,m(a)}}function m(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(L("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?D(n,a):n(a))}function n(a){L("emit readable"),a.emit("readable"),u(a)}function o(a,b){b.readingMore||(b.readingMore=!0,D(p,a,b))}function p(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(L("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function q(a){return function(){var b=a._readableState;L("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&F(a,"data")&&(b.flowing=!0,u(a))}}function r(a){L("readable nexttick read 0"),a.read(0)}function s(a,b){b.resumeScheduled||(b.resumeScheduled=!0,D(t,a,b))}function t(a,b){b.reading||(L("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),u(a),b.flowing&&!b.reading&&a.read(0)}function u(a){var b=a._readableState;for(L("flow",b.flowing);b.flowing&&null!==a.read(););}function v(a,b){if(0===b.length)return null;var c;return b.objectMode?c=b.buffer.shift():!a||a>=b.length?(c=b.decoder?b.buffer.join(""):1===b.buffer.length?b.buffer.head.data:b.buffer.concat(b.length),b.buffer.clear()):c=w(a,b.buffer,b.decoder),c}function w(a,b,c){var d;return a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):d=a===b.head.data.length?b.shift():c?x(a,b):y(a,b),d}function x(a,b){var c=b.head,d=1,e=c.data;for(a-=e.length;c=c.next;){var f=c.data,g=a>f.length?f.length:a;if(e+=g===f.length?f:f.slice(0,a),a-=g,0===a){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}return b.length-=d,e}function y(a,b){var c=I.allocUnsafe(a),d=b.head,e=1;for(d.data.copy(c),a-=d.data.length;d=d.next;){var f=d.data,g=a>f.length?f.length:a;if(f.copy(c,c.length-a,0,g),a-=g,0===a){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}return b.length-=e,c}function z(a){var b=a._readableState;if(b.length>0)throw new Error('"endReadable()" called on non-empty stream');b.endEmitted||(b.ended=!0,D(A,b,a))}function A(a,b){a.endEmitted||0!==a.length||(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function B(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}b.exports=f;var C,D=a("process-nextick-args"),E=a("isarray");f.ReadableState=e;var F=(a("events").EventEmitter,function(a,b){return a.listeners(b).length}),G=a("./internal/streams/stream"),H=a("buffer").Buffer,I=a("buffer-shims"),J=a("core-util-is");J.inherits=a("inherits");var K=a("util"),L=void 0;L=K&&K.debuglog?K.debuglog("stream"):function(){};var M,N=a("./internal/streams/BufferList");J.inherits(f,G);var O=["error","close","destroy","pause","resume"];f.prototype.push=function(a,b){var c=this._readableState;return c.objectMode||"string"!=typeof a||(b=b||c.defaultEncoding,b!==c.encoding&&(a=I.from(a,b),b="")),g(this,c,a,b,!1)},f.prototype.unshift=function(a){var b=this._readableState;return g(this,b,a,"",!0)},f.prototype.isPaused=function(){return this._readableState.flowing===!1},f.prototype.setEncoding=function(b){return M||(M=a("string_decoder/").StringDecoder),this._readableState.decoder=new M(b),this._readableState.encoding=b,this};var P=8388608;f.prototype.read=function(a){L("read",a),a=parseInt(a,10);var b=this._readableState,c=a;if(0!==a&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return L("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?z(this):m(this),null;if(a=j(a,b),0===a&&b.ended)return 0===b.length&&z(this),null;var d=b.needReadable;L("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,L("length less than watermark",d)),b.ended||b.reading?(d=!1,L("reading or ended",d)):d&&(L("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=j(c,b)));var e;return e=a>0?v(a,b):null,null===e?(b.needReadable=!0,a=0):b.length-=a,0===b.length&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&z(this)),null!==e&&this.emit("data",e),e},f.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))},f.prototype.pipe=function(a,b){function e(a){L("onunpipe"),a===m&&g()}function f(){L("onend"),a.end()}function g(){L("cleanup"),a.removeListener("close",j),a.removeListener("finish",k),
a.removeListener("drain",r),a.removeListener("error",i),a.removeListener("unpipe",e),m.removeListener("end",f),m.removeListener("end",g),m.removeListener("data",h),s=!0,!n.awaitDrain||a._writableState&&!a._writableState.needDrain||r()}function h(b){L("ondata"),t=!1;var c=a.write(b);!1!==c||t||((1===n.pipesCount&&n.pipes===a||n.pipesCount>1&&-1!==B(n.pipes,a))&&!s&&(L("false write response, pause",m._readableState.awaitDrain),m._readableState.awaitDrain++,t=!0),m.pause())}function i(b){L("onerror",b),l(),a.removeListener("error",i),0===F(a,"error")&&a.emit("error",b)}function j(){a.removeListener("finish",k),l()}function k(){L("onfinish"),a.removeListener("close",j),l()}function l(){L("unpipe"),m.unpipe(a)}var m=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=a;break;case 1:n.pipes=[n.pipes,a];break;default:n.pipes.push(a)}n.pipesCount+=1,L("pipe count=%d opts=%j",n.pipesCount,b);var o=(!b||b.end!==!1)&&a!==c.stdout&&a!==c.stderr,p=o?f:g;n.endEmitted?D(p):m.once("end",p),a.on("unpipe",e);var r=q(m);a.on("drain",r);var s=!1,t=!1;return m.on("data",h),d(a,"error",i),a.once("close",j),a.once("finish",k),a.emit("pipe",m),n.flowing||(L("pipe resume"),m.resume()),a},f.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var f=B(b.pipes,a);return-1===f?this:(b.pipes.splice(f,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},f.prototype.on=function(a,b){var c=G.prototype.on.call(this,a,b);if("data"===a)this._readableState.flowing!==!1&&this.resume();else if("readable"===a){var d=this._readableState;d.endEmitted||d.readableListening||(d.readableListening=d.needReadable=!0,d.emittedReadable=!1,d.reading?d.length&&m(this,d):D(r,this))}return c},f.prototype.addListener=f.prototype.on,f.prototype.resume=function(){var a=this._readableState;return a.flowing||(L("resume"),a.flowing=!0,s(this,a)),this},f.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this},f.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(L("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(L("wrapped data"),b.decoder&&(e=b.decoder.write(e)),(!b.objectMode||null!==e&&void 0!==e)&&(b.objectMode||e&&e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)void 0===this[e]&&"function"==typeof a[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));for(var f=0;f<O.length;f++)a.on(O[f],d.emit.bind(d,O[f]));return d._read=function(b){L("wrapped _read",b),c&&(c=!1,a.resume())},d},f._fromList=v}).call(this,a("_process"))},{"./_stream_duplex":11,"./internal/streams/BufferList":16,"./internal/streams/stream":17,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,events:70,inherits:87,isarray:10,"process-nextick-args":140,"string_decoder/":19,util:36}],14:[function(a,b,c){function d(a){this.afterTransform=function(b,c){return e(a,b,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function e(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("no writecb in Transform class"));d.writechunk=null,d.writecb=null,null!==c&&void 0!==c&&a.push(c),e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark)}function f(a){if(!(this instanceof f))return new f(a);h.call(this,a),this._transformState=new d(this);var b=this;this._readableState.needReadable=!0,this._readableState.sync=!1,a&&("function"==typeof a.transform&&(this._transform=a.transform),"function"==typeof a.flush&&(this._flush=a.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(a,c){g(b,a,c)}):g(b)})}function g(a,b,c){if(b)return a.emit("error",b);null!==c&&void 0!==c&&a.push(c);var d=a._writableState,e=a._transformState;if(d.length)throw new Error("Calling transform done when ws.length != 0");if(e.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}b.exports=f;var h=a("./_stream_duplex"),i=a("core-util-is");i.inherits=a("inherits"),i.inherits(f,h),f.prototype.push=function(a,b){return this._transformState.needTransform=!1,h.prototype.push.call(this,a,b)},f.prototype._transform=function(a,b,c){throw new Error("_transform() is not implemented")},f.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},f.prototype._read=function(a){var b=this._transformState;null!==b.writechunk&&b.writecb&&!b.transforming?(b.transforming=!0,this._transform(b.writechunk,b.writeencoding,b.afterTransform)):b.needTransform=!0}},{"./_stream_duplex":11,"core-util-is":54,inherits:87}],15:[function(a,b,c){(function(c){function d(){}function e(a,b,c){this.chunk=a,this.encoding=b,this.callback=c,this.next=null}function f(b,c){x=x||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof x&&(this.objectMode=this.objectMode||!!b.writableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var f=b.decodeStrings===!1;this.decodeStrings=!f,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){o(c,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function g(b){return x=x||a("./_stream_duplex"),F.call(g,this)||this instanceof x?(this._writableState=new f(b,this),this.writable=!0,b&&("function"==typeof b.write&&(this._write=b.write),"function"==typeof b.writev&&(this._writev=b.writev)),void C.call(this)):new g(b)}function h(a,b){var c=new Error("write after end");a.emit("error",c),y(b,c)}function i(a,b,c,d){var e=!0,f=!1;return null===c?f=new TypeError("May not write null values to stream"):"string"==typeof c||void 0===c||b.objectMode||(f=new TypeError("Invalid non-string/buffer chunk")),f&&(a.emit("error",f),y(d,f),e=!1),e}function j(a,b,c){return a.objectMode||a.decodeStrings===!1||"string"!=typeof b||(b=E.from(b,c)),b}function k(a,b,c,d,f,g){c||(d=j(b,d,f),D.isBuffer(d)&&(f="buffer"));var h=b.objectMode?1:d.length;b.length+=h;var i=b.length<b.highWaterMark;if(i||(b.needDrain=!0),b.writing||b.corked){var k=b.lastBufferedRequest;b.lastBufferedRequest=new e(d,f,g),k?k.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else l(a,b,!1,h,d,f,g);return i}function l(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function m(a,b,c,d,e){--b.pendingcb,c?y(e,d):e(d),a._writableState.errorEmitted=!0,a.emit("error",d)}function n(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function o(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(n(c),b)m(a,c,d,b,e);else{var f=s(c);f||c.corked||c.bufferProcessing||!c.bufferedRequest||r(a,c),d?z(p,a,c,f,e):p(a,c,f,e)}}function p(a,b,c,d){c||q(a,b),b.pendingcb--,d(),u(a,b)}function q(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function r(a,b){b.bufferProcessing=!0;var c=b.bufferedRequest;if(a._writev&&c&&c.next){var d=b.bufferedRequestCount,e=new Array(d),f=b.corkedRequestsFree;f.entry=c;for(var g=0;c;)e[g]=c,c=c.next,g+=1;l(a,b,!0,b.length,e,"",f.finish),b.pendingcb++,b.lastBufferedRequest=null,f.next?(b.corkedRequestsFree=f.next,f.next=null):b.corkedRequestsFree=new w(b)}else{for(;c;){var h=c.chunk,i=c.encoding,j=c.callback,k=b.objectMode?1:h.length;if(l(a,b,!1,k,h,i,j),c=c.next,b.writing)break}null===c&&(b.lastBufferedRequest=null)}b.bufferedRequestCount=0,b.bufferedRequest=c,b.bufferProcessing=!1}function s(a){return a.ending&&0===a.length&&null===a.bufferedRequest&&!a.finished&&!a.writing}function t(a,b){b.prefinished||(b.prefinished=!0,a.emit("prefinish"))}function u(a,b){var c=s(b);return c&&(0===b.pendingcb?(t(a,b),b.finished=!0,a.emit("finish")):t(a,b)),c}function v(a,b,c){b.ending=!0,u(a,b),c&&(b.finished?y(c):a.once("finish",c)),b.ended=!0,a.writable=!1}function w(a){var b=this;this.next=null,this.entry=null,this.finish=function(c){var d=b.entry;for(b.entry=null;d;){var e=d.callback;a.pendingcb--,e(c),d=d.next}a.corkedRequestsFree?a.corkedRequestsFree.next=b:a.corkedRequestsFree=b}}b.exports=g;var x,y=a("process-nextick-args"),z=!c.browser&&["v0.10","v0.9."].indexOf(c.version.slice(0,5))>-1?setImmediate:y;g.WritableState=f;var A=a("core-util-is");A.inherits=a("inherits");var B={deprecate:a("util-deprecate")},C=a("./internal/streams/stream"),D=a("buffer").Buffer,E=a("buffer-shims");A.inherits(g,C),f.prototype.getBuffer=function(){for(var a=this.bufferedRequest,b=[];a;)b.push(a),a=a.next;return b},function(){try{Object.defineProperty(f.prototype,"buffer",{get:B.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(a){}}();var F;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(F=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(a){return F.call(this,a)?!0:a&&a._writableState instanceof f}})):F=function(a){return a instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(a,b,c){var e=this._writableState,f=!1,g=D.isBuffer(a);return"function"==typeof b&&(c=b,b=null),g?b="buffer":b||(b=e.defaultEncoding),"function"!=typeof c&&(c=d),e.ended?h(this,c):(g||i(this,e,a,c))&&(e.pendingcb++,f=k(this,e,g,a,b,c)),f},g.prototype.cork=function(){var a=this._writableState;a.corked++},g.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.bufferedRequest||r(this,a))},g.prototype.setDefaultEncoding=function(a){if("string"==typeof a&&(a=a.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);return this._writableState.defaultEncoding=a,this},g.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),null!==a&&void 0!==a&&this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||v(this,d,c)}}).call(this,a("_process"))},{"./_stream_duplex":11,"./internal/streams/stream":17,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,inherits:87,"process-nextick-args":140,"util-deprecate":219}],16:[function(a,b,c){function d(){this.head=null,this.tail=null,this.length=0}var e=(a("buffer").Buffer,a("buffer-shims"));b.exports=d,d.prototype.push=function(a){var b={data:a,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length},d.prototype.unshift=function(a){var b={data:a,next:this.head};0===this.length&&(this.tail=b),this.head=b,++this.length},d.prototype.shift=function(){if(0!==this.length){var a=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,a}},d.prototype.clear=function(){this.head=this.tail=null,this.length=0},d.prototype.join=function(a){if(0===this.length)return"";for(var b=this.head,c=""+b.data;b=b.next;)c+=a+b.data;return c},d.prototype.concat=function(a){if(0===this.length)return e.alloc(0);if(1===this.length)return this.head.data;for(var b=e.allocUnsafe(a>>>0),c=this.head,d=0;c;)c.data.copy(b,d),d+=c.data.length,c=c.next;return b}},{buffer:39,"buffer-shims":38}],17:[function(a,b,c){b.exports=a("events").EventEmitter},{events:70}],18:[function(a,b,c){c=b.exports=a("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":11,"./lib/_stream_passthrough.js":12,"./lib/_stream_readable.js":13,"./lib/_stream_transform.js":14,"./lib/_stream_writable.js":15}],19:[function(a,b,c){function d(a){if(!a)return"utf8";for(var b;;)switch(a){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return a;default:if(b)return;a=(""+a).toLowerCase(),b=!0}}function e(a){var b=d(a);if("string"!=typeof b&&(s.isEncoding===u||!u(a)))throw new Error("Unknown encoding: "+a);return b||a}function f(a){this.encoding=e(a);var b;switch(this.encoding){case"utf16le":this.text=m,this.end=n,b=4;break;case"utf8":this.fillLast=j,b=4;break;case"base64":this.text=o,this.end=p,b=3;break;default:return this.write=q,void(this.end=r)}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(b)}function g(a){return 127>=a?0:a>>5===6?2:a>>4===14?3:a>>3===30?4:-1}function h(a,b,c){var d=b.length-1;if(c>d)return 0;var e=g(b[d]);return e>=0?(e>0&&(a.lastNeed=e-1),e):--d<c?0:(e=g(b[d]),e>=0?(e>0&&(a.lastNeed=e-2),e):--d<c?0:(e=g(b[d]),e>=0?(e>0&&(2===e?e=0:a.lastNeed=e-3),e):0))}function i(a,b,c){if(128!==(192&b[0]))return a.lastNeed=0,"�".repeat(c);if(a.lastNeed>1&&b.length>1){if(128!==(192&b[1]))return a.lastNeed=1,"�".repeat(c+1);if(a.lastNeed>2&&b.length>2&&128!==(192&b[2]))return a.lastNeed=2,"�".repeat(c+2)}}function j(a){var b=this.lastTotal-this.lastNeed,c=i(this,a,b);return void 0!==c?c:this.lastNeed<=a.length?(a.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(a.copy(this.lastChar,b,0,a.length),void(this.lastNeed-=a.length))}function k(a,b){var c=h(this,a,b);if(!this.lastNeed)return a.toString("utf8",b);this.lastTotal=c;var d=a.length-(c-this.lastNeed);return a.copy(this.lastChar,0,d),a.toString("utf8",b,d)}function l(a){var b=a&&a.length?this.write(a):"";return this.lastNeed?b+"�".repeat(this.lastTotal-this.lastNeed):b}function m(a,b){if((a.length-b)%2===0){var c=a.toString("utf16le",b);if(c){var d=c.charCodeAt(c.length-1);if(d>=55296&&56319>=d)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1],c.slice(0,-1)}return c}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=a[a.length-1],a.toString("utf16le",b,a.length-1)}function n(a){var b=a&&a.length?this.write(a):"";if(this.lastNeed){var c=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,c)}return b}function o(a,b){var c=(a.length-b)%3;return 0===c?a.toString("base64",b):(this.lastNeed=3-c,this.lastTotal=3,1===c?this.lastChar[0]=a[a.length-1]:(this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1]),a.toString("base64",b,a.length-c))}function p(a){var b=a&&a.length?this.write(a):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function q(a){return a.toString(this.encoding)}function r(a){return a&&a.length?this.write(a):""}var s=a("buffer").Buffer,t=a("buffer-shims"),u=s.isEncoding||function(a){switch(a=""+a,a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=f,f.prototype.write=function(a){if(0===a.length)return"";var b,c;if(this.lastNeed){if(b=this.fillLast(a),void 0===b)return"";c=this.lastNeed,this.lastNeed=0}else c=0;return c<a.length?b?b+this.text(a,c):this.text(a,c):b||""},f.prototype.end=l,f.prototype.text=k,f.prototype.fillLast=function(a){return this.lastNeed<=a.length?(a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,a.length),void(this.lastNeed-=a.length))}},{buffer:39,"buffer-shims":38}],20:[function(a,b,c){(function(c){function d(a){function b(a){c.nextTick(function(){h.emit("warning",a)})}var h=this;if(!(h instanceof d))return new d(a);if(g.call(h),a||(a={}),!a.peerId)throw new Error("Option `peerId` is required");if(!a.infoHash)throw new Error("Option `infoHash` is required");if(!a.announce)throw new Error("Option `announce` is required");if(!c.browser&&!a.port)throw new Error("Option `port` is required");h.peerId="string"==typeof a.peerId?a.peerId:a.peerId.toString("hex"),h._peerIdBuffer=e.from(h.peerId,"hex"),h._peerIdBinary=h._peerIdBuffer.toString("binary"),h.infoHash="string"==typeof a.infoHash?a.infoHash:a.infoHash.toString("hex"),h._infoHashBuffer=e.from(h.infoHash,"hex"),h._infoHashBinary=h._infoHashBuffer.toString("binary"),f("new client %s",h.infoHash),h.destroyed=!1,h._port=a.port,h._getAnnounceOpts=a.getAnnounceOpts,h._rtcConfig=a.rtcConfig,h._userAgent=a.userAgent,h._wrtc="function"==typeof a.wrtc?a.wrtc():a.wrtc;var i="string"==typeof a.announce?[a.announce]:null==a.announce?[]:a.announce;i=i.map(function(a){return a=a.toString(),"/"===a[a.length-1]&&(a=a.substring(0,a.length-1)),a}),i=m(i);var j=h._wrtc!==!1&&(!!h._wrtc||l.WEBRTC_SUPPORT);h._trackers=i.map(function(a){var c=n.parse(a).protocol;return"http:"!==c&&"https:"!==c||"function"!=typeof p?"udp:"===c&&"function"==typeof q?new q(h,a):"ws:"!==c&&"wss:"!==c||!j?(b(new Error("Unsupported tracker protocol: "+a)),null):"ws:"===c&&"undefined"!=typeof window&&"https:"===window.location.protocol?(b(new Error("Unsupported tracker protocol: "+a)),null):new r(h,a):new p(h,a)}).filter(Boolean)}b.exports=d;var e=a("safe-buffer").Buffer,f=a("debug")("bittorrent-tracker:client"),g=a("events").EventEmitter,h=a("xtend"),i=a("inherits"),j=a("once"),k=a("run-parallel"),l=a("simple-peer"),m=a("uniq"),n=a("url"),o=a("./lib/common"),p=a("./lib/client/http-tracker"),q=a("./lib/client/udp-tracker"),r=a("./lib/client/websocket-tracker");i(d,g),d.scrape=function(a,b){if(b=j(b),!a.infoHash)throw new Error("Option `infoHash` is required");if(!a.announce)throw new Error("Option `announce` is required");var c=h(a,{infoHash:Array.isArray(a.infoHash)?a.infoHash[0]:a.infoHash,peerId:e.from("01234567890123456789"),port:6881}),f=new d(c);f.once("error",b),f.once("warning",b);var g=Array.isArray(a.infoHash)?a.infoHash.length:1,i={};return f.on("scrape",function(a){if(g-=1,i[a.infoHash]=a,0===g){f.destroy();var c=Object.keys(i);1===c.length?b(null,i[c[0]]):b(null,i)}}),a.infoHash=Array.isArray(a.infoHash)?a.infoHash.map(function(a){return e.from(a,"hex")}):e.from(a.infoHash,"hex"),f.scrape({infoHash:a.infoHash}),f},d.prototype.start=function(a){var b=this;f("send `start`"),a=b._defaultAnnounceOpts(a),a.event="started",b._announce(a),b._trackers.forEach(function(a){a.setInterval()})},d.prototype.stop=function(a){var b=this;f("send `stop`"),a=b._defaultAnnounceOpts(a),a.event="stopped",b._announce(a)},d.prototype.complete=function(a){var b=this;f("send `complete`"),a||(a={}),a=b._defaultAnnounceOpts(a),a.event="completed",b._announce(a)},d.prototype.update=function(a){var b=this;f("send `update`"),a=b._defaultAnnounceOpts(a),a.event&&delete a.event,b._announce(a)},d.prototype._announce=function(a){var b=this;b._trackers.forEach(function(b){b.announce(a)})},d.prototype.scrape=function(a){var b=this;f("send `scrape`"),a||(a={}),b._trackers.forEach(function(b){b.scrape(a)})},d.prototype.setInterval=function(a){var b=this;f("setInterval %d",a),b._trackers.forEach(function(b){b.setInterval(a)})},d.prototype.destroy=function(a){var b=this;if(!b.destroyed){b.destroyed=!0,f("destroy");var c=b._trackers.map(function(a){return function(b){a.destroy(b)}});k(c,a),b._trackers=[],b._getAnnounceOpts=null}},d.prototype._defaultAnnounceOpts=function(a){var b=this;return a||(a={}),null==a.numwant&&(a.numwant=o.DEFAULT_ANNOUNCE_PEERS),null==a.uploaded&&(a.uploaded=0),null==a.downloaded&&(a.downloaded=0),b._getAnnounceOpts&&(a=h(a,b._getAnnounceOpts())),a}}).call(this,a("_process"))},{"./lib/client/http-tracker":36,"./lib/client/udp-tracker":36,"./lib/client/websocket-tracker":22,"./lib/common":23,_process:141,debug:66,events:70,inherits:87,once:135,"run-parallel":162,"safe-buffer":164,"simple-peer":167,uniq:214,url:216,xtend:243}],21:[function(a,b,c){function d(a,b){var c=this;e.call(c),c.client=a,c.announceUrl=b,c.interval=null,c.destroyed=!1}b.exports=d;var e=a("events").EventEmitter,f=a("inherits");f(d,e),d.prototype.setInterval=function(a){var b=this;null==a&&(a=b.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(b.interval),a&&(b.interval=setInterval(function(){b.announce(b.client._defaultAnnounceOpts())},a),b.interval.unref&&b.interval.unref())}},{events:70,inherits:87}],22:[function(a,b,c){function d(a,b,c){var d=this;m.call(d,a,b),f("new websocket tracker %s",b),d.peers={},d.socket=null,d.reconnecting=!1,d.retries=0,d.reconnectTimer=null,d.expectingResponse=!1,d._openSocket()}function e(){}b.exports=d;var f=a("debug")("bittorrent-tracker:websocket-tracker"),g=a("xtend"),h=a("inherits"),i=a("simple-peer"),j=a("randombytes"),k=a("simple-websocket"),l=a("../common"),m=a("./tracker"),n={},o=15e3,p=18e5,q=3e4,r=5e4;h(d,m),d.prototype.DEFAULT_ANNOUNCE_INTERVAL=3e4,d.prototype.announce=function(a){var b=this;if(!b.destroyed&&!b.reconnecting){if(!b.socket.connected)return void b.socket.once("connect",function(){b.announce(a)});var c=g(a,{action:"announce",info_hash:b.client._infoHashBinary,peer_id:b.client._peerIdBinary});if(b._trackerId&&(c.trackerid=b._trackerId),"stopped"===a.event||"completed"===a.event)b._send(c);else{var d=Math.min(a.numwant,10);b._generateOffers(d,function(a){c.numwant=d,c.offers=a,b._send(c)})}}},d.prototype.scrape=function(a){var b=this;if(!b.destroyed&&!b.reconnecting){if(!b.socket.connected)return void b.socket.once("connect",function(){b.scrape(a)});var c=Array.isArray(a.infoHash)&&a.infoHash.length>0?a.infoHash.map(function(a){return a.toString("binary")}):a.infoHash&&a.infoHash.toString("binary")||b.client._infoHashBinary,d={action:"scrape",info_hash:c};b._send(d)}},d.prototype.destroy=function(a){function b(){h&&(clearTimeout(h),h=null),g.removeListener("data",b),g.destroy(),g=null}var c=this;if(a||(a=e),c.destroyed)return a(null);c.destroyed=!0,clearInterval(c.interval),clearTimeout(c.reconnectTimer);for(var d in c.peers){var f=c.peers[d];clearTimeout(f.trackerTimeout),f.destroy()}if(c.peers=null,c.socket&&(c.socket.removeListener("connect",c._onSocketConnectBound),c.socket.removeListener("data",c._onSocketDataBound),c.socket.removeListener("close",c._onSocketCloseBound),c.socket.removeListener("error",c._onSocketErrorBound),c.socket=null),c._onSocketConnectBound=null,c._onSocketErrorBound=null,c._onSocketDataBound=null,c._onSocketCloseBound=null,n[c.announceUrl]&&(n[c.announceUrl].consumers-=1),n[c.announceUrl].consumers>0)return a();var g=n[c.announceUrl];if(delete n[c.announceUrl],g.on("error",e),g.once("close",a),!c.expectingResponse)return b();var h=setTimeout(b,l.DESTROY_TIMEOUT);g.once("data",b)},d.prototype._openSocket=function(){var a=this;a.destroyed=!1,a.peers||(a.peers={}),a._onSocketConnectBound=function(){a._onSocketConnect()},a._onSocketErrorBound=function(b){a._onSocketError(b)},a._onSocketDataBound=function(b){a._onSocketData(b)},a._onSocketCloseBound=function(){a._onSocketClose()},a.socket=n[a.announceUrl],a.socket?n[a.announceUrl].consumers+=1:(a.socket=n[a.announceUrl]=new k(a.announceUrl),a.socket.consumers=1,a.socket.once("connect",a._onSocketConnectBound)),a.socket.on("data",a._onSocketDataBound),a.socket.once("close",a._onSocketCloseBound),a.socket.once("error",a._onSocketErrorBound)},d.prototype._onSocketConnect=function(){var a=this;a.destroyed||a.reconnecting&&(a.reconnecting=!1,a.retries=0,a.announce(a.client._defaultAnnounceOpts()))},d.prototype._onSocketData=function(a){var b=this;if(!b.destroyed){b.expectingResponse=!1;try{a=JSON.parse(a)}catch(c){return void b.client.emit("warning",new Error("Invalid tracker response"))}"announce"===a.action?b._onAnnounceResponse(a):"scrape"===a.action?b._onScrapeResponse(a):b._onSocketError(new Error("invalid action in WS response: "+a.action))}},d.prototype._onAnnounceResponse=function(a){var b=this;if(a.info_hash!==b.client._infoHashBinary)return void f("ignoring websocket data from %s for %s (looking for %s: reused socket)",b.announceUrl,l.binaryToHex(a.info_hash),b.client.infoHash);if(!a.peer_id||a.peer_id!==b.client._peerIdBinary){f("received %s from %s for %s",JSON.stringify(a),b.announceUrl,b.client.infoHash);var c=a["failure reason"];if(c)return b.client.emit("warning",new Error(c));var d=a["warning message"];d&&b.client.emit("warning",new Error(d));var e=a.interval||a["min interval"];e&&b.setInterval(1e3*e);var g=a["tracker id"];if(g&&(b._trackerId=g),null!=a.complete){var h=Object.assign({},a,{announce:b.announceUrl,infoHash:l.binaryToHex(a.info_hash)});b.client.emit("update",h)}var i;if(a.offer&&a.peer_id&&(f("creating peer (from remote offer)"),i=b._createPeer(),i.id=l.binaryToHex(a.peer_id),i.once("signal",function(c){var d={action:"announce",info_hash:b.client._infoHashBinary,peer_id:b.client._peerIdBinary,to_peer_id:a.peer_id,answer:c,offer_id:a.offer_id};b._trackerId&&(d.trackerid=b._trackerId),b._send(d)}),i.signal(a.offer),b.client.emit("peer",i)),a.answer&&a.peer_id){var j=l.binaryToHex(a.offer_id);i=b.peers[j],i?(i.id=l.binaryToHex(a.peer_id),i.signal(a.answer),b.client.emit("peer",i),clearTimeout(i.trackerTimeout),i.trackerTimeout=null,delete b.peers[j]):f("got unexpected answer: "+JSON.stringify(a.answer))}}},d.prototype._onScrapeResponse=function(a){var b=this;a=a.files||{};var c=Object.keys(a);return 0===c.length?void b.client.emit("warning",new Error("invalid scrape response")):void c.forEach(function(c){var d=Object.assign(a[c],{announce:b.announceUrl,infoHash:l.binaryToHex(c)});b.client.emit("scrape",d)})},d.prototype._onSocketClose=function(){var a=this;a.destroyed||(a.destroy(),a._startReconnectTimer())},d.prototype._onSocketError=function(a){var b=this;b.destroyed||(b.destroy(),b.client.emit("warning",a),b._startReconnectTimer())},d.prototype._startReconnectTimer=function(){var a=this,b=Math.floor(Math.random()*q)+Math.min(Math.pow(2,a.retries)*o,p);a.reconnecting=!0,clearTimeout(a.reconnectTimer),a.reconnectTimer=setTimeout(function(){a.retries++,a._openSocket()},b),a.reconnectTimer.unref&&a.reconnectTimer.unref(),f("reconnecting socket in %s ms",b)},d.prototype._send=function(a){var b=this;if(!b.destroyed){b.expectingResponse=!0;var c=JSON.stringify(a);f("send %s",c),b.socket.send(c)}},d.prototype._generateOffers=function(a,b){function c(){var a=j(20).toString("hex");f("creating peer (from _generateOffers)");var b=e.peers[a]=e._createPeer({initiator:!0});b.once("signal",function(b){g.push({offer:b,offer_id:l.hexToBinary(a)}),d()}),b.trackerTimeout=setTimeout(function(){f("tracker timeout: destroying peer"),b.trackerTimeout=null,delete e.peers[a],b.destroy()},r),b.trackerTimeout.unref&&b.trackerTimeout.unref()}function d(){g.length===a&&(f("generated %s offers",a),b(g))}var e=this,g=[];f("generating %s offers",a);for(var h=0;a>h;++h)c();d()},d.prototype._createPeer=function(a){function b(a){d.client.emit("warning",new Error("Connection error: "+a.message)),e.destroy()}function c(){e.removeListener("error",b),e.removeListener("connect",c)}var d=this;a=Object.assign({trickle:!1,config:d.client._rtcConfig,wrtc:d.client._wrtc},a);var e=new i(a);return e.once("error",b),e.once("connect",c),e}},{"../common":23,"./tracker":21,debug:66,inherits:87,randombytes:147,"simple-peer":167,"simple-websocket":179,xtend:243}],23:[function(a,b,c){var d=a("safe-buffer").Buffer,e=a("xtend/mutable");c.DEFAULT_ANNOUNCE_PEERS=50,c.MAX_ANNOUNCE_PEERS=82,c.binaryToHex=function(a){return"string"!=typeof a&&(a=String(a)),d.from(a,"binary").toString("hex")},c.hexToBinary=function(a){return"string"!=typeof a&&(a=String(a)),d.from(a,"hex").toString("binary")};var f=a("./common-node");e(c,f)},{"./common-node":36,"safe-buffer":164,"xtend/mutable":244}],24:[function(a,b,c){(function(a){b.exports=function(b,c){function d(b){e.removeEventListener("loadend",d,!1),b.error?c(b.error):c(null,new a(e.result))}if("undefined"==typeof Blob||!(b instanceof Blob))throw new Error("first argument must be a Blob");if("function"!=typeof c)throw new Error("second argument must be a function");var e=new FileReader;e.addEventListener("loadend",d,!1),e.readAsArrayBuffer(b)}}).call(this,a("buffer").Buffer)},{buffer:39}],25:[function(a,b,c){(function(c){function d(a,b){return this instanceof d?(f.call(this),b||(b={}),"object"==typeof a&&(b=a,a=b.size),this.size=a||512,b.nopad?this._zeroPadding=!1:this._zeroPadding=g(b.zeroPadding,!0),this._buffered=[],void(this._bufferedBytes=0)):new d(a,b)}var e=a("inherits"),f=a("readable-stream").Transform,g=a("defined");b.exports=d,e(d,f),d.prototype._transform=function(a,b,d){for(this._bufferedBytes+=a.length,this._buffered.push(a);this._bufferedBytes>=this.size;){var e=c.concat(this._buffered);this._bufferedBytes-=this.size,this.push(e.slice(0,this.size)),this._buffered=[e.slice(this.size,e.length)]}d()},d.prototype._flush=function(){if(this._bufferedBytes&&this._zeroPadding){var a=new c(this.size-this._bufferedBytes);a.fill(0),this._buffered.push(a),this.push(c.concat(this._buffered)),this._buffered=null}else this._bufferedBytes&&(this.push(c.concat(this._buffered)),this._buffered=null);this.push(null)}}).call(this,a("buffer").Buffer)},{buffer:39,defined:68,inherits:87,"readable-stream":34}],26:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],27:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":29,"./_stream_writable":31,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],28:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":30,"core-util-is":54,dup:12,inherits:87}],29:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":27,"./internal/streams/BufferList":32,"./internal/streams/stream":33,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:26,"process-nextick-args":140,"string_decoder/":35,util:36}],30:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":27,"core-util-is":54,dup:14,inherits:87}],31:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":27,"./internal/streams/stream":33,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],32:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],33:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],34:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":27,"./lib/_stream_passthrough.js":28,"./lib/_stream_readable.js":29,"./lib/_stream_transform.js":30,"./lib/_stream_writable.js":31,dup:18}],35:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],36:[function(a,b,c){},{}],37:[function(a,b,c){arguments[4][36][0].apply(c,arguments)},{dup:36}],38:[function(a,b,c){(function(b){var d=a("buffer"),e=d.Buffer,f=d.SlowBuffer,g=d.kMaxLength||2147483647;c.alloc=function(a,b,c){if("function"==typeof e.alloc)return e.alloc(a,b,c);if("number"==typeof c)throw new TypeError("encoding must not be number");if("number"!=typeof a)throw new TypeError("size must be a number");
if(a>g)throw new RangeError("size is too large");var d=c,f=b;void 0===f&&(d=void 0,f=0);var h=new e(a);if("string"==typeof f)for(var i=new e(f,d),j=i.length,k=-1;++k<a;)h[k]=i[k%j];else h.fill(f);return h},c.allocUnsafe=function(a){if("function"==typeof e.allocUnsafe)return e.allocUnsafe(a);if("number"!=typeof a)throw new TypeError("size must be a number");if(a>g)throw new RangeError("size is too large");return new e(a)},c.from=function(a,c,d){if("function"==typeof e.from&&(!b.Uint8Array||Uint8Array.from!==e.from))return e.from(a,c,d);if("number"==typeof a)throw new TypeError('"value" argument must not be a number');if("string"==typeof a)return new e(a,c);if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer){var f=c;if(1===arguments.length)return new e(a);"undefined"==typeof f&&(f=0);var g=d;if("undefined"==typeof g&&(g=a.byteLength-f),f>=a.byteLength)throw new RangeError("'offset' is out of bounds");if(g>a.byteLength-f)throw new RangeError("'length' is out of bounds");return new e(a.slice(f,f+g))}if(e.isBuffer(a)){var h=new e(a.length);return a.copy(h,0,0,a.length),h}if(a){if(Array.isArray(a)||"undefined"!=typeof ArrayBuffer&&a.buffer instanceof ArrayBuffer||"length"in a)return new e(a);if("Buffer"===a.type&&Array.isArray(a.data))return new e(a.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},c.allocUnsafeSlow=function(a){if("function"==typeof e.allocUnsafeSlow)return e.allocUnsafeSlow(a);if("number"!=typeof a)throw new TypeError("size must be a number");if(a>=g)throw new RangeError("size is too large");return new f(a)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:39}],39:[function(a,b,c){(function(b){function d(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()&&"function"==typeof a.subarray&&0===a.subarray(1,1).byteLength}catch(b){return!1}}function e(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a,b){if(e()<b)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(b),a.__proto__=g.prototype):(null===a&&(a=new g(b)),a.length=b),a}function g(a,b,c){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(a,b,c);if("number"==typeof a){if("string"==typeof b)throw new Error("If encoding is specified then the first argument must be a string");return k(this,a)}return h(this,a,b,c)}function h(a,b,c,d){if("number"==typeof b)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer?n(a,b,c,d):"string"==typeof b?l(a,b,c):o(a,b)}function i(a){if("number"!=typeof a)throw new TypeError('"size" argument must be a number');if(0>a)throw new RangeError('"size" argument must not be negative')}function j(a,b,c,d){return i(b),0>=b?f(a,b):void 0!==c?"string"==typeof d?f(a,b).fill(c,d):f(a,b).fill(c):f(a,b)}function k(a,b){if(i(b),a=f(a,0>b?0:0|p(b)),!g.TYPED_ARRAY_SUPPORT)for(var c=0;b>c;++c)a[c]=0;return a}function l(a,b,c){if(("string"!=typeof c||""===c)&&(c="utf8"),!g.isEncoding(c))throw new TypeError('"encoding" must be a valid string encoding');var d=0|r(b,c);a=f(a,d);var e=a.write(b,c);return e!==d&&(a=a.slice(0,e)),a}function m(a,b){var c=b.length<0?0:0|p(b.length);a=f(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function n(a,b,c,d){if(b.byteLength,0>c||b.byteLength<c)throw new RangeError("'offset' is out of bounds");if(b.byteLength<c+(d||0))throw new RangeError("'length' is out of bounds");return b=void 0===c&&void 0===d?new Uint8Array(b):void 0===d?new Uint8Array(b,c):new Uint8Array(b,c,d),g.TYPED_ARRAY_SUPPORT?(a=b,a.__proto__=g.prototype):a=m(a,b),a}function o(a,b){if(g.isBuffer(b)){var c=0|p(b.length);return a=f(a,c),0===a.length?a:(b.copy(a,0,0,c),a)}if(b){if("undefined"!=typeof ArrayBuffer&&b.buffer instanceof ArrayBuffer||"length"in b)return"number"!=typeof b.length||Y(b.length)?f(a,0):m(a,b);if("Buffer"===b.type&&_(b.data))return m(a,b.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function q(a){return+a!=a&&(a=0),g.alloc(+a)}function r(a,b){if(g.isBuffer(a))return a.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(a)||a instanceof ArrayBuffer))return a.byteLength;"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return T(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return W(a).length;default:if(d)return T(a).length;b=(""+b).toLowerCase(),d=!0}}function s(a,b,c){var d=!1;if((void 0===b||0>b)&&(b=0),b>this.length)return"";if((void 0===c||c>this.length)&&(c=this.length),0>=c)return"";if(c>>>=0,b>>>=0,b>=c)return"";for(a||(a="utf8");;)switch(a){case"hex":return H(this,b,c);case"utf8":case"utf-8":return D(this,b,c);case"ascii":return F(this,b,c);case"latin1":case"binary":return G(this,b,c);case"base64":return C(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function t(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function u(a,b,c,d,e){if(0===a.length)return-1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:-2147483648>c&&(c=-2147483648),c=+c,isNaN(c)&&(c=e?0:a.length-1),0>c&&(c=a.length+c),c>=a.length){if(e)return-1;c=a.length-1}else if(0>c){if(!e)return-1;c=0}if("string"==typeof b&&(b=g.from(b,d)),g.isBuffer(b))return 0===b.length?-1:v(a,b,c,d,e);if("number"==typeof b)return b=255&b,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):v(a,[b],c,d,e);throw new TypeError("val must be string, number or Buffer")}function v(a,b,c,d,e){function f(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}var g=1,h=a.length,i=b.length;if(void 0!==d&&(d=String(d).toLowerCase(),"ucs2"===d||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return-1;g=2,h/=2,i/=2,c/=2}var j;if(e){var k=-1;for(j=c;h>j;j++)if(f(a,j)===f(b,-1===k?0:j-k)){if(-1===k&&(k=j),j-k+1===i)return k*g}else-1!==k&&(j-=j-k),k=-1}else for(c+i>h&&(c=h-i),j=c;j>=0;j--){for(var l=!0,m=0;i>m;m++)if(f(a,j+m)!==f(b,m)){l=!1;break}if(l)return j}return-1}function w(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new TypeError("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;++g){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))return g;a[c+g]=h}return g}function x(a,b,c,d){return X(T(b,a.length-c),a,c,d)}function y(a,b,c,d){return X(U(b),a,c,d)}function z(a,b,c,d){return y(a,b,c,d)}function A(a,b,c,d){return X(W(b),a,c,d)}function B(a,b,c,d){return X(V(b,a.length-c),a,c,d)}function C(a,b,c){return 0===b&&c===a.length?Z.fromByteArray(a):Z.fromByteArray(a.slice(b,c))}function D(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;c>e;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(c>=e+h){var i,j,k,l;switch(h){case 1:128>f&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(55296>l||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&1114112>l&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return E(d)}function E(a){var b=a.length;if(aa>=b)return String.fromCharCode.apply(String,a);for(var c="",d=0;b>d;)c+=String.fromCharCode.apply(String,a.slice(d,d+=aa));return c}function F(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;++e)d+=String.fromCharCode(127&a[e]);return d}function G(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;++e)d+=String.fromCharCode(a[e]);return d}function H(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;++f)e+=S(a[f]);return e}function I(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function J(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function K(a,b,c,d,e,f){if(!g.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>e||f>b)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}function L(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;++e)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function M(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;++e)a[c+e]=b>>>8*(d?e:3-e)&255}function N(a,b,c,d,e,f){if(c+d>a.length)throw new RangeError("Index out of range");if(0>c)throw new RangeError("Index out of range")}function O(a,b,c,d,e){return e||N(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),$.write(a,b,c,d,23,4),c+4}function P(a,b,c,d,e){return e||N(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),$.write(a,b,c,d,52,8),c+8}function Q(a){if(a=R(a).replace(ba,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function R(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function S(a){return 16>a?"0"+a.toString(16):a.toString(16)}function T(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;d>g;++g){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(1114112>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function U(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function V(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function W(a){return Z.toByteArray(Q(a))}function X(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function Y(a){return a!==a}var Z=a("base64-js"),$=a("ieee754"),_=a("isarray");c.Buffer=g,c.SlowBuffer=q,c.INSPECT_MAX_BYTES=50,g.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),c.kMaxLength=e(),g.poolSize=8192,g._augment=function(a){return a.__proto__=g.prototype,a},g.from=function(a,b,c){return h(null,a,b,c)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&g[Symbol.species]===g&&Object.defineProperty(g,Symbol.species,{value:null,configurable:!0})),g.alloc=function(a,b,c){return j(null,a,b,c)},g.allocUnsafe=function(a){return k(null,a)},g.allocUnsafeSlow=function(a){return k(null,a)},g.isBuffer=function(a){return!(null==a||!a._isBuffer)},g.compare=function(a,b){if(!g.isBuffer(a)||!g.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,f=Math.min(c,d);f>e;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return d>c?-1:c>d?1:0},g.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(a,b){if(!_(a))throw new TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return g.alloc(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var d=g.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var f=a[c];if(!g.isBuffer(f))throw new TypeError('"list" argument must be an Array of Buffers');f.copy(d,e),e+=f.length}return d},g.byteLength=r,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;a>b;b+=2)t(this,b,b+1);return this},g.prototype.swap32=function(){var a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;a>b;b+=4)t(this,b,b+3),t(this,b+1,b+2);return this},g.prototype.swap64=function(){var a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;a>b;b+=8)t(this,b,b+7),t(this,b+1,b+6),t(this,b+2,b+5),t(this,b+3,b+4);return this},g.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?D(this,0,a):s.apply(this,arguments)},g.prototype.equals=function(a){if(!g.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===g.compare(this,a)},g.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},g.prototype.compare=function(a,b,c,d,e){if(!g.isBuffer(a))throw new TypeError("Argument must be a Buffer");if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),0>b||c>a.length||0>d||e>this.length)throw new RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return-1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;for(var f=e-d,h=c-b,i=Math.min(f,h),j=this.slice(d,e),k=a.slice(b,c),l=0;i>l;++l)if(j[l]!==k[l]){f=j[l],h=k[l];break}return h>f?-1:f>h?1:0},g.prototype.includes=function(a,b,c){return-1!==this.indexOf(a,b,c)},g.prototype.indexOf=function(a,b,c){return u(this,a,b,c,!0)},g.prototype.lastIndexOf=function(a,b,c){return u(this,a,b,c,!1)},g.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b=0|b,isFinite(c)?(c=0|c,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(0>c||0>b)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var f=!1;;)switch(d){case"hex":return w(this,a,b,c);case"utf8":case"utf-8":return x(this,a,b,c);case"ascii":return y(this,a,b,c);case"latin1":case"binary":return z(this,a,b,c);case"base64":return A(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,a,b,c);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var aa=4096;g.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var d;if(g.TYPED_ARRAY_SUPPORT)d=this.subarray(a,b),d.__proto__=g.prototype;else{var e=b-a;d=new g(e,void 0);for(var f=0;e>f;++f)d[f]=this[f+a]}return d},g.prototype.readUIntLE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},g.prototype.readUIntBE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},g.prototype.readUInt8=function(a,b){return b||J(a,1,this.length),this[a]},g.prototype.readUInt16LE=function(a,b){return b||J(a,2,this.length),this[a]|this[a+1]<<8},g.prototype.readUInt16BE=function(a,b){return b||J(a,2,this.length),this[a]<<8|this[a+1]},g.prototype.readUInt32LE=function(a,b){return b||J(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},g.prototype.readUInt32BE=function(a,b){return b||J(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},g.prototype.readIntLE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},g.prototype.readIntBE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},g.prototype.readInt8=function(a,b){return b||J(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},g.prototype.readInt16LE=function(a,b){b||J(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},g.prototype.readInt16BE=function(a,b){b||J(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},g.prototype.readInt32LE=function(a,b){return b||J(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},g.prototype.readInt32BE=function(a,b){return b||J(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},g.prototype.readFloatLE=function(a,b){return b||J(a,4,this.length),$.read(this,a,!0,23,4)},g.prototype.readFloatBE=function(a,b){return b||J(a,4,this.length),$.read(this,a,!1,23,4)},g.prototype.readDoubleLE=function(a,b){return b||J(a,8,this.length),$.read(this,a,!0,52,8)},g.prototype.readDoubleBE=function(a,b){return b||J(a,8,this.length),$.read(this,a,!1,52,8)},g.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b=0|b,c=0|c,!d){var e=Math.pow(2,8*c)-1;K(this,a,b,c,e,0)}var f=1,g=0;for(this[b]=255&a;++g<c&&(f*=256);)this[b+g]=a/f&255;return b+c},g.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b=0|b,c=0|c,!d){var e=Math.pow(2,8*c)-1;K(this,a,b,c,e,0)}var f=c-1,g=1;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=a/g&255;return b+c},g.prototype.writeUInt8=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,1,255,0),g.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},g.prototype.writeUInt16LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):L(this,a,b,!0),b+2},g.prototype.writeUInt16BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):L(this,a,b,!1),b+2},g.prototype.writeUInt32LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):M(this,a,b,!0),b+4},g.prototype.writeUInt32BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):M(this,a,b,!1),b+4},g.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);K(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)0>a&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},g.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);K(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)0>a&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},g.prototype.writeInt8=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,1,127,-128),g.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=255&a,b+1},g.prototype.writeInt16LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):L(this,a,b,!0),b+2},g.prototype.writeInt16BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):L(this,a,b,!1),b+2},g.prototype.writeInt32LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):M(this,a,b,!0),b+4},g.prototype.writeInt32BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):M(this,a,b,!1),b+4},g.prototype.writeFloatLE=function(a,b,c){return O(this,a,b,!0,c)},g.prototype.writeFloatBE=function(a,b,c){return O(this,a,b,!1,c)},g.prototype.writeDoubleLE=function(a,b,c){return P(this,a,b,!0,c)},g.prototype.writeDoubleBE=function(a,b,c){return P(this,a,b,!1,c)},g.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&c>d&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,f=d-c;if(this===a&&b>c&&d>b)for(e=f-1;e>=0;--e)a[e+b]=this[e+c];else if(1e3>f||!g.TYPED_ARRAY_SUPPORT)for(e=0;f>e;++e)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+f),b);return f},g.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),1===a.length){var e=a.charCodeAt(0);256>e&&(a=e)}if(void 0!==d&&"string"!=typeof d)throw new TypeError("encoding must be a string");if("string"==typeof d&&!g.isEncoding(d))throw new TypeError("Unknown encoding: "+d)}else"number"==typeof a&&(a=255&a);if(0>b||this.length<b||this.length<c)throw new RangeError("Out of range index");if(b>=c)return this;b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0);var f;if("number"==typeof a)for(f=b;c>f;++f)this[f]=a;else{var h=g.isBuffer(a)?a:T(new g(a,d).toString()),i=h.length;for(f=0;c-b>f;++f)this[f+b]=h[f%i]}return this};var ba=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":3,ieee754:85,isarray:40}],40:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],41:[function(a,b,c){b.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],42:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],43:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":45,"./_stream_writable":47,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],44:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":46,"core-util-is":54,dup:12,inherits:87}],45:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":43,"./internal/streams/BufferList":48,"./internal/streams/stream":49,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:42,"process-nextick-args":140,"string_decoder/":51,util:36}],46:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":43,"core-util-is":54,dup:14,inherits:87}],47:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":43,"./internal/streams/stream":49,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],48:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],49:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],50:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":43,"./lib/_stream_passthrough.js":44,"./lib/_stream_readable.js":45,"./lib/_stream_transform.js":46,"./lib/_stream_writable.js":47,dup:18}],51:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],52:[function(a,b,c){function d(a,b,c){function f(b){h.destroyed||(a.put(i,b),i+=1)}var h=this;if(!(h instanceof d))return new d(a,b,c);if(g.Writable.call(h,c),c||(c={}),!a||!a.put||!a.get)throw new Error("First argument must be an abstract-chunk-store compliant store");if(b=Number(b),!b)throw new Error("Second argument must be a chunk length");h._blockstream=new e(b,{zeroPadding:!1}),h._blockstream.on("data",f).on("error",function(a){h.destroy(a)});var i=0;h.on("finish",function(){this._blockstream.end()})}b.exports=d;var e=a("block-stream2"),f=a("inherits"),g=a("readable-stream");f(d,g.Writable),d.prototype._write=function(a,b,c){this._blockstream.write(a,b,c)},d.prototype.destroy=function(a){this.destroyed||(this.destroyed=!0,a&&this.emit("error",a),this.emit("close"))}},{"block-stream2":25,inherits:87,"readable-stream":50}],53:[function(a,b,c){function d(a,b,c){for(var d,f,g,h=1/0,i=0,j=b.length-1;j>=i&&(d=i+(j-i>>1),g=b[d]-a,0>g?i=d+1:g>0?j=d-1:void 0,g=e(g),h>g&&(h=g,f=d),b[d]!==a););return c?f:b[f]}var e=Math.abs;b.exports=d},{}],54:[function(a,b,c){(function(a){function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===q(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return"[object RegExp]"===q(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return"[object Date]"===q(a)}function n(a){return"[object Error]"===q(a)||a instanceof Error}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function q(a){return Object.prototype.toString.call(a)}c.isArray=b,c.isBoolean=d,c.isNull=e,c.isNullOrUndefined=f,c.isNumber=g,c.isString=h,c.isSymbol=i,c.isUndefined=j,c.isRegExp=k,c.isObject=l,c.isDate=m,c.isError=n,c.isFunction=o,c.isPrimitive=p,c.isBuffer=a.isBuffer}).call(this,{isBuffer:a("../../is-buffer/index.js")})},{"../../is-buffer/index.js":89}],55:[function(a,b,c){(function(c,d,e){function f(a,b,c){return"function"==typeof b?f(a,null,b):(b=b?A(b):{},void h(a,b,function(a,d,e){return a?c(a):(b.singleFileTorrent=e,void n(d,b,c))}))}function g(a,b,c){return"function"==typeof b?g(a,null,b):(b=b?A(b):{},void h(a,b,c))}function h(a,b,d){function f(){I(a.map(function(a){return function(b){var c={};if(p(a))c.getStream=s(a),c.length=a.size;else if(e.isBuffer(a))c.getStream=t(a),c.length=a.length;else{if(!r(a)){if("string"==typeof a){if("function"!=typeof D.stat)throw new Error("filesystem paths do not work in the browser");var d=h>1||j;return void i(a,d,b)}throw new Error("invalid input type")}c.getStream=v(a,c),c.length=0}c.path=a.path,b(null,c)}}),function(a,b){return a?d(a):(b=C(b),void d(null,b,j))})}if(Array.isArray(a)&&0===a.length)throw new Error("invalid input type");q(a)&&(a=Array.prototype.slice.call(a)),Array.isArray(a)||(a=[a]),a=a.map(function(a){return p(a)&&"string"==typeof a.path&&"function"==typeof D.stat?a.path:a}),1!==a.length||"string"==typeof a[0]||a[0].name||(a[0].name=b.name);var g=null;a.forEach(function(b,c){if("string"!=typeof b){var d=b.fullPath||b.name;d||(d="Unknown File "+(c+1),b.unknownName=!0),b.path=d.split("/"),b.path[0]||b.path.shift(),b.path.length<2?g=null:0===c&&a.length>1?g=b.path[0]:b.path[0]!==g&&(g=null)}}),a=a.filter(function(a){if("string"==typeof a)return!0;var b=a.path[a.path.length-1];return l(b)&&F.not(b)}),g&&a.forEach(function(a){var b=(e.isBuffer(a)||r(a))&&!a.path;"string"==typeof a||b||a.path.shift()}),!b.name&&g&&(b.name=g),b.name||a.some(function(a){return"string"==typeof a?(b.name=z.basename(a),!0):a.unknownName?void 0:(b.name=a.path[a.path.length-1],!0)}),b.name||(b.name="Unnamed Torrent "+Date.now());var h=a.reduce(function(a,b){return a+Number("string"==typeof b)},0),j=1===a.length;if(1===a.length&&"string"==typeof a[0]){if("function"!=typeof D.stat)throw new Error("filesystem paths do not work in the browser");E(a[0],function(a,b){return a?d(a):(j=b,void f())})}else c.nextTick(function(){f()})}function i(a,b,c){k(a,j,function(d,e){return d?c(d):(e=Array.isArray(e)?C(e):[e],a=z.normalize(a),b&&(a=a.slice(0,a.lastIndexOf(z.sep)+1)),a[a.length-1]!==z.sep&&(a+=z.sep),e.forEach(function(b){b.getStream=u(b.path),b.path=b.path.replace(a,"").split(z.sep)}),void c(null,e))})}function j(a,b){b=H(b),D.stat(a,function(c,d){if(c)return b(c);var e={length:d.size,path:a};b(null,e)})}function k(a,b,c){D.stat(a,function(d,e){return d?c(d):void(e.isDirectory()?D.readdir(a,function(d,e){return d?c(d):void I(e.filter(l).filter(F.not).map(function(c){return function(d){k(z.join(a,c),b,d)}}),c)}):e.isFile()&&b(a,c))})}function l(a){return"."!==a[0]}function m(a,b,c){function d(a){k+=a.length;var b=n;J(a,function(a){j[b]=a,m-=1,i()}),m+=1,n+=1}function f(){o=!0,i()}function g(a){h(),c(a)}function h(){p.removeListener("error",g),q.removeListener("data",d),q.removeListener("end",f),q.removeListener("error",g)}function i(){o&&0===m&&(h(),c(null,e.from(j.join(""),"hex"),k))}c=H(c);var j=[],k=0,l=a.map(function(a){return a.getStream}),m=0,n=0,o=!1,p=new G(l),q=new x(b,{zeroPadding:!1});p.on("error",g),p.pipe(q).on("data",d).on("end",f).on("error",g)}function n(a,c,e){var f=c.announceList;f||("string"==typeof c.announce?f=[[c.announce]]:Array.isArray(c.announce)&&(f=c.announce.map(function(a){return[a]}))),f||(f=[]),d.WEBTORRENT_ANNOUNCE&&("string"==typeof d.WEBTORRENT_ANNOUNCE?f.push([[d.WEBTORRENT_ANNOUNCE]]):Array.isArray(d.WEBTORRENT_ANNOUNCE)&&(f=f.concat(d.WEBTORRENT_ANNOUNCE.map(function(a){return[a]})))),void 0===c.announce&&void 0===c.announceList&&(f=f.concat(b.exports.announceList)),"string"==typeof c.urlList&&(c.urlList=[c.urlList]);var g={info:{name:c.name},"creation date":Math.ceil((Number(c.creationDate)||Date.now())/1e3),encoding:"UTF-8"};0!==f.length&&(g.announce=f[0][0],g["announce-list"]=f),void 0!==c.comment&&(g.comment=c.comment),void 0!==c.createdBy&&(g["created by"]=c.createdBy),void 0!==c["private"]&&(g.info["private"]=Number(c["private"])),void 0!==c.sslCert&&(g.info["ssl-cert"]=c.sslCert),void 0!==c.urlList&&(g["url-list"]=c.urlList);var h=c.pieceLength||y(a.reduce(o,0));g.info["piece length"]=h,m(a,h,function(b,d,f){return b?e(b):(g.info.pieces=d,a.forEach(function(a){delete a.getStream}),c.singleFileTorrent?g.info.length=f:g.info.files=a,void e(null,w.encode(g)))})}function o(a,b){return a+b.length}function p(a){return"undefined"!=typeof Blob&&a instanceof Blob}function q(a){return"undefined"!=typeof FileList&&a instanceof FileList}function r(a){return"object"==typeof a&&null!=a&&"function"==typeof a.pipe}function s(a){return function(){return new B(a)}}function t(a){return function(){var b=new K.PassThrough;return b.end(a),b}}function u(a){return function(){return D.createReadStream(a)}}function v(a,b){return function(){var c=new K.Transform;return c._transform=function(a,c,d){b.length+=a.length,this.push(a),d()},a.pipe(c),c}}b.exports=f,b.exports.parseInput=g,b.exports.announceList=[["udp://tracker.leechers-paradise.org:6969"],["udp://tracker.coppersurfer.tk:6969"],["udp://tracker.opentrackr.org:1337"],["udp://explodie.org:6969"],["udp://tracker.empire-js.us:1337"],["wss://tracker.btorrent.xyz"],["wss://tracker.openwebtorrent.com"],["wss://tracker.fastcast.nz"]];
var w=a("bencode"),x=a("block-stream2"),y=a("piece-length"),z=a("path"),A=a("xtend"),B=a("filestream/read"),C=a("flatten"),D=a("fs"),E=a("is-file"),F=a("junk"),G=a("multistream"),H=a("once"),I=a("run-parallel"),J=a("simple-sha1"),K=a("readable-stream")}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a("buffer").Buffer)},{_process:141,bencode:6,"block-stream2":25,buffer:39,"filestream/read":81,flatten:82,fs:37,"is-file":90,junk:92,multistream:123,once:135,path:138,"piece-length":139,"readable-stream":64,"run-parallel":162,"simple-sha1":178,xtend:243}],56:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],57:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":59,"./_stream_writable":61,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],58:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":60,"core-util-is":54,dup:12,inherits:87}],59:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":57,"./internal/streams/BufferList":62,"./internal/streams/stream":63,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:56,"process-nextick-args":140,"string_decoder/":65,util:36}],60:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":57,"core-util-is":54,dup:14,inherits:87}],61:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":57,"./internal/streams/stream":63,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],62:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],63:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],64:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":57,"./lib/_stream_passthrough.js":58,"./lib/_stream_readable.js":59,"./lib/_stream_transform.js":60,"./lib/_stream_writable.js":61,dup:18}],65:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],66:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":67}],67:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:122}],68:[function(a,b,c){b.exports=function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a]}},{}],69:[function(a,b,c){var d=a("once"),e=function(){},f=function(a){return a.setHeader&&"function"==typeof a.abort},g=function(a){return a.stdio&&Array.isArray(a.stdio)&&3===a.stdio.length},h=function(a,b,c){if("function"==typeof b)return h(a,null,b);b||(b={}),c=d(c||e);var i=a._writableState,j=a._readableState,k=b.readable||b.readable!==!1&&a.readable,l=b.writable||b.writable!==!1&&a.writable,m=function(){a.writable||n()},n=function(){l=!1,k||c.call(a)},o=function(){k=!1,l||c.call(a)},p=function(b){c.call(a,b?new Error("exited with error code: "+b):null)},q=function(){return(!k||j&&j.ended)&&(!l||i&&i.ended)?void 0:c.call(a,new Error("premature close"))},r=function(){a.req.on("finish",n)};return f(a)?(a.on("complete",n),a.on("abort",q),a.req?r():a.on("request",r)):l&&!i&&(a.on("end",m),a.on("close",m)),g(a)&&a.on("exit",p),a.on("end",o),a.on("finish",n),b.error!==!1&&a.on("error",c),a.on("close",q),function(){a.removeListener("complete",n),a.removeListener("abort",q),a.removeListener("request",r),a.req&&a.req.removeListener("finish",n),a.removeListener("end",m),a.removeListener("close",m),a.removeListener("finish",n),a.removeListener("exit",p),a.removeListener("end",o),a.removeListener("error",c),a.removeListener("close",q)}};b.exports=h},{once:135}],70:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],71:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],72:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":74,"./_stream_writable":76,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],73:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":75,"core-util-is":54,dup:12,inherits:87}],74:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":72,"./internal/streams/BufferList":77,"./internal/streams/stream":78,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:71,"process-nextick-args":140,"string_decoder/":80,util:36}],75:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":72,"core-util-is":54,dup:14,inherits:87}],76:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":72,"./internal/streams/stream":78,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],77:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],78:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],79:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":72,"./lib/_stream_passthrough.js":73,"./lib/_stream_readable.js":74,"./lib/_stream_transform.js":75,"./lib/_stream_writable.js":76,dup:18}],80:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],81:[function(a,b,c){function d(a,b){var c=this;return this instanceof d?(b=b||{},e.call(this,b),this._offset=0,this._ready=!1,this._file=a,this._size=a.size,this._chunkSize=b.chunkSize||Math.max(this._size/1e3,204800),this.reader=new FileReader,void this._generateHeaderBlocks(a,b,function(a,b){return a?c.emit("error",a):(Array.isArray(b)&&b.forEach(function(a){c.push(a)}),c._ready=!0,void c.emit("_ready"))})):new d(a,b)}var e=a("readable-stream").Readable,f=a("inherits"),g=a("typedarray-to-buffer");f(d,e),b.exports=d,d.prototype._generateHeaderBlocks=function(a,b,c){c(null,[])},d.prototype._read=function(){if(!this._ready)return void this.once("_ready",this._read.bind(this));var a=this,b=this.reader,c=this._offset,d=this._offset+this._chunkSize;return d>this._size&&(d=this._size),c===this._size?(this.destroy(),void this.push(null)):(b.onload=function(){a._offset=d,a.push(g(b.result))},b.onerror=function(){a.emit("error",b.error)},void b.readAsArrayBuffer(this._file.slice(c,d)))},d.prototype.destroy=function(){if(this._file=null,this.reader){this.reader.onload=null,this.reader.onerror=null;try{this.reader.abort()}catch(a){}}this.reader=null}},{inherits:87,"readable-stream":79,"typedarray-to-buffer":212}],82:[function(a,b,c){b.exports=function(a,b){function c(a,d){return a.reduce(function(a,e){return Array.isArray(e)&&b>d?a.concat(c(e,d+1)):a.concat(e)},[])}return b="number"==typeof b?b:1/0,b?c(a,1):Array.isArray(a)?a.map(function(a){return a}):a}},{}],83:[function(a,b,c){b.exports=function(){if("undefined"==typeof window)return null;var a={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return a.RTCPeerConnection?a:null}},{}],84:[function(a,b,c){var d=a("http"),e=b.exports;for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);e.request=function(a,b){return a||(a={}),a.scheme="https",a.protocol="https:",d.request.call(this,a,b)}},{http:191}],85:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],86:[function(a,b,c){(function(a){function c(a){if(!(this instanceof c))return new c(a);if(this.store=a,this.chunkLength=a.chunkLength,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.mem=[]}function d(b,c,d){a.nextTick(function(){b&&b(c,d)})}b.exports=c,c.prototype.put=function(a,b,c){var d=this;d.mem[a]=b,d.store.put(a,b,function(b){d.mem[a]=null,c&&c(b)})},c.prototype.get=function(a,b,c){if("function"==typeof b)return this.get(a,null,b);var e=b&&b.offset||0,f=b&&b.length&&e+b.length,g=this.mem[a];return g?d(c,null,b?g.slice(e,f):g):void this.store.get(a,b,c)},c.prototype.close=function(a){this.store.close(a)},c.prototype.destroy=function(a){this.store.destroy(a)}}).call(this,a("_process"))},{_process:141}],87:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],88:[function(a,b,c){var d=127;b.exports=function(a){for(var b=0,c=a.length;c>b;++b)if(a.charCodeAt(b)>d)return!1;return!0}},{}],89:[function(a,b,c){function d(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}function e(a){return"function"==typeof a.readFloatLE&&"function"==typeof a.slice&&d(a.slice(0,0))}b.exports=function(a){return null!=a&&(d(a)||e(a)||!!a._isBuffer)}},{}],90:[function(a,b,c){function d(a){return e.existsSync(a)&&e.statSync(a).isFile()}var e=a("fs");b.exports=function(a,b){return b?void e.stat(a,function(a,c){return a?b(a):b(null,c.isFile())}):d(a)},b.exports.sync=d},{fs:37}],91:[function(a,b,c){function d(a){return e(a)||f(a)}function e(a){return a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array}function f(a){return h[g.call(a)]}b.exports=d,d.strict=e,d.loose=f;var g=Object.prototype.toString,h={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0}},{}],92:[function(a,b,c){c.re=/^npm-debug\.log$|^\..*\.swp$|^\.DS_Store$|^\.AppleDouble$|^\.LSOverride$|^Icon\r$|^\._.*|^\.Spotlight-V100$|\.Trashes|^__MACOSX$|~$|^Thumbs\.db$|^ehthumbs\.db$|^Desktop\.ini$/,c.is=function(a){return c.re.test(a)},c.not=c.isnt=function(a){return!c.is(a)}},{}],93:[function(a,b,c){function d(a){var b={},c=a.split("magnet:?")[1],d=c&&c.length>=0?c.split("&"):[];d.forEach(function(a){var c=a.split("=");if(2===c.length){var d=c[0],e=c[1];if("dn"===d&&(e=decodeURIComponent(e).replace(/\+/g," ")),("tr"===d||"xs"===d||"as"===d||"ws"===d)&&(e=decodeURIComponent(e)),"kt"===d&&(e=decodeURIComponent(e).split("+")),"ix"===d&&(e=Number(e)),b[d])if(Array.isArray(b[d]))b[d].push(e);else{var f=b[d];b[d]=[f,e]}else b[d]=e}});var e;if(b.xt){var h=Array.isArray(b.xt)?b.xt:[b.xt];h.forEach(function(a){if(e=a.match(/^urn:btih:(.{40})/))b.infoHash=e[1].toLowerCase();else if(e=a.match(/^urn:btih:(.{32})/)){var c=f.decode(e[1]);b.infoHash=g.from(c,"binary").toString("hex")}})}return b.infoHash&&(b.infoHashBuffer=g.from(b.infoHash,"hex")),b.dn&&(b.name=b.dn),b.kt&&(b.keywords=b.kt),"string"==typeof b.tr?b.announce=[b.tr]:Array.isArray(b.tr)?b.announce=b.tr:b.announce=[],b.urlList=[],("string"==typeof b.as||Array.isArray(b.as))&&(b.urlList=b.urlList.concat(b.as)),("string"==typeof b.ws||Array.isArray(b.ws))&&(b.urlList=b.urlList.concat(b.ws)),i(b.announce),i(b.urlList),b}function e(a){a=h(a),a.infoHashBuffer&&(a.xt="urn:btih:"+a.infoHashBuffer.toString("hex")),a.infoHash&&(a.xt="urn:btih:"+a.infoHash),a.name&&(a.dn=a.name),a.keywords&&(a.kt=a.keywords),a.announce&&(a.tr=a.announce),a.urlList&&(a.ws=a.urlList,delete a.as);var b="magnet:?";return Object.keys(a).filter(function(a){return 2===a.length}).forEach(function(c,d){var e=Array.isArray(a[c])?a[c]:[a[c]];e.forEach(function(a,e){!(d>0||e>0)||"kt"===c&&0!==e||(b+="&"),"dn"===c&&(a=encodeURIComponent(a).replace(/%20/g,"+")),("tr"===c||"xs"===c||"as"===c||"ws"===c)&&(a=encodeURIComponent(a)),"kt"===c&&(a=encodeURIComponent(a)),b+="kt"===c&&e>0?"+"+a:c+"="+a})}),b}b.exports=d,b.exports.decode=d,b.exports.encode=e;var f=a("thirty-two"),g=a("safe-buffer").Buffer,h=a("xtend"),i=a("uniq")},{"safe-buffer":164,"thirty-two":207,uniq:214,xtend:243}],94:[function(a,b,c){function d(a,b){var c=this;if(!(c instanceof d))return new d(a,b);if(!i)throw new Error("web browser lacks MediaSource support");b||(b={}),c._bufferDuration=b.bufferDuration||j,c._elem=a,c._mediaSource=new i,c._streams=[],c.detailedError=null,c._errorHandler=function(){c._elem.removeEventListener("error",c._errorHandler);var a=c._streams.slice();a.forEach(function(a){a.destroy(c._elem.error)})},c._elem.addEventListener("error",c._errorHandler),c._elem.src=window.URL.createObjectURL(c._mediaSource)}function e(a,b){var c=this;if(g.Writable.call(c),c._wrapper=a,c._elem=a._elem,c._mediaSource=a._mediaSource,c._allStreams=a._streams,c._allStreams.push(c),c._bufferDuration=a._bufferDuration,c._sourceBuffer=null,c._openHandler=function(){c._onSourceOpen()},c._flowHandler=function(){c._flow()},"string"==typeof b)c._type=b,"open"===c._mediaSource.readyState?c._createSourceBuffer():c._mediaSource.addEventListener("sourceopen",c._openHandler);else if(null===b._sourceBuffer)b.destroy(),c._type=b._type,c._mediaSource.addEventListener("sourceopen",c._openHandler);else{if(!b._sourceBuffer)throw new Error("The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function");b.destroy(),c._type=b._type,c._sourceBuffer=b._sourceBuffer,c._sourceBuffer.addEventListener("updateend",c._flowHandler)}c._elem.addEventListener("timeupdate",c._flowHandler),c.on("error",function(a){c._wrapper.error(a)}),c.on("finish",function(){if(!c.destroyed&&(c._finished=!0,c._allStreams.every(function(a){return a._finished})))try{c._mediaSource.endOfStream()}catch(a){}})}b.exports=d;var f=a("inherits"),g=a("readable-stream"),h=a("to-arraybuffer"),i="undefined"!=typeof window&&window.MediaSource,j=60;d.prototype.createWriteStream=function(a){var b=this;return new e(b,a)},d.prototype.error=function(a){var b=this;b.detailedError||(b.detailedError=a);try{b._mediaSource.endOfStream("decode")}catch(a){}},f(e,g.Writable),e.prototype._onSourceOpen=function(){var a=this;a.destroyed||(a._mediaSource.removeEventListener("sourceopen",a._openHandler),a._createSourceBuffer())},e.prototype.destroy=function(a){var b=this;b.destroyed||(b.destroyed=!0,b._allStreams.splice(b._allStreams.indexOf(b),1),b._mediaSource.removeEventListener("sourceopen",b._openHandler),b._elem.removeEventListener("timeupdate",b._flowHandler),b._sourceBuffer&&(b._sourceBuffer.removeEventListener("updateend",b._flowHandler),"open"===b._mediaSource.readyState&&b._sourceBuffer.abort()),a&&b.emit("error",a),b.emit("close"))},e.prototype._createSourceBuffer=function(){var a=this;if(!a.destroyed)if(i.isTypeSupported(a._type)){if(a._sourceBuffer=a._mediaSource.addSourceBuffer(a._type),a._sourceBuffer.addEventListener("updateend",a._flowHandler),a._cb){var b=a._cb;a._cb=null,b()}}else a.destroy(new Error("The provided type is not supported"))},e.prototype._write=function(a,b,c){var d=this;if(!d.destroyed){if(!d._sourceBuffer)return void(d._cb=function(e){return e?c(e):void d._write(a,b,c)});if(d._sourceBuffer.updating)return c(new Error("Cannot append buffer while source buffer updating"));try{d._sourceBuffer.appendBuffer(h(a))}catch(e){return void d.destroy(e)}d._cb=c}},e.prototype._flow=function(){var a=this;if(!a.destroyed&&a._sourceBuffer&&!a._sourceBuffer.updating&&!("open"===a._mediaSource.readyState&&a._getBufferDuration()>a._bufferDuration)&&a._cb){var b=a._cb;a._cb=null,b()}};var k=0;e.prototype._getBufferDuration=function(){for(var a=this,b=a._sourceBuffer.buffered,c=a._elem.currentTime,d=-1,e=0;e<b.length;e++){var f=b.start(e),g=b.end(e)+k;if(f>c)break;(d>=0||g>=c)&&(d=g)}var h=d-c;return 0>h&&(h=0),h}},{inherits:87,"readable-stream":103,"to-arraybuffer":209}],95:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],96:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":98,"./_stream_writable":100,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],97:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":99,"core-util-is":54,dup:12,inherits:87}],98:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":96,"./internal/streams/BufferList":101,"./internal/streams/stream":102,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:95,"process-nextick-args":140,"string_decoder/":104,util:36}],99:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":96,"core-util-is":54,dup:14,inherits:87}],100:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":96,"./internal/streams/stream":102,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],101:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],102:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],103:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":96,"./lib/_stream_passthrough.js":97,"./lib/_stream_readable.js":98,"./lib/_stream_transform.js":99,"./lib/_stream_writable.js":100,dup:18}],104:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],105:[function(a,b,c){(function(a){function c(a,b){if(!(this instanceof c))return new c(a,b);if(b||(b={}),this.chunkLength=Number(a),!this.chunkLength)throw new Error("First argument must be a chunk length");this.chunks=[],this.closed=!1,this.length=Number(b.length)||1/0,this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}function d(b,c,d){a.nextTick(function(){b&&b(c,d)})}b.exports=c,c.prototype.put=function(a,b,c){if(this.closed)return d(c,new Error("Storage is closed"));var e=a===this.lastChunkIndex;return e&&b.length!==this.lastChunkLength?d(c,new Error("Last chunk length must be "+this.lastChunkLength)):e||b.length===this.chunkLength?(this.chunks[a]=b,void d(c,null)):d(c,new Error("Chunk length must be "+this.chunkLength))},c.prototype.get=function(a,b,c){if("function"==typeof b)return this.get(a,null,b);if(this.closed)return d(c,new Error("Storage is closed"));var e=this.chunks[a];if(!e)return d(c,new Error("Chunk not found"));if(!b)return d(c,null,e);var f=b.offset||0,g=b.length||e.length-f;d(c,null,e.slice(f,g+f))},c.prototype.close=c.prototype.destroy=function(a){return this.closed?d(a,new Error("Storage is closed")):(this.closed=!0,this.chunks=null,void d(a,null))}}).call(this,a("_process"))},{_process:141}],106:[function(a,b,c){(function(b){function d(a,b,c){for(var d=b;c>d;d++)a[d]=0}function e(a,b,c){b.writeUInt32BE(Math.floor((a.getTime()+q)/1e3),c)}function f(a,b,c){b.writeUInt16BE(Math.floor(a)%65536,c),b.writeUInt16BE(Math.floor(256*a*256)%65536,c+2)}function g(a,b,c){b[c]=Math.floor(a)%256,b[c+1]=Math.floor(256*a)%256}function h(a,b,c){a||(a=[0,0,0,0,0,0,0,0,0]);for(var d=0;d<a.length;d++)f(a[d],b,c+4*d)}function i(a,c,d){var e=new b(a,"utf8");e.copy(c,d),c[d+e.length]=0}function j(a){for(var b=new Array(a.length/4),c=0;c<b.length;c++)b[c]=l(a,4*c);return b}function k(a,b){return new Date(1e3*a.readUInt32BE(b)-q)}function l(a,b){return a.readUInt16BE(b)+a.readUInt16BE(b+2)/65536}function m(a,b){return a[b]+a[b+1]/256}function n(a,b,c){var d;for(d=0;c>d&&0!==a[b+d];d++);return a.toString("utf8",b,b+d)}var o=a("./index"),p=a("./descriptor"),q=20828448e5;c.fullBoxes={};var r=["mvhd","tkhd","mdhd","vmhd","smhd","stsd","esds","stsz","stco","stss","stts","ctts","stsc","dref","elst","hdlr","mehd","trex","mfhd","tfhd","tfdt","trun"];r.forEach(function(a){c.fullBoxes[a]=!0}),c.ftyp={},c.ftyp.encode=function(a,d,e){d=d?d.slice(e):new b(c.ftyp.encodingLength(a));var f=a.compatibleBrands||[];d.write(a.brand,0,4,"ascii"),d.writeUInt32BE(a.brandVersion,4);for(var g=0;g<f.length;g++)d.write(f[g],8+4*g,4,"ascii");return c.ftyp.encode.bytes=8+4*f.length,d},c.ftyp.decode=function(a,b){a=a.slice(b);for(var c=a.toString("ascii",0,4),d=a.readUInt32BE(4),e=[],f=8;f<a.length;f+=4)e.push(a.toString("ascii",f,f+4));return{brand:c,brandVersion:d,compatibleBrands:e}},c.ftyp.encodingLength=function(a){return 8+4*(a.compatibleBrands||[]).length},c.mvhd={},c.mvhd.encode=function(a,i,j){return i=i?i.slice(j):new b(96),e(a.ctime||new Date,i,0),e(a.mtime||new Date,i,4),i.writeUInt32BE(a.timeScale||0,8),i.writeUInt32BE(a.duration||0,12),f(a.preferredRate||0,i,16),g(a.preferredVolume||0,i,20),d(i,22,32),h(a.matrix,i,32),i.writeUInt32BE(a.previewTime||0,68),i.writeUInt32BE(a.previewDuration||0,72),i.writeUInt32BE(a.posterTime||0,76),i.writeUInt32BE(a.selectionTime||0,80),i.writeUInt32BE(a.selectionDuration||0,84),i.writeUInt32BE(a.currentTime||0,88),i.writeUInt32BE(a.nextTrackId||0,92),c.mvhd.encode.bytes=96,i},c.mvhd.decode=function(a,b){return a=a.slice(b),{ctime:k(a,0),mtime:k(a,4),timeScale:a.readUInt32BE(8),duration:a.readUInt32BE(12),preferredRate:l(a,16),preferredVolume:m(a,20),matrix:j(a.slice(32,68)),previewTime:a.readUInt32BE(68),previewDuration:a.readUInt32BE(72),posterTime:a.readUInt32BE(76),selectionTime:a.readUInt32BE(80),selectionDuration:a.readUInt32BE(84),currentTime:a.readUInt32BE(88),nextTrackId:a.readUInt32BE(92)}},c.mvhd.encodingLength=function(a){return 96},c.tkhd={},c.tkhd.encode=function(a,f,g){return f=f?f.slice(g):new b(80),e(a.ctime||new Date,f,0),e(a.mtime||new Date,f,4),f.writeUInt32BE(a.trackId||0,8),d(f,12,16),f.writeUInt32BE(a.duration||0,16),d(f,20,28),f.writeUInt16BE(a.layer||0,28),f.writeUInt16BE(a.alternateGroup||0,30),f.writeUInt16BE(a.volume||0,32),h(a.matrix,f,36),f.writeUInt32BE(a.trackWidth||0,72),f.writeUInt32BE(a.trackHeight||0,76),c.tkhd.encode.bytes=80,f},c.tkhd.decode=function(a,b){return a=a.slice(b),{ctime:k(a,0),mtime:k(a,4),trackId:a.readUInt32BE(8),duration:a.readUInt32BE(16),layer:a.readUInt16BE(28),alternateGroup:a.readUInt16BE(30),volume:a.readUInt16BE(32),matrix:j(a.slice(36,72)),trackWidth:a.readUInt32BE(72),trackHeight:a.readUInt32BE(76)}},c.tkhd.encodingLength=function(a){return 80},c.mdhd={},c.mdhd.encode=function(a,d,f){return d=d?d.slice(f):new b(20),e(a.ctime||new Date,d,0),e(a.mtime||new Date,d,4),d.writeUInt32BE(a.timeScale||0,8),d.writeUInt32BE(a.duration||0,12),d.writeUInt16BE(a.language||0,16),d.writeUInt16BE(a.quality||0,18),c.mdhd.encode.bytes=20,d},c.mdhd.decode=function(a,b){return a=a.slice(b),{ctime:k(a,0),mtime:k(a,4),timeScale:a.readUInt32BE(8),duration:a.readUInt32BE(12),language:a.readUInt16BE(16),quality:a.readUInt16BE(18)}},c.mdhd.encodingLength=function(a){return 20},c.vmhd={},c.vmhd.encode=function(a,d,e){d=d?d.slice(e):new b(8),d.writeUInt16BE(a.graphicsMode||0,0);var f=a.opcolor||[0,0,0];return d.writeUInt16BE(f[0],2),d.writeUInt16BE(f[1],4),d.writeUInt16BE(f[2],6),c.vmhd.encode.bytes=8,d},c.vmhd.decode=function(a,b){return a=a.slice(b),{graphicsMode:a.readUInt16BE(0),opcolor:[a.readUInt16BE(2),a.readUInt16BE(4),a.readUInt16BE(6)]}},c.vmhd.encodingLength=function(a){return 8},c.smhd={},c.smhd.encode=function(a,e,f){return e=e?e.slice(f):new b(4),e.writeUInt16BE(a.balance||0,0),d(e,2,4),c.smhd.encode.bytes=4,e},c.smhd.decode=function(a,b){return a=a.slice(b),{balance:a.readUInt16BE(0)}},c.smhd.encodingLength=function(a){return 4},c.stsd={},c.stsd.encode=function(a,d,e){d=d?d.slice(e):new b(c.stsd.encodingLength(a));var f=a.entries||[];d.writeUInt32BE(f.length,0);for(var g=4,h=0;h<f.length;h++){var i=f[h];o.encode(i,d,g),g+=o.encode.bytes}return c.stsd.encode.bytes=g,d},c.stsd.decode=function(a,b,c){a=a.slice(b);for(var d=a.readUInt32BE(0),e=new Array(d),f=4,g=0;d>g;g++){var h=o.decode(a,f,c);e[g]=h,f+=h.length}return{entries:e}},c.stsd.encodingLength=function(a){var b=4;if(!a.entries)return b;for(var c=0;c<a.entries.length;c++)b+=o.encodingLength(a.entries[c]);return b},c.avc1=c.VisualSampleEntry={},c.VisualSampleEntry.encode=function(a,e,f){e=e?e.slice(f):new b(c.VisualSampleEntry.encodingLength(a)),d(e,0,6),e.writeUInt16BE(a.dataReferenceIndex||0,6),d(e,8,24),e.writeUInt16BE(a.width||0,24),e.writeUInt16BE(a.height||0,26),e.writeUInt32BE(a.hResolution||4718592,28),e.writeUInt32BE(a.vResolution||4718592,32),d(e,36,40),e.writeUInt16BE(a.frameCount||1,40);var g=a.compressorName||"",h=Math.min(g.length,31);e.writeUInt8(h,42),e.write(g,43,h,"utf8"),e.writeUInt16BE(a.depth||24,74),e.writeInt16BE(-1,76);var i=78,j=a.children||[];j.forEach(function(a){o.encode(a,e,i),i+=o.encode.bytes}),c.VisualSampleEntry.encode.bytes=i},c.VisualSampleEntry.decode=function(a,b,c){a=a.slice(b);for(var d=c-b,e=Math.min(a.readUInt8(42),31),f={dataReferenceIndex:a.readUInt16BE(6),width:a.readUInt16BE(24),height:a.readUInt16BE(26),hResolution:a.readUInt32BE(28),vResolution:a.readUInt32BE(32),frameCount:a.readUInt16BE(40),compressorName:a.toString("utf8",43,43+e),depth:a.readUInt16BE(74),children:[]},g=78;d-g>=8;){var h=o.decode(a,g,d);f.children.push(h),f[h.type]=h,g+=h.length}return f},c.VisualSampleEntry.encodingLength=function(a){var b=78,c=a.children||[];return c.forEach(function(a){
b+=o.encodingLength(a)}),b},c.avcC={},c.avcC.encode=function(a,d,e){d=d?d.slice(e):b(a.buffer.length),a.buffer.copy(d),c.avcC.encode.bytes=a.buffer.length},c.avcC.decode=function(a,c,d){return a=a.slice(c,d),{mimeCodec:a.toString("hex",1,4),buffer:new b(a)}},c.avcC.encodingLength=function(a){return a.buffer.length},c.mp4a=c.AudioSampleEntry={},c.AudioSampleEntry.encode=function(a,e,f){e=e?e.slice(f):new b(c.AudioSampleEntry.encodingLength(a)),d(e,0,6),e.writeUInt16BE(a.dataReferenceIndex||0,6),d(e,8,16),e.writeUInt16BE(a.channelCount||2,16),e.writeUInt16BE(a.sampleSize||16,18),d(e,20,24),e.writeUInt32BE(a.sampleRate||0,24);var g=28,h=a.children||[];h.forEach(function(a){o.encode(a,e,g),g+=o.encode.bytes}),c.AudioSampleEntry.encode.bytes=g},c.AudioSampleEntry.decode=function(a,b,c){a=a.slice(b,c);for(var d=c-b,e={dataReferenceIndex:a.readUInt16BE(6),channelCount:a.readUInt16BE(16),sampleSize:a.readUInt16BE(18),sampleRate:a.readUInt32BE(24),children:[]},f=28;d-f>=8;){var g=o.decode(a,f,d);e.children.push(g),e[g.type]=g,f+=g.length}return e},c.AudioSampleEntry.encodingLength=function(a){var b=28,c=a.children||[];return c.forEach(function(a){b+=o.encodingLength(a)}),b},c.esds={},c.esds.encode=function(a,d,e){d=d?d.slice(e):b(a.buffer.length),a.buffer.copy(d,0),c.esds.encode.bytes=a.buffer.length},c.esds.decode=function(a,c,d){a=a.slice(c,d);var e=p.Descriptor.decode(a,0,a.length),f="ESDescriptor"===e.tagName?e:{},g=f.DecoderConfigDescriptor||{},h=g.oti||0,i=g.DecoderSpecificInfo,j=i?(248&i.buffer.readUInt8(0))>>3:0,k=null;return h&&(k=h.toString(16),j&&(k+="."+j)),{mimeCodec:k,buffer:new b(a.slice(0))}},c.esds.encodingLength=function(a){return a.buffer.length},c.stsz={},c.stsz.encode=function(a,d,e){var f=a.entries||[];d=d?d.slice(e):b(c.stsz.encodingLength(a)),d.writeUInt32BE(0,0),d.writeUInt32BE(f.length,4);for(var g=0;g<f.length;g++)d.writeUInt32BE(f[g],4*g+8);return c.stsz.encode.bytes=8+4*f.length,d},c.stsz.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=a.readUInt32BE(4),e=new Array(d),f=0;d>f;f++)0===c?e[f]=a.readUInt32BE(4*f+8):e[f]=c;return{entries:e}},c.stsz.encodingLength=function(a){return 8+4*a.entries.length},c.stss=c.stco={},c.stco.encode=function(a,d,e){var f=a.entries||[];d=d?d.slice(e):new b(c.stco.encodingLength(a)),d.writeUInt32BE(f.length,0);for(var g=0;g<f.length;g++)d.writeUInt32BE(f[g],4*g+4);return c.stco.encode.bytes=4+4*f.length,d},c.stco.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=new Array(c),e=0;c>e;e++)d[e]=a.readUInt32BE(4*e+4);return{entries:d}},c.stco.encodingLength=function(a){return 4+4*a.entries.length},c.stts={},c.stts.encode=function(a,d,e){var f=a.entries||[];d=d?d.slice(e):new b(c.stts.encodingLength(a)),d.writeUInt32BE(f.length,0);for(var g=0;g<f.length;g++){var h=8*g+4;d.writeUInt32BE(f[g].count||0,h),d.writeUInt32BE(f[g].duration||0,h+4)}return c.stts.encode.bytes=4+8*a.entries.length,d},c.stts.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=new Array(c),e=0;c>e;e++){var f=8*e+4;d[e]={count:a.readUInt32BE(f),duration:a.readUInt32BE(f+4)}}return{entries:d}},c.stts.encodingLength=function(a){return 4+8*a.entries.length},c.ctts={},c.ctts.encode=function(a,d,e){var f=a.entries||[];d=d?d.slice(e):new b(c.ctts.encodingLength(a)),d.writeUInt32BE(f.length,0);for(var g=0;g<f.length;g++){var h=8*g+4;d.writeUInt32BE(f[g].count||0,h),d.writeUInt32BE(f[g].compositionOffset||0,h+4)}return c.ctts.encode.bytes=4+8*f.length,d},c.ctts.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=new Array(c),e=0;c>e;e++){var f=8*e+4;d[e]={count:a.readUInt32BE(f),compositionOffset:a.readInt32BE(f+4)}}return{entries:d}},c.ctts.encodingLength=function(a){return 4+8*a.entries.length},c.stsc={},c.stsc.encode=function(a,d,e){var f=a.entries||[];d=d?d.slice(e):new b(c.stsc.encodingLength(a)),d.writeUInt32BE(f.length,0);for(var g=0;g<f.length;g++){var h=12*g+4;d.writeUInt32BE(f[g].firstChunk||0,h),d.writeUInt32BE(f[g].samplesPerChunk||0,h+4),d.writeUInt32BE(f[g].sampleDescriptionId||0,h+8)}return c.stsc.encode.bytes=4+12*f.length,d},c.stsc.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=new Array(c),e=0;c>e;e++){var f=12*e+4;d[e]={firstChunk:a.readUInt32BE(f),samplesPerChunk:a.readUInt32BE(f+4),sampleDescriptionId:a.readUInt32BE(f+8)}}return{entries:d}},c.stsc.encodingLength=function(a){return 4+12*a.entries.length},c.dref={},c.dref.encode=function(a,d,e){d=d?d.slice(e):new b(c.dref.encodingLength(a));var f=a.entries||[];d.writeUInt32BE(f.length,0);for(var g=4,h=0;h<f.length;h++){var i=f[h],j=(i.buf?i.buf.length:0)+4+4;d.writeUInt32BE(j,g),g+=4,d.write(i.type,g,4,"ascii"),g+=4,i.buf&&(i.buf.copy(d,g),g+=i.buf.length)}return c.dref.encode.bytes=g,d},c.dref.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=new Array(c),e=4,f=0;c>f;f++){var g=a.readUInt32BE(e),h=a.toString("ascii",e+4,e+8),i=a.slice(e+8,e+g);e+=g,d[f]={type:h,buf:i}}return{entries:d}},c.dref.encodingLength=function(a){var b=4;if(!a.entries)return b;for(var c=0;c<a.entries.length;c++){var d=a.entries[c].buf;b+=(d?d.length:0)+4+4}return b},c.elst={},c.elst.encode=function(a,d,e){var g=a.entries||[];d=d?d.slice(e):new b(c.elst.encodingLength(a)),d.writeUInt32BE(g.length,0);for(var h=0;h<g.length;h++){var i=12*h+4;d.writeUInt32BE(g[h].trackDuration||0,i),d.writeUInt32BE(g[h].mediaTime||0,i+4),f(g[h].mediaRate||0,d,i+8)}return c.elst.encode.bytes=4+12*g.length,d},c.elst.decode=function(a,b){a=a.slice(b);for(var c=a.readUInt32BE(0),d=new Array(c),e=0;c>e;e++){var f=12*e+4;d[e]={trackDuration:a.readUInt32BE(f),mediaTime:a.readInt32BE(f+4),mediaRate:l(a,f+8)}}return{entries:d}},c.elst.encodingLength=function(a){return 4+12*a.entries.length},c.hdlr={},c.hdlr.encode=function(a,d,e){d=d?d.slice(e):new b(c.hdlr.encodingLength(a));var f=21+(a.name||"").length;return d.fill(0,0,f),d.write(a.handlerType||"",4,4,"ascii"),i(a.name||"",d,20),c.hdlr.encode.bytes=f,d},c.hdlr.decode=function(a,b,c){return a=a.slice(b),{handlerType:a.toString("ascii",4,8),name:n(a,20,c)}},c.hdlr.encodingLength=function(a){return 21+(a.name||"").length},c.mehd={},c.mehd.encode=function(a,d,e){return d=d?d.slice(e):new b(4),d.writeUInt32BE(a.fragmentDuration||0,0),c.mehd.encode.bytes=4,d},c.mehd.decode=function(a,b){return a=a.slice(b),{fragmentDuration:a.readUInt32BE(0)}},c.mehd.encodingLength=function(a){return 4},c.trex={},c.trex.encode=function(a,d,e){return d=d?d.slice(e):new b(20),d.writeUInt32BE(a.trackId||0,0),d.writeUInt32BE(a.defaultSampleDescriptionIndex||0,4),d.writeUInt32BE(a.defaultSampleDuration||0,8),d.writeUInt32BE(a.defaultSampleSize||0,12),d.writeUInt32BE(a.defaultSampleFlags||0,16),c.trex.encode.bytes=20,d},c.trex.decode=function(a,b){return a=a.slice(b),{trackId:a.readUInt32BE(0),defaultSampleDescriptionIndex:a.readUInt32BE(4),defaultSampleDuration:a.readUInt32BE(8),defaultSampleSize:a.readUInt32BE(12),defaultSampleFlags:a.readUInt32BE(16)}},c.trex.encodingLength=function(a){return 20},c.mfhd={},c.mfhd.encode=function(a,d,e){return d=d?d.slice(e):new b(4),d.writeUInt32BE(a.sequenceNumber||0,0),c.mfhd.encode.bytes=4,d},c.mfhd.decode=function(a,b){return{sequenceNumber:a.readUint32BE(0)}},c.mfhd.encodingLength=function(a){return 4},c.tfhd={},c.tfhd.encode=function(a,d,e){return d=d?d.slice(e):new b(4),d.writeUInt32BE(a.trackId,0),c.tfhd.encode.bytes=4,d},c.tfhd.decode=function(a,b){},c.tfhd.encodingLength=function(a){return 4},c.tfdt={},c.tfdt.encode=function(a,d,e){return d=d?d.slice(e):new b(4),d.writeUInt32BE(a.baseMediaDecodeTime||0,0),c.tfdt.encode.bytes=4,d},c.tfdt.decode=function(a,b){},c.tfdt.encodingLength=function(a){return 4},c.trun={},c.trun.encode=function(a,d,e){d=d?d.slice(e):new b(8+16*a.entries.length),d.writeUInt32BE(a.entries.length,0),d.writeInt32BE(a.dataOffset,4);for(var f=8,g=0;g<a.entries.length;g++){var h=a.entries[g];d.writeUInt32BE(h.sampleDuration,f),f+=4,d.writeUInt32BE(h.sampleSize,f),f+=4,d.writeUInt32BE(h.sampleFlags,f),f+=4,d.writeUInt32BE(h.sampleCompositionTimeOffset,f),f+=4}c.trun.encode.bytes=f},c.trun.decode=function(a,b){},c.trun.encodingLength=function(a){return 8+16*a.entries.length},c.mdat={},c.mdat.encode=function(a,b,d){a.buffer?(a.buffer.copy(b,d),c.mdat.encode.bytes=a.buffer.length):c.mdat.encode.bytes=c.mdat.encodingLength(a)},c.mdat.decode=function(a,c,d){return{buffer:new b(a.slice(c,d))}},c.mdat.encodingLength=function(a){return a.buffer?a.buffer.length:a.contentLength}}).call(this,a("buffer").Buffer)},{"./descriptor":107,"./index":108,buffer:39}],107:[function(a,b,c){(function(a){var b={3:"ESDescriptor",4:"DecoderConfigDescriptor",5:"DecoderSpecificInfo",6:"SLConfigDescriptor"};c.Descriptor={},c.Descriptor.decode=function(d,e,f){var g,h=d.readUInt8(e),i=e+1,j=0;do g=d.readUInt8(i++),j=j<<7|127&g;while(128&g);var k,l=b[h];return k=c[l]?c[l].decode(d,i,f):{buffer:new a(d.slice(i,i+j))},k.tag=h,k.tagName=l,k.length=i-e+j,k.contentsLen=j,k},c.DescriptorArray={},c.DescriptorArray.decode=function(a,d,e){for(var f=d,g={};e>=f+2;){var h=c.Descriptor.decode(a,f,e);f+=h.length;var i=b[h.tag]||"Descriptor"+h.tag;g[i]=h}return g},c.ESDescriptor={},c.ESDescriptor.decode=function(a,b,d){var e=a.readUInt8(b+2),f=b+3;if(128&e&&(f+=2),64&e){var g=a.readUInt8(f);f+=g+1}return 32&e&&(f+=2),c.DescriptorArray.decode(a,f,d)},c.DecoderConfigDescriptor={},c.DecoderConfigDescriptor.decode=function(a,b,d){var e=a.readUInt8(b),f=c.DescriptorArray.decode(a,b+13,d);return f.oti=e,f}}).call(this,a("buffer").Buffer)},{buffer:39}],108:[function(a,b,c){(function(b){var d=a("uint64be"),e=a("./boxes"),f=4294967295,g=c,h=c.containers={moov:["mvhd","meta","traks","mvex"],trak:["tkhd","tref","trgr","edts","meta","mdia","udta"],edts:["elst"],mdia:["mdhd","hdlr","elng","minf"],minf:["vmhd","smhd","hmhd","sthd","nmhd","dinf","stbl"],dinf:["dref"],stbl:["stsd","stts","ctts","cslg","stsc","stsz","stz2","stco","co64","stss","stsh","padb","stdp","sdtp","sbgps","sgpds","subss","saizs","saios"],mvex:["mehd","trexs","leva"],moof:["mfhd","meta","trafs"],traf:["tfhd","trun","sbgps","sgpds","subss","saizs","saios","tfdt","meta"]};g.encode=function(a,c,d){return g.encodingLength(a),d=d||0,c=c||new b(a.length),g._encode(a,c,d)},g._encode=function(a,b,c){var i=a.type,j=a.length;j>f&&(j=1),b.writeUInt32BE(j,c),b.write(a.type,c+4,4,"ascii");var k=c+8;if(1===j&&(d.encode(a.length,b,k),k+=8),e.fullBoxes[i]&&(b.writeUInt32BE(a.flags||0,k),b.writeUInt8(a.version||0,k),k+=4),h[i]){var l=h[i];l.forEach(function(c){if(5===c.length){var d=a[c]||[];c=c.substr(0,4),d.forEach(function(a){g._encode(a,b,k),k+=g.encode.bytes})}else a[c]&&(g._encode(a[c],b,k),k+=g.encode.bytes)}),a.otherBoxes&&a.otherBoxes.forEach(function(a){g._encode(a,b,k),k+=g.encode.bytes})}else if(e[i]){var m=e[i].encode;m(a,b,k),k+=m.bytes}else{if(!a.buffer)throw new Error("Either `type` must be set to a known type (not'"+i+"') or `buffer` must be set");var n=a.buffer;n.copy(b,k),k+=a.buffer.length}return g.encode.bytes=k-c,b},g.readHeaders=function(a,b,c){if(b=b||0,c=c||a.length,8>c-b)return 8;var f=a.readUInt32BE(b),g=a.toString("ascii",b+4,b+8),h=b+8;if(1===f){if(16>c-b)return 16;f=d.decode(a,h),h+=8}var i,j;return e.fullBoxes[g]&&(i=a.readUInt8(h),j=16777215&a.readUInt32BE(h),h+=4),{length:f,headersLen:h-b,contentLen:f-(h-b),type:g,version:i,flags:j}},g.decode=function(a,b,c){b=b||0,c=c||a.length;var d=g.readHeaders(a,b,c);if(!d||d.length>c-b)throw new Error("Data too short");return g.decodeWithoutHeaders(d,a,b+d.headersLen,b+d.length)},g.decodeWithoutHeaders=function(a,c,d,f){d=d||0,f=f||c.length;var i=a.type,j={};if(h[i]){j.otherBoxes=[];for(var k=h[i],l=d;f-l>=8;){var m=g.decode(c,l,f);if(l+=m.length,k.indexOf(m.type)>=0)j[m.type]=m;else if(k.indexOf(m.type+"s")>=0){var n=m.type+"s",o=j[n]=j[n]||[];o.push(m)}else j.otherBoxes.push(m)}}else if(e[i]){var p=e[i].decode;j=p(c,d,f)}else j.buffer=new b(c.slice(d,f));return j.length=a.length,j.contentLen=a.contentLen,j.type=a.type,j.version=a.version,j.flags=a.flags,j},g.encodingLength=function(a){var b=a.type,c=8;if(e.fullBoxes[b]&&(c+=4),h[b]){var d=h[b];d.forEach(function(b){if(5===b.length){var d=a[b]||[];b=b.substr(0,4),d.forEach(function(a){a.type=b,c+=g.encodingLength(a)})}else if(a[b]){var e=a[b];e.type=b,c+=g.encodingLength(e)}}),a.otherBoxes&&a.otherBoxes.forEach(function(a){c+=g.encodingLength(a)})}else if(e[b])c+=e[b].encodingLength(a);else{if(!a.buffer)throw new Error("Either `type` must be set to a known type (not'"+b+"') or `buffer` must be set");c+=a.buffer.length}return c>f&&(c+=8),a.length=c,c}}).call(this,a("buffer").Buffer)},{"./boxes":106,buffer:39,uint64be:213}],109:[function(a,b,c){(function(c){function d(){return this instanceof d?(f.Writable.call(this),this.destroyed=!1,this._pending=0,this._missing=0,this._buf=null,this._str=null,this._cb=null,this._ondrain=null,this._writeBuffer=null,this._writeCb=null,this._ondrain=null,void this._kick()):new d}function e(a){this._parent=a,this.destroyed=!1,f.PassThrough.call(this)}var f=a("readable-stream"),g=a("inherits"),h=a("next-event"),i=a("mp4-box-encoding"),j=new c(0);b.exports=d,g(d,f.Writable),d.prototype.destroy=function(a){this.destroyed||(this.destroyed=!0,a&&this.emit("error",a),this.emit("close"))},d.prototype._write=function(a,b,c){if(!this.destroyed){for(var d=!this._str||!this._str._writableState.needDrain;a.length&&!this.destroyed;){if(!this._missing)return this._writeBuffer=a,void(this._writeCb=c);var e=a.length<this._missing?a.length:this._missing;if(this._buf?a.copy(this._buf,this._buf.length-this._missing):this._str&&(d=this._str.write(e===a.length?a:a.slice(0,e))),this._missing-=e,!this._missing){var f=this._buf,g=this._cb,h=this._str;this._buf=this._cb=this._str=this._ondrain=null,d=!0,h&&h.end(),g&&g(f)}a=e===a.length?j:a.slice(e)}return this._pending&&!this._missing?(this._writeBuffer=a,void(this._writeCb=c)):void(d?c():this._ondrain(c))}},d.prototype._buffer=function(a,b){this._missing=a,this._buf=new c(a),this._cb=b},d.prototype._stream=function(a,b){var c=this;return this._missing=a,this._str=new e(this),this._ondrain=h(this._str,"drain"),this._pending++,this._str.on("end",function(){c._pending--,c._kick()}),this._cb=b,this._str},d.prototype._readBox=function(){function a(d,e){b._buffer(d,function(d){e=e?c.concat([e,d]):d;var f=i.readHeaders(e);"number"==typeof f?a(f-e.length,e):(b._pending++,b._headers=f,b.emit("box",f))})}var b=this;a(8)},d.prototype.stream=function(){var a=this;if(!a._headers)throw new Error("this function can only be called once after 'box' is emitted");var b=a._headers;return a._headers=null,a._stream(b.contentLen,null)},d.prototype.decode=function(a){var b=this;if(!b._headers)throw new Error("this function can only be called once after 'box' is emitted");var c=b._headers;b._headers=null,b._buffer(c.contentLen,function(d){var e=i.decodeWithoutHeaders(c,d);a(e),b._pending--,b._kick()})},d.prototype.ignore=function(){var a=this;if(!a._headers)throw new Error("this function can only be called once after 'box' is emitted");var b=a._headers;a._headers=null,this._missing=b.contentLen,this._cb=function(){a._pending--,a._kick()}},d.prototype._kick=function(){if(!this._pending&&(this._buf||this._str||this._readBox(),this._writeBuffer)){var a=this._writeCb,b=this._writeBuffer;this._writeBuffer=null,this._writeCb=null,this._write(b,null,a)}},g(e,f.PassThrough),e.prototype.destroy=function(a){this.destroyed||(this.destroyed=!0,this._parent.destroy(a),a&&this.emit("error",a),this.emit("close"))}}).call(this,a("buffer").Buffer)},{buffer:39,inherits:87,"mp4-box-encoding":108,"next-event":134,"readable-stream":120}],110:[function(a,b,c){(function(c,d){function e(){}function f(){function a(){c._want&&(c._want=!1,c._read())}function b(){c._stream=null}if(!(this instanceof f))return new f;h.Readable.call(this),this.destroyed=!1,this._reading=!1,this._stream=null,this._drain=null,this._want=!1,this._onreadable=a,this._onend=b;var c=this}function g(a){this._parent=a,this.destroyed=!1,h.PassThrough.call(this)}var h=a("readable-stream"),i=a("inherits"),j=a("mp4-box-encoding");b.exports=f,i(f,h.Readable),f.prototype.mediaData=f.prototype.mdat=function(a,b){var c=new g(this);return this.box({type:"mdat",contentLength:a,encodeBufferLen:8,stream:c},b),c},f.prototype.box=function(a,b){if(b||(b=e),this.destroyed)return b(new Error("Encoder is destroyed"));var f;if(a.encodeBufferLen&&(f=new d(a.encodeBufferLen)),a.stream)a.buffer=null,f=j.encode(a,f),this.push(f),this._stream=a.stream,this._stream.on("readable",this._onreadable),this._stream.on("end",this._onend),this._stream.on("end",b),this._forward();else{f=j.encode(a,f);var g=this.push(f);if(g)return c.nextTick(b);this._drain=b}},f.prototype.destroy=function(a){if(!this.destroyed){if(this.destroyed=!0,this._stream&&this._stream.destroy&&this._stream.destroy(),this._stream=null,this._drain){var b=this._drain;this._drain=null,b(a)}a&&this.emit("error",a),this.emit("close")}},f.prototype.finalize=function(){this.push(null)},f.prototype._forward=function(){if(this._stream)for(;!this.destroyed;){var a=this._stream.read();if(!a)return void(this._want=!!this._stream);if(!this.push(a))return}},f.prototype._read=function(){if(!this._reading&&!this.destroyed){if(this._reading=!0,this._stream&&this._forward(),this._drain){var a=this._drain;this._drain=null,a()}this._reading=!1}},i(g,h.PassThrough),g.prototype.destroy=function(a){this.destroyed||(this.destroyed=!0,this._parent.destroy(a),a&&this.emit("error",a),this.emit("close"))}}).call(this,a("_process"),a("buffer").Buffer)},{_process:141,buffer:39,inherits:87,"mp4-box-encoding":108,"readable-stream":120}],111:[function(a,b,c){c.decode=a("./decode"),c.encode=a("./encode")},{"./decode":109,"./encode":110}],112:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],113:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":115,"./_stream_writable":117,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],114:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":116,"core-util-is":54,dup:12,inherits:87}],115:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":113,"./internal/streams/BufferList":118,"./internal/streams/stream":119,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:112,"process-nextick-args":140,"string_decoder/":121,util:36}],116:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":113,"core-util-is":54,dup:14,inherits:87}],117:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":113,"./internal/streams/stream":119,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],118:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],119:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],120:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":113,"./lib/_stream_passthrough.js":114,"./lib/_stream_readable.js":115,"./lib/_stream_transform.js":116,"./lib/_stream_writable.js":117,dup:18}],121:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],122:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],123:[function(a,b,c){function d(a,b){var c=this;return c instanceof d?(g.Readable.call(c,b),c.destroyed=!1,c._drained=!1,c._forwarding=!1,c._current=null,"function"==typeof a?c._queue=a:(c._queue=a.map(e),c._queue.forEach(function(a){"function"!=typeof a&&c._attachErrorListener(a)})),void c._next()):new d(a,b)}function e(a){if(!a||"function"==typeof a||a._readableState)return a;var b=(new g.Readable).wrap(a);return a.destroy&&(b.destroy=a.destroy.bind(a)),b}b.exports=d;var f=a("inherits"),g=a("readable-stream");f(d,g.Readable),d.obj=function(a){return new d(a,{objectMode:!0,highWaterMark:16})},d.prototype._read=function(){this._drained=!0,this._forward()},d.prototype._forward=function(){if(!this._forwarding&&this._drained&&this._current){this._forwarding=!0;for(var a;null!==(a=this._current.read());)this._drained=this.push(a);this._forwarding=!1}},d.prototype.destroy=function(a){this.destroyed||(this.destroyed=!0,this._current&&this._current.destroy&&this._current.destroy(),"function"!=typeof this._queue&&this._queue.forEach(function(a){a.destroy&&a.destroy()}),a&&this.emit("error",a),this.emit("close"))},d.prototype._next=function(){var a=this;if(a._current=null,"function"==typeof a._queue)a._queue(function(b,c){return b?a.destroy(b):(c=e(c),a._attachErrorListener(c),void a._gotNextStream(c))});else{var b=a._queue.shift();"function"==typeof b&&(b=e(b()),a._attachErrorListener(b)),a._gotNextStream(b)}},d.prototype._gotNextStream=function(a){function b(){e._forward()}function c(){a._readableState.ended||e.destroy()}function d(){e._current=null,a.removeListener("readable",b),a.removeListener("end",d),a.removeListener("close",c),e._next()}var e=this;return a?(e._current=a,e._forward(),a.on("readable",b),a.once("end",d),void a.once("close",c)):(e.push(null),void e.destroy())},d.prototype._attachErrorListener=function(a){function b(d){a.removeListener("error",b),c.destroy(d)}var c=this;a&&a.once("error",b)}},{inherits:87,"readable-stream":132}],124:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],125:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":127,"./_stream_writable":129,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],126:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":128,"core-util-is":54,dup:12,inherits:87}],127:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":125,"./internal/streams/BufferList":130,"./internal/streams/stream":131,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:124,"process-nextick-args":140,"string_decoder/":133,util:36}],128:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":125,"core-util-is":54,dup:14,inherits:87}],129:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":125,"./internal/streams/stream":131,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],130:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],131:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],132:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":125,"./lib/_stream_passthrough.js":126,"./lib/_stream_readable.js":127,"./lib/_stream_transform.js":128,"./lib/_stream_writable.js":129,dup:18}],133:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],134:[function(a,b,c){function d(a,b){var c=null;return a.on(b,function(a){if(c){var b=c;c=null,b(a)}}),function(a){c=a}}b.exports=d},{}],135:[function(a,b,c){function d(a){var b=function(){return b.called?b.value:(b.called=!0,b.value=a.apply(this,arguments))};return b.called=!1,b}function e(a){var b=function(){if(b.called)throw new Error(b.onceError);return b.called=!0,b.value=a.apply(this,arguments)},c=a.name||"Function wrapped with `once`";return b.onceError=c+" shouldn't be called more than once",b.called=!1,b}var f=a("wrappy");b.exports=f(d),b.exports.strict=f(e),d.proto=d(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return d(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return e(this)},configurable:!0})})},{wrappy:242}],136:[function(a,b,c){(function(c){function d(a){c.isBuffer(a)&&(a=i.decode(a)),h(a.info,"info"),h(a.info["name.utf-8"]||a.info.name,"info.name"),h(a.info["piece length"],"info['piece length']"),h(a.info.pieces,"info.pieces"),a.info.files?a.info.files.forEach(function(a){h("number"==typeof a.length,"info.files[0].length"),h(a["path.utf-8"]||a.path,"info.files[0].path")}):h("number"==typeof a.info.length,"info.length");var b={};b.info=a.info,b.infoBuffer=i.encode(a.info),b.infoHash=k.sync(b.infoBuffer),b.infoHashBuffer=new c(b.infoHash,"hex"),b.name=(a.info["name.utf-8"]||a.info.name).toString(),void 0!==a.info["private"]&&(b["private"]=!!a.info["private"]),a["creation date"]&&(b.created=new Date(1e3*a["creation date"])),a["created by"]&&(b.createdBy=a["created by"].toString()),c.isBuffer(a.comment)&&(b.comment=a.comment.toString()),b.announce=[],a["announce-list"]&&a["announce-list"].length?a["announce-list"].forEach(function(a){a.forEach(function(a){b.announce.push(a.toString())})}):a.announce&&b.announce.push(a.announce.toString()),c.isBuffer(a["url-list"])&&(a["url-list"]=a["url-list"].length>0?[a["url-list"]]:[]),b.urlList=(a["url-list"]||[]).map(function(a){return a.toString()}),l(b.announce),l(b.urlList);var d=a.info.files||[a.info];b.files=d.map(function(a,c){var e=[].concat(b.name,a["path.utf-8"]||a.path||[]).map(function(a){return a.toString()});return{path:j.join.apply(null,[j.sep].concat(e)).slice(1),name:e[e.length-1],length:a.length,offset:d.slice(0,c).reduce(f,0)}}),b.length=d.reduce(f,0);var e=b.files[b.files.length-1];return b.pieceLength=a.info["piece length"],b.lastPieceLength=(e.offset+e.length)%b.pieceLength||b.pieceLength,b.pieces=g(a.info.pieces),b}function e(a){var b={info:a.info};return b["announce-list"]=(a.announce||[]).map(function(a){return b.announce||(b.announce=a),a=new c(a,"utf8"),[a]}),b["url-list"]=a.urlList||[],a.created&&(b["creation date"]=a.created.getTime()/1e3|0),a.createdBy&&(b["created by"]=a.createdBy),a.comment&&(b.comment=a.comment),i.encode(b)}function f(a,b){return a+b.length}function g(a){for(var b=[],c=0;c<a.length;c+=20)b.push(a.slice(c,c+20).toString("hex"));return b}function h(a,b){if(!a)throw new Error("Torrent is missing required field: "+b)}b.exports=d,b.exports.decode=d,b.exports.encode=e;var i=a("bencode"),j=a("path"),k=a("simple-sha1"),l=a("uniq")}).call(this,a("buffer").Buffer)},{bencode:6,buffer:39,path:138,"simple-sha1":178,uniq:214}],137:[function(a,b,c){(function(c,d){function e(a){if("string"==typeof a&&/^(stream-)?magnet:/.test(a))return k(a);if("string"==typeof a&&(/^[a-f0-9]{40}$/i.test(a)||/^[a-z2-7]{32}$/i.test(a)))return k("magnet:?xt=urn:btih:"+a);if(d.isBuffer(a)&&20===a.length)return k("magnet:?xt=urn:btih:"+a.toString("hex"));if(d.isBuffer(a))return l(a);if(a&&a.infoHash)return a.announce||(a.announce=[]),"string"==typeof a.announce&&(a.announce=[a.announce]),a.urlList||(a.urlList=[]),a;throw new Error("Invalid torrent identifier")}function f(a,b){function d(a){try{f=e(a)}catch(c){return b(c)}f&&f.infoHash?b(null,f):b(new Error("Invalid torrent identifier"))}var f;if("function"!=typeof b)throw new Error("second argument must be a Function");try{f=e(a)}catch(k){}f&&f.infoHash?c.nextTick(function(){b(null,f)}):g(a)?h(a,function(a,c){return a?b(new Error("Error converting Blob: "+a.message)):void d(c)}):"function"==typeof j&&/^https?:/.test(a)?j.concat({url:a,timeout:3e4,headers:{"user-agent":"WebTorrent (http://webtorrent.io)"}},function(a,c,e){return a?b(new Error("Error downloading torrent: "+a.message)):void d(e)}):"function"==typeof i.readFile&&"string"==typeof a?i.readFile(a,function(a,c){return a?b(new Error("Invalid torrent identifier")):void d(c)}):c.nextTick(function(){b(new Error("Invalid torrent identifier"))})}function g(a){return"undefined"!=typeof Blob&&a instanceof Blob}b.exports=e,b.exports.remote=f;var h=a("blob-to-buffer"),i=a("fs"),j=a("simple-get"),k=a("magnet-uri"),l=a("parse-torrent-file");b.exports.toMagnetURI=k.encode,b.exports.toTorrentFile=l.encode,function(){d.alloc(0)}()}).call(this,a("_process"),a("buffer").Buffer)},{_process:141,"blob-to-buffer":24,buffer:39,fs:37,"magnet-uri":93,"parse-torrent-file":136,"simple-get":166}],138:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:141}],139:[function(a,b,c){for(var d=a("closest-to"),e=Math.pow(2,10),f=13,g=[];f++<22;)g.push(Math.pow(2,f));b.exports=function(a){return d(a/e,g)}},{"closest-to":53}],140:[function(a,b,c){(function(a){function c(b,c,d,e){if("function"!=typeof b)throw new TypeError('"callback" argument must be a function');var f,g,h=arguments.length;switch(h){case 0:case 1:return a.nextTick(b);case 2:return a.nextTick(function(){b.call(null,c)});case 3:return a.nextTick(function(){b.call(null,c,d)});case 4:return a.nextTick(function(){b.call(null,c,d,e)});default:for(f=new Array(h-1),g=0;g<f.length;)f[g++]=arguments[g];return a.nextTick(function(){b.apply(null,f)})}}!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?b.exports=c:b.exports=a.nextTick}).call(this,a("_process"))},{_process:141}],141:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);
try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],142:[function(a,b,c){(function(a){!function(d){function e(a){throw new RangeError(H[a])}function f(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function g(a,b){var c=a.split("@"),d="";c.length>1&&(d=c[0]+"@",a=c[1]),a=a.replace(G,".");var e=a.split("."),g=f(e,b).join(".");return d+g}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function i(a){return f(a,function(a){var b="";return a>65535&&(a-=65536,b+=K(a>>>10&1023|55296),a=56320|1023&a),b+=K(a)}).join("")}function j(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:w}function k(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;for(a=c?J(a/A):a>>1,a+=J(a/b);a>I*y>>1;d+=w)a=J(a/I);return J(d+(I+1)*a/(a+z))}function m(a){var b,c,d,f,g,h,k,m,n,o,p=[],q=a.length,r=0,s=C,t=B;for(c=a.lastIndexOf(D),0>c&&(c=0),d=0;c>d;++d)a.charCodeAt(d)>=128&&e("not-basic"),p.push(a.charCodeAt(d));for(f=c>0?c+1:0;q>f;){for(g=r,h=1,k=w;f>=q&&e("invalid-input"),m=j(a.charCodeAt(f++)),(m>=w||m>J((v-r)/h))&&e("overflow"),r+=m*h,n=t>=k?x:k>=t+y?y:k-t,!(n>m);k+=w)o=w-n,h>J(v/o)&&e("overflow"),h*=o;b=p.length+1,t=l(r-g,b,0==g),J(r/b)>v-s&&e("overflow"),s+=J(r/b),r%=b,p.splice(r++,0,s)}return i(p)}function n(a){var b,c,d,f,g,i,j,m,n,o,p,q,r,s,t,u=[];for(a=h(a),q=a.length,b=C,c=0,g=B,i=0;q>i;++i)p=a[i],128>p&&u.push(K(p));for(d=f=u.length,f&&u.push(D);q>d;){for(j=v,i=0;q>i;++i)p=a[i],p>=b&&j>p&&(j=p);for(r=d+1,j-b>J((v-c)/r)&&e("overflow"),c+=(j-b)*r,b=j,i=0;q>i;++i)if(p=a[i],b>p&&++c>v&&e("overflow"),p==b){for(m=c,n=w;o=g>=n?x:n>=g+y?y:n-g,!(o>m);n+=w)t=m-o,s=w-o,u.push(K(k(o+t%s,0))),m=J(t/s);u.push(K(k(m,0))),g=l(c,r,d==f),c=0,++d}++c,++b}return u.join("")}function o(a){return g(a,function(a){return E.test(a)?m(a.slice(4).toLowerCase()):a})}function p(a){return g(a,function(a){return F.test(a)?"xn--"+n(a):a})}var q="object"==typeof c&&c&&!c.nodeType&&c,r="object"==typeof b&&b&&!b.nodeType&&b,s="object"==typeof a&&a;(s.global===s||s.window===s||s.self===s)&&(d=s);var t,u,v=2147483647,w=36,x=1,y=26,z=38,A=700,B=72,C=128,D="-",E=/^xn--/,F=/[^\x20-\x7E]/,G=/[\x2E\u3002\uFF0E\uFF61]/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-x,J=Math.floor,K=String.fromCharCode;if(t={version:"1.4.1",ucs2:{decode:h,encode:i},decode:m,encode:n,toASCII:p,toUnicode:o},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return t});else if(q&&r)if(b.exports==q)r.exports=t;else for(u in t)t.hasOwnProperty(u)&&(q[u]=t[u]);else d.punycode=t}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],143:[function(a,b,c){function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,c,f){b=b||"&",c=c||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;j>k;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(c);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),d(g,n)?e(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],144:[function(a,b,c){function d(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var e=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,c,h){return b=b||"&",c=c||"=",null===a&&(a=void 0),"object"==typeof a?d(g(a),function(g){var h=encodeURIComponent(e(g))+c;return f(a[g])?d(a[g],function(a){return h+encodeURIComponent(e(a))}).join(b):h+encodeURIComponent(e(a[g]))}).join(b):h?encodeURIComponent(e(h))+c+encodeURIComponent(e(a)):""};var f=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],145:[function(a,b,c){c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":143,"./encode":144}],146:[function(a,b,c){var d=function(a){var b=0;return function(){if(b===a.length)return null;var c=a.length-b,d=Math.random()*c|0,e=a[b+d],f=a[b];return a[b]=e,a[b+d]=f,b++,e}};b.exports=d},{}],147:[function(a,b,c){(function(a,c,d){function e(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}function f(b,e){if(b>65536)throw new Error("requested too many random bytes");var f=new c.Uint8Array(b);b>0&&g.getRandomValues(f);var h=new d(f.buffer);return"function"==typeof e?a.nextTick(function(){e(null,h)}):h}var g=c.crypto||c.msCrypto;g&&g.getRandomValues?b.exports=f:b.exports=e}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a("buffer").Buffer)},{_process:141,buffer:39}],148:[function(a,b,c){function d(a,b){var c=this;return c instanceof d?(f.Writable.call(c,b),c.destroyed=!1,c._queue=[],c._position=a||0,c._cb=null,c._buffer=null,void(c._out=null)):new d(a)}var e=a("inherits"),f=a("readable-stream");b.exports=d,e(d,f.Writable),d.prototype._write=function(a,b,c){for(var d=this,e=!0;;){if(d.destroyed)return;if(0===d._queue.length)return d._buffer=a,void(d._cb=c);d._buffer=null;var f=d._queue[0],g=Math.max(f.start-d._position,0),h=f.end-d._position;if(g>=a.length)return d._position+=a.length,c(null);var i;if(h>a.length){d._position+=a.length,i=0===g?a:a.slice(g),e=f.stream.write(i)&&e;break}d._position+=h,i=0===g&&h===a.length?a:a.slice(g,h),e=f.stream.write(i)&&e,f.last&&f.stream.end(),a=a.slice(h),d._queue.shift()}e?c(null):f.stream.once("drain",c.bind(null,null))},d.prototype.slice=function(a){var b=this;if(b.destroyed)return null;a instanceof Array||(a=[a]);var c=new f.PassThrough;return a.forEach(function(d,e){b._queue.push({start:d.start,end:d.end,stream:c,last:e===a.length-1})}),b._buffer&&b._write(b._buffer,null,b._cb),c},d.prototype.destroy=function(a){var b=this;b.destroyed||(b.destroyed=!0,a&&b.emit("error",a))}},{inherits:87,"readable-stream":157}],149:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],150:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":152,"./_stream_writable":154,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],151:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":153,"core-util-is":54,dup:12,inherits:87}],152:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":150,"./internal/streams/BufferList":155,"./internal/streams/stream":156,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:149,"process-nextick-args":140,"string_decoder/":158,util:36}],153:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":150,"core-util-is":54,dup:14,inherits:87}],154:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":150,"./internal/streams/stream":156,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],155:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],156:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],157:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":150,"./lib/_stream_passthrough.js":151,"./lib/_stream_readable.js":152,"./lib/_stream_transform.js":153,"./lib/_stream_writable.js":154,dup:18}],158:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],159:[function(a,b,c){function d(a,b,c,d){"function"==typeof c&&(d=c,c={}),c||(c={}),d||(d=function(){}),h(a),j(c),"string"==typeof b&&(b=document.querySelector(b)),f(a,function(c){if(b.nodeName!==c.toUpperCase()){var d=n.extname(a.name).toLowerCase();throw new Error('Cannot render "'+d+'" inside a "'+b.nodeName.toLowerCase()+'" element, expected "'+c+'"')}return b},c,d)}function e(a,b,c,d){function e(a){return"video"===a||"audio"===a?g(a):i(a)}function g(a){var d=i(a);return c.controls&&(d.controls=!0),c.autoplay&&(d.autoplay=!0),b.appendChild(d),d}function i(a){var c=document.createElement(a);return b.appendChild(c),c}function k(a,b){a&&b&&b.remove(),d(a,b)}if("function"==typeof c&&(d=c,c={}),c||(c={}),d||(d=function(){}),h(a),j(c),"string"==typeof b&&(b=document.querySelector(b)),b&&("VIDEO"===b.nodeName||"AUDIO"===b.nodeName))throw new Error("Invalid video/audio node argument. Argument must be root element that video/audio tag will be appended to.");f(a,e,c,k)}function f(a,b,c,d){function e(){function d(){k("Use `videostream` package for "+a.name),o(),A.addEventListener("error",l),A.addEventListener("loadstart",h),A.addEventListener("canplay",j),p(a,A)}function e(){k("Use MediaSource API for "+a.name),o(),A.addEventListener("error",n),A.addEventListener("loadstart",h),A.addEventListener("canplay",j);var b=new m(A),c=b.createWriteStream(i(a.name));a.createReadStream().pipe(c),C&&(A.currentTime=C)}function f(){k("Use Blob URL for "+a.name),o(),A.addEventListener("error",z),A.addEventListener("loadstart",h),A.addEventListener("canplay",j),g(a,function(a,b){return a?z(a):(A.src=b,void(C&&(A.currentTime=C)))})}function l(a){k("videostream error: fallback to MediaSource API: %o",a.message||a),A.removeEventListener("error",l),A.removeEventListener("canplay",j),e()}function n(b){return k("MediaSource API error: fallback to Blob URL: %o",b.message||b),"number"==typeof a.length&&a.length>c.maxBlobLength?(k("File length too large for Blob URL approach: %d (max: %d)",a.length,c.maxBlobLength),z(new Error("File length too large for Blob URL approach: "+a.length+" (max: "+c.maxBlobLength+")"))):(A.removeEventListener("error",n),A.removeEventListener("canplay",j),void f())}function o(){A||(A=b(s),A.addEventListener("progress",function(){C=A.currentTime}))}var s=r.indexOf(B)>=0?"video":"audio";y?q.indexOf(B)>=0?d():e():f()}function f(){A=b("audio"),g(a,function(a,b){return a?z(a):(A.addEventListener("error",z),A.addEventListener("loadstart",h),A.addEventListener("canplay",j),void(A.src=b))})}function h(){A.removeEventListener("loadstart",h),c.autoplay&&A.play()}function j(){A.removeEventListener("canplay",j),d(null,A)}function o(){A=b("img"),g(a,function(b,c){return b?z(b):(A.src=c,A.alt=a.name,void d(null,A))})}function s(){A=b("iframe"),g(a,function(a,b){return a?z(a):(A.src=b,".pdf"!==B&&(A.sandbox="allow-forms allow-scripts"),void d(null,A))})}function x(){function b(){l(c)?(k('File extension "%s" appears ascii, so will render.',B),s()):(k('File extension "%s" appears non-ascii, will not render.',B),d(new Error('Unsupported file type "'+B+'": Cannot append to DOM')))}k('Unknown file extension "%s" - will attempt to render into iframe',B);var c="";a.createReadStream({start:0,end:1e3}).setEncoding("utf8").on("data",function(a){c+=a}).on("end",b).on("error",d)}function z(b){b.message='Error rendering file "'+a.name+'": '+b.message,k(b.message),d(b)}var A,B=n.extname(a.name).toLowerCase(),C=0;t.indexOf(B)>=0?e():u.indexOf(B)>=0?f():v.indexOf(B)>=0?o():w.indexOf(B)>=0?s():x()}function g(a,b){var d=n.extname(a.name).toLowerCase();o(a.createReadStream(),c.mime[d],b)}function h(a){if(null==a)throw new Error("file cannot be null or undefined");if("string"!=typeof a.name)throw new Error("missing or invalid file.name property");if("function"!=typeof a.createReadStream)throw new Error("missing or invalid file.createReadStream property")}function i(a){var b=n.extname(a).toLowerCase();return{".m4a":'audio/mp4; codecs="mp4a.40.5"',".m4v":'video/mp4; codecs="avc1.640029, mp4a.40.5"',".mkv":'video/webm; codecs="avc1.640029, mp4a.40.5"',".mp3":"audio/mpeg",".mp4":'video/mp4; codecs="avc1.640029, mp4a.40.5"',".webm":'video/webm; codecs="vorbis, vp8"'}[b]}function j(a){null==a.autoplay&&(a.autoplay=!0),null==a.controls&&(a.controls=!0),null==a.maxBlobLength&&(a.maxBlobLength=x)}c.render=d,c.append=e,c.mime=a("./lib/mime.json");var k=a("debug")("render-media"),l=a("is-ascii"),m=a("mediasource"),n=a("path"),o=a("stream-to-blob-url"),p=a("videostream"),q=[".m4a",".m4v",".mp4"],r=[".m4v",".mkv",".mp4",".webm"],s=[".m4a",".mp3"],t=[].concat(r,s),u=[".aac",".oga",".ogg",".wav"],v=[".bmp",".gif",".jpeg",".jpg",".png",".svg"],w=[".css",".html",".js",".md",".pdf",".txt"],x=2e8,y="undefined"!=typeof window&&window.MediaSource},{"./lib/mime.json":160,debug:66,"is-ascii":88,mediasource:94,path:138,"stream-to-blob-url":203,videostream:222}],160:[function(a,b,c){b.exports={".3gp":"video/3gpp",".aac":"audio/aac",".aif":"audio/x-aiff",".aiff":"audio/x-aiff",".atom":"application/atom+xml",".avi":"video/x-msvideo",".bmp":"image/bmp",".bz2":"application/x-bzip2",".conf":"text/plain",".css":"text/css",".csv":"text/plain",".diff":"text/x-diff",".doc":"application/msword",".flv":"video/x-flv",".gif":"image/gif",".gz":"application/x-gzip",".htm":"text/html",".html":"text/html",".ico":"image/vnd.microsoft.icon",".ics":"text/calendar",".iso":"application/octet-stream",".jar":"application/java-archive",".jpeg":"image/jpeg",".jpg":"image/jpeg",".js":"application/javascript",".json":"application/json",".less":"text/css",".log":"text/plain",".m3u":"audio/x-mpegurl",".m4a":"audio/mp4",".m4v":"video/mp4",".manifest":"text/cache-manifest",".markdown":"text/x-markdown",".mathml":"application/mathml+xml",".md":"text/x-markdown",".mid":"audio/midi",".midi":"audio/midi",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mp4v":"video/mp4",".mpeg":"video/mpeg",".mpg":"video/mpeg",".odp":"application/vnd.oasis.opendocument.presentation",".ods":"application/vnd.oasis.opendocument.spreadsheet",".odt":"application/vnd.oasis.opendocument.text",".oga":"audio/ogg",".ogg":"application/ogg",".pdf":"application/pdf",".png":"image/png",".pps":"application/vnd.ms-powerpoint",".ppt":"application/vnd.ms-powerpoint",".ps":"application/postscript",".psd":"image/vnd.adobe.photoshop",".qt":"video/quicktime",".rar":"application/x-rar-compressed",".rdf":"application/rdf+xml",".rss":"application/rss+xml",".rtf":"application/rtf",".svg":"image/svg+xml",".svgz":"image/svg+xml",".swf":"application/x-shockwave-flash",".tar":"application/x-tar",".tbz":"application/x-bzip-compressed-tar",".text":"text/plain",".tif":"image/tiff",".tiff":"image/tiff",".torrent":"application/x-bittorrent",".ttf":"application/x-font-ttf",".txt":"text/plain",".wav":"audio/wav",".webm":"video/webm",".wma":"audio/x-ms-wma",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xml":"application/xml",".yaml":"text/yaml",".yml":"text/yaml",".zip":"application/zip"}},{}],161:[function(a,b,c){(function(a){b.exports=function(b,c,d){function e(b){function c(){d&&d(b,g),d=null}l?a.nextTick(c):c()}function f(a,c,d){if(g[a]=d,c&&(k=!0),0===--i||c)e(c);else if(!k&&h>m){var l;j?(l=j[m],m+=1,b[l](function(a,b){f(l,a,b)})):(l=m,m+=1,b[l](function(a,b){f(l,a,b)}))}}if("number"!=typeof c)throw new Error("second argument must be a Number");var g,h,i,j,k,l=!0;Array.isArray(b)?(g=[],i=h=b.length):(j=Object.keys(b),g={},i=h=j.length);var m=c;i?j?j.some(function(a,d){return b[a](function(b,c){f(a,b,c)}),d===c-1?!0:void 0}):b.some(function(a,b){return a(function(a,c){f(b,a,c)}),b===c-1?!0:void 0}):e(null),l=!1}}).call(this,a("_process"))},{_process:141}],162:[function(a,b,c){(function(a){b.exports=function(b,c){function d(b){function d(){c&&c(b,f),c=null}i?a.nextTick(d):d()}function e(a,b,c){f[a]=c,(0===--g||b)&&d(b)}var f,g,h,i=!0;Array.isArray(b)?(f=[],g=b.length):(h=Object.keys(b),f={},g=h.length),g?h?h.forEach(function(a){b[a](function(b,c){e(a,b,c)})}):b.forEach(function(a,b){a(function(a,c){e(b,a,c)})}):d(null),i=!1}}).call(this,a("_process"))},{_process:141}],163:[function(a,b,c){(function(a){!function(){function c(a){for(var b={fill:0},f=function(a){for(a+=9;a%64>0;a+=1);return a},g=function(a,b){var c=new Uint8Array(a.buffer),d=b%4,e=b-d;switch(d){case 0:c[e+3]=0;case 1:c[e+2]=0;case 2:c[e+1]=0;case 3:c[e+0]=0}for(var f=(b>>2)+1;f<a.length;f++)a[f]=0},h=function(a,b,c){a[b>>2]|=128<<24-(b%4<<3),a[((b>>2)+2&-16)+14]=c/(1<<29)|0,a[((b>>2)+2&-16)+15]=c<<3},i=function(a,b,c,d,e){var f,g=this,h=e%4,i=(d+h)%4,j=d-i;switch(h){case 0:a[e]=g.charCodeAt(c+3);case 1:a[e+1-(h<<1)|0]=g.charCodeAt(c+2);case 2:a[e+2-(h<<1)|0]=g.charCodeAt(c+1);case 3:a[e+3-(h<<1)|0]=g.charCodeAt(c)}if(!(i+h>d)){for(f=4-h;j>f;f=f+4|0)b[e+f>>2]=g.charCodeAt(c+f)<<24|g.charCodeAt(c+f+1)<<16|g.charCodeAt(c+f+2)<<8|g.charCodeAt(c+f+3);switch(i){case 3:a[e+j+1|0]=g.charCodeAt(c+j+2);case 2:a[e+j+2|0]=g.charCodeAt(c+j+1);case 1:a[e+j+3|0]=g.charCodeAt(c+j)}}},j=function(a,b,c,d,e){var f,g=this,h=e%4,i=(d+h)%4,j=d-i;switch(h){case 0:a[e]=g[c+3];case 1:a[e+1-(h<<1)|0]=g[c+2];case 2:a[e+2-(h<<1)|0]=g[c+1];case 3:a[e+3-(h<<1)|0]=g[c]}if(!(i+h>d)){for(f=4-h;j>f;f=f+4|0)b[e+f>>2|0]=g[c+f]<<24|g[c+f+1]<<16|g[c+f+2]<<8|g[c+f+3];switch(i){case 3:a[e+j+1|0]=g[c+j+2];case 2:a[e+j+2|0]=g[c+j+1];case 1:a[e+j+3|0]=g[c+j]}}},k=function(a,b,c,d,f){var g,h=this,i=f%4,j=(d+i)%4,k=d-j,l=new Uint8Array(e.readAsArrayBuffer(h.slice(c,c+d)));switch(i){case 0:a[f]=l[3];case 1:a[f+1-(i<<1)|0]=l[2];case 2:a[f+2-(i<<1)|0]=l[1];case 3:a[f+3-(i<<1)|0]=l[0]}if(!(j+i>d)){for(g=4-i;k>g;g=g+4|0)b[f+g>>2|0]=l[g]<<24|l[g+1]<<16|l[g+2]<<8|l[g+3];switch(j){case 3:a[f+k+1|0]=l[k+2];case 2:a[f+k+2|0]=l[k+1];case 1:a[f+k+3|0]=l[k]}}},l=function(a){switch(d.getDataType(a)){case"string":return i.bind(a);case"array":return j.bind(a);case"buffer":return j.bind(a);case"arraybuffer":return j.bind(new Uint8Array(a));case"view":return j.bind(new Uint8Array(a.buffer,a.byteOffset,a.byteLength));case"blob":return k.bind(a)}},m=new Array(256),n=0;256>n;n++)m[n]=(16>n?"0":"")+n.toString(16);var o=function(a){for(var b=new Uint8Array(a),c=new Array(a.byteLength),d=0;d<c.length;d++)c[d]=m[b[d]];return c.join("")},p=function(a){var b;if(65536>=a)return 65536;if(16777216>a)for(b=1;a>b;b<<=1);else for(b=16777216;a>b;b+=16777216);return b},q=function(a){if(a%64>0)throw new Error("Chunk size must be a multiple of 128 bit");b.offset=0,b.maxChunkLen=a,b.padMaxChunkLen=f(a),b.heap=new ArrayBuffer(p(b.padMaxChunkLen+320+20)),b.h32=new Int32Array(b.heap),b.h8=new Int8Array(b.heap),b.core=new c._core({Int32Array:Int32Array,DataView:DataView},{},b.heap),b.buffer=null};q(a||65536);var r=function(a,c){b.offset=0;var d=new Int32Array(a,c+320,5);d[0]=1732584193,d[1]=-271733879,d[2]=-1732584194,d[3]=271733878,d[4]=-1009589776},s=function(a,c){var d=f(a),e=new Int32Array(b.heap,0,d>>2);return g(e,a),h(e,a,c),d},t=function(a,c,d,e){l(a)(b.h8,b.h32,c,d,e||0)},u=function(a,c,d,e,f){var g=d;t(a,c,d),f&&(g=s(d,e)),b.core.hash(g,b.padMaxChunkLen)},v=function(a,b){var c=new Int32Array(a,b+320,5),d=new Int32Array(5),e=new DataView(d.buffer);return e.setInt32(0,c[0],!1),e.setInt32(4,c[1],!1),e.setInt32(8,c[2],!1),e.setInt32(12,c[3],!1),e.setInt32(16,c[4],!1),d},w=this.rawDigest=function(a){var c=a.byteLength||a.length||a.size||0;r(b.heap,b.padMaxChunkLen);var d=0,e=b.maxChunkLen;for(d=0;c>d+e;d+=e)u(a,d,e,c,!1);return u(a,d,c-d,c,!0),v(b.heap,b.padMaxChunkLen)};this.digest=this.digestFromString=this.digestFromBuffer=this.digestFromArrayBuffer=function(a){return o(w(a).buffer)},this.resetState=function(){return r(b.heap,b.padMaxChunkLen),this},this.append=function(a){var c,d=0,e=a.byteLength||a.length||a.size||0,f=b.offset%b.maxChunkLen;for(b.offset+=e;e>d;)c=Math.min(e-d,b.maxChunkLen-f),t(a,d,c,f),f+=c,d+=c,f===b.maxChunkLen&&(b.core.hash(b.maxChunkLen,b.padMaxChunkLen),f=0);return this},this.getState=function(){var a,c=b.offset%b.maxChunkLen;if(c)a=b.heap.slice(0);else{var d=new Int32Array(b.heap,b.padMaxChunkLen+320,5);a=d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}return{offset:b.offset,heap:a}},this.setState=function(a){if(b.offset=a.offset,20===a.heap.byteLength){var c=new Int32Array(b.heap,b.padMaxChunkLen+320,5);c.set(new Int32Array(a.heap))}else b.h32.set(new Int32Array(a.heap));return this};var x=this.rawEnd=function(){var a=b.offset,c=a%b.maxChunkLen,d=s(c,a);b.core.hash(d,b.padMaxChunkLen);var e=v(b.heap,b.padMaxChunkLen);return r(b.heap,b.padMaxChunkLen),e};this.end=function(){return o(x().buffer)}}var d={getDataType:function(b){if("string"==typeof b)return"string";if(b instanceof Array)return"array";if("undefined"!=typeof a&&a.Buffer&&a.Buffer.isBuffer(b))return"buffer";if(b instanceof ArrayBuffer)return"arraybuffer";if(b.buffer instanceof ArrayBuffer)return"view";if(b instanceof Blob)return"blob";throw new Error("Unsupported data type.")}};if(c._core=function(a,b,c){"use asm";function d(a,b){a|=0,b|=0;var c=0,d=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;for(f=e[b+320>>2]|0,h=e[b+324>>2]|0,j=e[b+328>>2]|0,l=e[b+332>>2]|0,n=e[b+336>>2]|0,c=0;(c|0)<(a|0);c=c+64|0){for(g=f,i=h,k=j,m=l,o=n,d=0;(d|0)<64;d=d+4|0)q=e[c+d>>2]|0,p=((f<<5|f>>>27)+(h&j|~h&l)|0)+((q+n|0)+1518500249|0)|0,n=l,l=j,j=h<<30|h>>>2,h=f,f=p,e[a+d>>2]=q;for(d=a+64|0;(d|0)<(a+80|0);d=d+4|0)q=(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])<<1|(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])>>>31,p=((f<<5|f>>>27)+(h&j|~h&l)|0)+((q+n|0)+1518500249|0)|0,n=l,l=j,j=h<<30|h>>>2,h=f,f=p,e[d>>2]=q;for(d=a+80|0;(d|0)<(a+160|0);d=d+4|0)q=(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])<<1|(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])>>>31,p=((f<<5|f>>>27)+(h^j^l)|0)+((q+n|0)+1859775393|0)|0,n=l,l=j,j=h<<30|h>>>2,h=f,f=p,e[d>>2]=q;for(d=a+160|0;(d|0)<(a+240|0);d=d+4|0)q=(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])<<1|(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])>>>31,p=((f<<5|f>>>27)+(h&j|h&l|j&l)|0)+((q+n|0)-1894007588|0)|0,n=l,l=j,j=h<<30|h>>>2,h=f,f=p,e[d>>2]=q;for(d=a+240|0;(d|0)<(a+320|0);d=d+4|0)q=(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])<<1|(e[d-12>>2]^e[d-32>>2]^e[d-56>>2]^e[d-64>>2])>>>31,p=((f<<5|f>>>27)+(h^j^l)|0)+((q+n|0)-899497514|0)|0,n=l,l=j,j=h<<30|h>>>2,h=f,f=p,e[d>>2]=q;f=f+g|0,h=h+i|0,j=j+k|0,l=l+m|0,n=n+o|0}e[b+320>>2]=f,e[b+324>>2]=h,e[b+328>>2]=j,e[b+332>>2]=l,e[b+336>>2]=n}var e=new a.Int32Array(c);return{hash:d}},"undefined"!=typeof b?b.exports=c:"undefined"!=typeof window&&(window.Rusha=c),"undefined"!=typeof FileReaderSync){var e=new FileReaderSync,f=new c(4194304);self.onmessage=function(a){var b,c=a.data.data;try{b=f.digest(c),self.postMessage({id:a.data.id,hash:b})}catch(d){self.postMessage({id:a.data.id,error:d.name})}}}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],164:[function(a,b,c){b.exports=a("buffer")},{buffer:39}],165:[function(a,b,c){(function(a){b.exports=function(b,c){var d=[];b.on("data",function(a){d.push(a)}),b.once("end",function(){c&&c(null,a.concat(d)),c=null}),b.once("error",function(a){c&&c(a),c=null})}}).call(this,a("buffer").Buffer)},{buffer:39}],166:[function(a,b,c){(function(c){function d(a,b){a="string"==typeof a?{url:a}:Object.assign({},a),b=j(b),a.url&&e(a),null==a.headers&&(a.headers={}),null==a.maxRedirects&&(a.maxRedirects=10);var g;a.form&&(g="string"==typeof a.form?a.form:k.stringify(a.form)),a.body&&(g=a.json?JSON.stringify(a.body):a.body),a.json&&(a.headers.accept="application/json"),a.json&&g&&(a.headers["content-type"]="application/json"),a.form&&(a.headers["content-type"]="application/x-www-form-urlencoded"),g&&!f(g)&&(a.headers["content-length"]=c.byteLength(g)),delete a.body,delete a.form,g&&!a.method&&(a.method="POST"),a.method&&(a.method=a.method.toUpperCase());var m=Object.keys(a.headers).some(function(a){return"accept-encoding"===a.toLowerCase()});m||(a.headers["accept-encoding"]="gzip, deflate");var n="https:"===a.protocol?i:h,o=n.request(a,function(c){if(c.statusCode>=300&&c.statusCode<400&&"location"in c.headers)return a.url=c.headers.location,c.resume(),void(a.maxRedirects>0?(a.maxRedirects-=1,d(a,b)):b(new Error("too many redirects")));var e="function"==typeof l&&"HEAD"!==a.method;b(null,e?l(c):c)});return o.on("timeout",function(){o.abort(),b(new Error("Request timed out"))}),o.on("error",b),g&&f(g)?g.on("error",b).pipe(o):o.end(g),o}function e(a){var b=m.parse(a.url);b.hostname&&(a.hostname=b.hostname),b.port&&(a.port=b.port),b.protocol&&(a.protocol=b.protocol),b.auth&&(a.auth=b.auth),a.path=b.path,delete a.url}function f(a){return"function"==typeof a.pipe}b.exports=d;var g=a("simple-concat"),h=a("http"),i=a("https"),j=a("once"),k=a("querystring"),l=a("unzip-response"),m=a("url");d.concat=function(a,b){return d(a,function(c,d){return c?b(c):void g(d,function(c,e){if(c)return b(c);if(a.json)try{e=JSON.parse(e.toString())}catch(c){return b(c,d,e)}b(null,d,e)})})},["get","post","put","patch","head","delete"].forEach(function(a){d[a]=function(b,c){return"string"==typeof b&&(b={url:b}),b.method=a.toUpperCase(),d(b,c)}})}).call(this,a("buffer").Buffer)},{buffer:39,http:191,https:84,once:135,querystring:145,"simple-concat":165,"unzip-response":36,url:216}],167:[function(a,b,c){(function(c){function d(a){var b=this;if(!(b instanceof d))return new d(a);if(b._id=i(4).toString("hex").slice(0,7),b._debug("new peer %o",a),a=Object.assign({allowHalfOpen:!1},a),j.Duplex.call(b,a),b.channelName=a.initiator?a.channelName||i(20).toString("hex"):null,b._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,b.initiator=a.initiator||!1,b.channelConfig=a.channelConfig||d.channelConfig,b.config=a.config||d.config,b.constraints=b._transformConstraints(a.constraints||d.constraints),b.offerConstraints=b._transformConstraints(a.offerConstraints||{}),b.answerConstraints=b._transformConstraints(a.answerConstraints||{}),b.reconnectTimer=a.reconnectTimer||!1,b.sdpTransform=a.sdpTransform||function(a){return a},b.stream=a.stream||!1,b.trickle=void 0!==a.trickle?a.trickle:!0,b.destroyed=!1,b.connected=!1,b.remoteAddress=void 0,b.remoteFamily=void 0,b.remotePort=void 0,b.localAddress=void 0,b.localPort=void 0,b._wrtc=a.wrtc&&"object"==typeof a.wrtc?a.wrtc:g(),!b._wrtc)throw"undefined"==typeof window?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser");if(b._pcReady=!1,b._channelReady=!1,b._iceComplete=!1,b._channel=null,b._pendingCandidates=[],b._previousStreams=[],b._chunk=null,b._cb=null,b._interval=null,b._reconnectTimeout=null,b._pc=new b._wrtc.RTCPeerConnection(b.config,b.constraints),b._isWrtc=Array.isArray(b._pc.RTCIceConnectionStates),b._isReactNativeWebrtc="number"==typeof b._pc._peerConnectionId,b._pc.oniceconnectionstatechange=function(){b._onIceStateChange()},b._pc.onicegatheringstatechange=function(){b._onIceStateChange()},b._pc.onsignalingstatechange=function(){b._onSignalingStateChange()},b._pc.onicecandidate=function(a){b._onIceCandidate(a)},b.initiator){var c=!1;b._pc.onnegotiationneeded=function(){c||b._createOffer(),c=!0},b._setupData({channel:b._pc.createDataChannel(b.channelName,b.channelConfig)})}else b._pc.ondatachannel=function(a){b._setupData(a)};"addTrack"in b._pc?(b.stream&&b.stream.getTracks().forEach(function(a){b._pc.addTrack(a,b.stream)}),b._pc.ontrack=function(a){b._onTrack(a)}):(b.stream&&b._pc.addStream(b.stream),b._pc.onaddstream=function(a){b._onAddStream(a)}),b.initiator&&b._isWrtc&&b._pc.onnegotiationneeded(),b._onFinishBound=function(){b._onFinish()},b.once("finish",b._onFinishBound)}function e(){}b.exports=d;var f=a("debug")("simple-peer"),g=a("get-browser-rtc"),h=a("inherits"),i=a("randombytes"),j=a("readable-stream"),k=65536;h(d,j.Duplex),d.WEBRTC_SUPPORT=!!g(),d.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},d.constraints={},d.channelConfig={},Object.defineProperty(d.prototype,"bufferSize",{get:function(){var a=this;return a._channel&&a._channel.bufferedAmount||0}}),d.prototype.address=function(){var a=this;return{port:a.localPort,family:"IPv4",address:a.localAddress}},d.prototype.signal=function(a){var b=this;if(b.destroyed)throw new Error("cannot signal after peer is destroyed");if("string"==typeof a)try{a=JSON.parse(a)}catch(c){a={}}b._debug("signal()"),a.candidate&&(b._pc.remoteDescription?b._addIceCandidate(a.candidate):b._pendingCandidates.push(a.candidate)),a.sdp&&b._pc.setRemoteDescription(new b._wrtc.RTCSessionDescription(a),function(){b.destroyed||(b._pendingCandidates.forEach(function(a){b._addIceCandidate(a)}),b._pendingCandidates=[],"offer"===b._pc.remoteDescription.type&&b._createAnswer())},function(a){b._destroy(a)}),a.sdp||a.candidate||b._destroy(new Error("signal() called with invalid signal data"))},d.prototype._addIceCandidate=function(a){var b=this;try{b._pc.addIceCandidate(new b._wrtc.RTCIceCandidate(a),e,function(a){b._destroy(a)})}catch(c){b._destroy(new Error("error adding candidate: "+c.message))}},d.prototype.send=function(a){var b=this;b._isWrtc&&c.isBuffer(a)&&(a=new Uint8Array(a)),b._channel.send(a)},d.prototype.destroy=function(a){var b=this;b._destroy(null,a)},d.prototype._destroy=function(a,b){var c=this;if(!c.destroyed){if(b&&c.once("close",b),c._debug("destroy (error: %s)",a&&(a.message||a)),c.readable=c.writable=!1,c._readableState.ended||c.push(null),c._writableState.finished||c.end(),c.destroyed=!0,c.connected=!1,c._pcReady=!1,c._channelReady=!1,c._previousStreams=null,clearInterval(c._interval),clearTimeout(c._reconnectTimeout),c._interval=null,c._reconnectTimeout=null,c._chunk=null,c._cb=null,c._onFinishBound&&c.removeListener("finish",c._onFinishBound),c._onFinishBound=null,c._pc){try{c._pc.close()}catch(a){}c._pc.oniceconnectionstatechange=null,c._pc.onicegatheringstatechange=null,c._pc.onsignalingstatechange=null,c._pc.onicecandidate=null,"addTrack"in c._pc?c._pc.ontrack=null:c._pc.onaddstream=null,c._pc.onnegotiationneeded=null,c._pc.ondatachannel=null}if(c._channel){try{c._channel.close()}catch(a){}c._channel.onmessage=null,c._channel.onopen=null,c._channel.onclose=null,c._channel.onerror=null}c._pc=null,c._channel=null,a&&c.emit("error",a),c.emit("close")}},d.prototype._setupData=function(a){var b=this;return a.channel?(b._channel=a.channel,b._channel.binaryType="arraybuffer","number"==typeof b._channel.bufferedAmountLowThreshold&&(b._channel.bufferedAmountLowThreshold=k),b.channelName=b._channel.label,b._channel.onmessage=function(a){b._onChannelMessage(a)},b._channel.onbufferedamountlow=function(){b._onChannelBufferedAmountLow()},b._channel.onopen=function(){b._onChannelOpen()},b._channel.onclose=function(){
b._onChannelClose()},void(b._channel.onerror=function(a){b._destroy(a)})):b._destroy(new Error("Data channel event is missing `channel` property"))},d.prototype._read=function(){},d.prototype._write=function(a,b,c){var d=this;if(d.destroyed)return c(new Error("cannot write after peer is destroyed"));if(d.connected){try{d.send(a)}catch(e){return d._destroy(e)}d._channel.bufferedAmount>k?(d._debug("start backpressure: bufferedAmount %d",d._channel.bufferedAmount),d._cb=c):c(null)}else d._debug("write before connect"),d._chunk=a,d._cb=c},d.prototype._onFinish=function(){function a(){setTimeout(function(){b._destroy()},1e3)}var b=this;b.destroyed||(b.connected?a():b.once("connect",a))},d.prototype._createOffer=function(){var a=this;a.destroyed||a._pc.createOffer(function(b){function c(){a.destroyed||(a.trickle||a._iceComplete?e():a.once("_iceComplete",e))}function d(b){a._destroy(b)}function e(){var c=a._pc.localDescription||b;a._debug("signal"),a.emit("signal",{type:c.type,sdp:c.sdp})}a.destroyed||(b.sdp=a.sdpTransform(b.sdp),a._pc.setLocalDescription(b,c,d))},function(b){a._destroy(b)},a.offerConstraints)},d.prototype._createAnswer=function(){var a=this;a.destroyed||a._pc.createAnswer(function(b){function c(){a.destroyed||(a.trickle||a._iceComplete?e():a.once("_iceComplete",e))}function d(b){a._destroy(b)}function e(){var c=a._pc.localDescription||b;a._debug("signal"),a.emit("signal",{type:c.type,sdp:c.sdp})}a.destroyed||(b.sdp=a.sdpTransform(b.sdp),a._pc.setLocalDescription(b,c,d))},function(b){a._destroy(b)},a.answerConstraints)},d.prototype._onIceStateChange=function(){var a=this;if(!a.destroyed){var b=a._pc.iceConnectionState,c=a._pc.iceGatheringState;a._debug("iceStateChange (connection: %s) (gathering: %s)",b,c),a.emit("iceStateChange",b,c),("connected"===b||"completed"===b)&&(clearTimeout(a._reconnectTimeout),a._pcReady=!0,a._maybeReady()),"disconnected"===b&&(a.reconnectTimer?(clearTimeout(a._reconnectTimeout),a._reconnectTimeout=setTimeout(function(){a._destroy()},a.reconnectTimer)):a._destroy()),"failed"===b&&a._destroy(new Error("Ice connection failed.")),"closed"===b&&a._destroy()}},d.prototype.getStats=function(a){var b=this;0===b._pc.getStats.length?b._pc.getStats().then(function(b){var c=[];b.forEach(function(a){c.push(a)}),a(null,c)},function(b){a(b)}):b._isReactNativeWebrtc?b._pc.getStats(null,function(b){var c=[];b.forEach(function(a){c.push(a)}),a(null,c)},function(b){a(b)}):b._pc.getStats.length>0?b._pc.getStats(function(b){var c=[];b.result().forEach(function(a){var b={};a.names().forEach(function(c){b[c]=a.stat(c)}),b.id=a.id,b.type=a.type,b.timestamp=a.timestamp,c.push(b)}),a(null,c)},function(b){a(b)}):a(null,[])},d.prototype._maybeReady=function(){var a=this;a._debug("maybeReady pc %s channel %s",a._pcReady,a._channelReady),!a.connected&&!a._connecting&&a._pcReady&&a._channelReady&&(a._connecting=!0,a.getStats(function(b,c){function d(b){var c=f[b.localCandidateId];c&&c.ip?(a.localAddress=c.ip,a.localPort=Number(c.port)):c&&c.ipAddress?(a.localAddress=c.ipAddress,a.localPort=Number(c.portNumber)):"string"==typeof b.googLocalAddress&&(c=b.googLocalAddress.split(":"),a.localAddress=c[0],a.localPort=Number(c[1]));var d=e[b.remoteCandidateId];d&&d.ip?(a.remoteAddress=d.ip,a.remotePort=Number(d.port)):d&&d.ipAddress?(a.remoteAddress=d.ipAddress,a.remotePort=Number(d.portNumber)):"string"==typeof b.googRemoteAddress&&(d=b.googRemoteAddress.split(":"),a.remoteAddress=d[0],a.remotePort=Number(d[1])),a.remoteFamily="IPv4",a._debug("connect local: %s:%s remote: %s:%s",a.localAddress,a.localPort,a.remoteAddress,a.remotePort)}if(!a.destroyed){b&&(c=[]),a._connecting=!1,a.connected=!0;var e={},f={},g={};if(c.forEach(function(a){("remotecandidate"===a.type||"remote-candidate"===a.type)&&(e[a.id]=a),("localcandidate"===a.type||"local-candidate"===a.type)&&(f[a.id]=a),("candidatepair"===a.type||"candidate-pair"===a.type)&&(g[a.id]=a)}),c.forEach(function(a){"transport"===a.type&&d(g[a.selectedCandidatePairId]),("googCandidatePair"===a.type&&"true"===a.googActiveConnection||("candidatepair"===a.type||"candidate-pair"===a.type)&&a.selected)&&d(a)}),a._chunk){try{a.send(a._chunk)}catch(b){return a._destroy(b)}a._chunk=null,a._debug('sent chunk from "write before connect"');var h=a._cb;a._cb=null,h(null)}"number"!=typeof a._channel.bufferedAmountLowThreshold&&(a._interval=setInterval(function(){a._onInterval()},150),a._interval.unref&&a._interval.unref()),a._debug("connect"),a.emit("connect")}}))},d.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>k||this._onChannelBufferedAmountLow()},d.prototype._onSignalingStateChange=function(){var a=this;a.destroyed||(a._debug("signalingStateChange %s",a._pc.signalingState),a.emit("signalingStateChange",a._pc.signalingState))},d.prototype._onIceCandidate=function(a){var b=this;b.destroyed||(a.candidate&&b.trickle?b.emit("signal",{candidate:{candidate:a.candidate.candidate,sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid}}):a.candidate||(b._iceComplete=!0,b.emit("_iceComplete")))},d.prototype._onChannelMessage=function(a){var b=this;if(!b.destroyed){var d=a.data;d instanceof ArrayBuffer&&(d=c.from(d)),b.push(d)}},d.prototype._onChannelBufferedAmountLow=function(){var a=this;if(!a.destroyed&&a._cb){a._debug("ending backpressure: bufferedAmount %d",a._channel.bufferedAmount);var b=a._cb;a._cb=null,b(null)}},d.prototype._onChannelOpen=function(){var a=this;a.connected||a.destroyed||(a._debug("on channel open"),a._channelReady=!0,a._maybeReady())},d.prototype._onChannelClose=function(){var a=this;a.destroyed||(a._debug("on channel close"),a._destroy())},d.prototype._onAddStream=function(a){var b=this;b.destroyed||(b._debug("on add stream"),b.emit("stream",a.stream))},d.prototype._onTrack=function(a){var b=this;if(!b.destroyed){b._debug("on track");var c=a.streams[0].id;-1===b._previousStreams.indexOf(c)&&(b._previousStreams.push(c),b.emit("stream",a.streams[0]))}},d.prototype._debug=function(){var a=this,b=[].slice.call(arguments);b[0]="["+a._id+"] "+b[0],f.apply(null,b)},d.prototype._transformConstraints=function(a){var b=this;if(0===Object.keys(a).length)return a;if((a.mandatory||a.optional)&&!b._isChromium){var c=Object.assign({},a.optional,a.mandatory);return void 0!==c.OfferToReceiveVideo&&(c.offerToReceiveVideo=c.OfferToReceiveVideo,delete c.OfferToReceiveVideo),void 0!==c.OfferToReceiveAudio&&(c.offerToReceiveAudio=c.OfferToReceiveAudio,delete c.OfferToReceiveAudio),c}return a.mandatory||a.optional||!b._isChromium?a:(void 0!==a.offerToReceiveVideo&&(a.OfferToReceiveVideo=a.offerToReceiveVideo,delete a.offerToReceiveVideo),void 0!==a.offerToReceiveAudio&&(a.OfferToReceiveAudio=a.offerToReceiveAudio,delete a.offerToReceiveAudio),{mandatory:a})}}).call(this,a("buffer").Buffer)},{buffer:39,debug:66,"get-browser-rtc":83,inherits:87,randombytes:147,"readable-stream":176}],168:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],169:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":171,"./_stream_writable":173,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],170:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":172,"core-util-is":54,dup:12,inherits:87}],171:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":169,"./internal/streams/BufferList":174,"./internal/streams/stream":175,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:168,"process-nextick-args":140,"string_decoder/":177,util:36}],172:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":169,"core-util-is":54,dup:14,inherits:87}],173:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":169,"./internal/streams/stream":175,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],174:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],175:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],176:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":169,"./lib/_stream_passthrough.js":170,"./lib/_stream_readable.js":171,"./lib/_stream_transform.js":172,"./lib/_stream_writable.js":173,dup:18}],177:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],178:[function(a,b,c){function d(a){return i.digest(a)}function e(a,b){return l?("string"==typeof a&&(a=f(a)),void l.digest({name:"sha-1"},a).then(function(a){b(g(new Uint8Array(a)))},function(c){b(d(a))})):void setTimeout(b,0,d(a))}function f(a){for(var b=a.length,c=new Uint8Array(b),d=0;b>d;d++)c[d]=a.charCodeAt(d);return c}function g(a){for(var b=a.length,c=[],d=0;b>d;d++){var e=a[d];c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")}var h=a("rusha"),i=new h,j="undefined"!=typeof window?window:self,k=j.crypto||j.msCrypto||{},l=k.subtle||k.webkitSubtle;try{l.digest({name:"sha-1"},new Uint8Array)["catch"](function(){l=!1})}catch(m){l=!1}b.exports=e,b.exports.sync=d},{rusha:163}],179:[function(a,b,c){(function(c){function d(a){var b=this;if(!(b instanceof d))return new d(a);if(a||(a={}),"string"==typeof a&&(a={url:a}),null==a.url&&null==a.socket)throw new Error("Missing required `url` or `socket` option");if(null!=a.url&&null!=a.socket)throw new Error("Must specify either `url` or `socket` option, not both");if(b._id=h(4).toString("hex").slice(0,7),b._debug("new websocket: %o",a),a=Object.assign({allowHalfOpen:!1},a),i.Duplex.call(b,a),b.connected=!1,b.destroyed=!1,b._chunk=null,b._cb=null,b._interval=null,a.socket)b.url=a.socket.url,b._ws=a.socket;else{b.url=a.url;try{"function"==typeof j?b._ws=new k(a.url,a):b._ws=new k(a.url)}catch(e){return void c.nextTick(function(){b._destroy(e)})}}b._ws.binaryType="arraybuffer",b._ws.onopen=function(){b._onOpen()},b._ws.onmessage=function(a){b._onMessage(a)},b._ws.onclose=function(){b._onClose()},b._ws.onerror=function(){b._destroy(new Error("connection error to "+b.url))},b._onFinishBound=function(){b._onFinish()},b.once("finish",b._onFinishBound)}b.exports=d;var e=a("safe-buffer").Buffer,f=a("debug")("simple-websocket"),g=a("inherits"),h=a("randombytes"),i=a("readable-stream"),j=a("ws"),k="function"!=typeof j?WebSocket:j,l=65536;g(d,i.Duplex),d.WEBSOCKET_SUPPORT=!!k,d.prototype.send=function(a){this._ws.send(a)},d.prototype.destroy=function(a){this._destroy(null,a)},d.prototype._destroy=function(a,b){var c=this;if(!c.destroyed){if(b&&c.once("close",b),c._debug("destroy (error: %s)",a&&(a.message||a)),c.readable=c.writable=!1,c._readableState.ended||c.push(null),c._writableState.finished||c.end(),c.connected=!1,c.destroyed=!0,clearInterval(c._interval),c._interval=null,c._chunk=null,c._cb=null,c._onFinishBound&&c.removeListener("finish",c._onFinishBound),c._onFinishBound=null,c._ws){var d=c._ws,e=function(){d.onclose=null};if(d.readyState===k.CLOSED)e();else try{d.onclose=e,d.close()}catch(a){e()}d.onopen=null,d.onmessage=null,d.onerror=null}c._ws=null,a&&c.emit("error",a),c.emit("close")}},d.prototype._read=function(){},d.prototype._write=function(a,b,c){if(this.destroyed)return c(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(a)}catch(d){return this._destroy(d)}"function"!=typeof j&&this._ws.bufferedAmount>l?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=c):c(null)}else this._debug("write before connect"),this._chunk=a,this._cb=c},d.prototype._onFinish=function(){function a(){setTimeout(function(){b._destroy()},1e3)}var b=this;b.destroyed||(b.connected?a():b.once("connect",a))},d.prototype._onMessage=function(a){if(!this.destroyed){var b=a.data;b instanceof ArrayBuffer&&(b=e.from(b)),this.push(b)}},d.prototype._onOpen=function(){var a=this;if(!a.connected&&!a.destroyed){if(a.connected=!0,a._chunk){try{a.send(a._chunk)}catch(b){return a._destroy(b)}a._chunk=null,a._debug('sent chunk from "write before connect"');var c=a._cb;a._cb=null,c(null)}"function"!=typeof j&&(a._interval=setInterval(function(){a._onInterval()},150),a._interval.unref&&a._interval.unref()),a._debug("connect"),a.emit("connect")}},d.prototype._onInterval=function(){if(this._cb&&this._ws&&!(this._ws.bufferedAmount>l)){this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);var a=this._cb;this._cb=null,a(null)}},d.prototype._onClose=function(){this.destroyed||(this._debug("on close"),this._destroy())},d.prototype._debug=function(){var a=[].slice.call(arguments);a[0]="["+this._id+"] "+a[0],f.apply(null,a)}}).call(this,a("_process"))},{_process:141,debug:66,inherits:87,randombytes:147,"readable-stream":188,"safe-buffer":164,ws:36}],180:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],181:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":183,"./_stream_writable":185,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],182:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":184,"core-util-is":54,dup:12,inherits:87}],183:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":181,"./internal/streams/BufferList":186,"./internal/streams/stream":187,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:180,"process-nextick-args":140,"string_decoder/":189,util:36}],184:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":181,"core-util-is":54,dup:14,inherits:87}],185:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":181,"./internal/streams/stream":187,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],186:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],187:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],188:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":181,"./lib/_stream_passthrough.js":182,"./lib/_stream_readable.js":183,"./lib/_stream_transform.js":184,"./lib/_stream_writable.js":185,dup:18}],189:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],190:[function(a,b,c){var d=1,e=65535,f=4,g=function(){d=d+1&e},h=setInterval(g,1e3/f|0);h.unref&&h.unref(),b.exports=function(a){var b=f*(a||5),c=[0],g=1,h=d-1&e;return function(a){var i=d-h&e;for(i>b&&(i=b),h=d;i--;)g===b&&(g=0),c[g]=c[0===g?b-1:g-1],g++;a&&(c[g-1]+=a);var j=c[g-1],k=c.length<b?0:c[g===b?0:g];return c.length<f?j:(j-k)*f/c.length}}},{}],191:[function(a,b,c){(function(b){var d=a("./lib/request"),e=a("xtend"),f=a("builtin-status-codes"),g=a("url"),h=c;h.request=function(a,c){a="string"==typeof a?g.parse(a):e(a);var f=-1===b.location.protocol.search(/^https?:$/)?"http:":"",h=a.protocol||f,i=a.hostname||a.host,j=a.port,k=a.path||"/";i&&-1!==i.indexOf(":")&&(i="["+i+"]"),a.url=(i?h+"//"+i:"")+(j?":"+j:"")+k,a.method=(a.method||"GET").toUpperCase(),a.headers=a.headers||{};var l=new d(a);return c&&l.on("response",c),l},h.get=function(a,b){var c=h.request(a,b);return c.end(),c},h.Agent=function(){},h.Agent.defaultMaxSockets=4,h.STATUS_CODES=f,h.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/request":193,"builtin-status-codes":41,url:216,xtend:243}],192:[function(a,b,c){(function(a){function b(){if(void 0!==g)return g;if(a.XMLHttpRequest){g=new a.XMLHttpRequest;try{g.open("GET",a.XDomainRequest?"/":"https://example.com")}catch(b){g=null}}else g=null;return g}function d(a){var c=b();if(!c)return!1;try{return c.responseType=a,c.responseType===a}catch(d){}return!1}function e(a){return"function"==typeof a}c.fetch=e(a.fetch)&&e(a.ReadableStream),c.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),c.blobConstructor=!0}catch(f){}var g,h="undefined"!=typeof a.ArrayBuffer,i=h&&e(a.ArrayBuffer.prototype.slice);c.arraybuffer=c.fetch||h&&d("arraybuffer"),c.msstream=!c.fetch&&i&&d("ms-stream"),c.mozchunkedarraybuffer=!c.fetch&&h&&d("moz-chunked-arraybuffer"),c.overrideMimeType=c.fetch||(b()?e(b().overrideMimeType):!1),c.vbArray=e(a.VBArray),g=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],193:[function(a,b,c){(function(c,d,e){function f(a,b){return h.fetch&&b?"fetch":h.mozchunkedarraybuffer?"moz-chunked-arraybuffer":h.msstream?"ms-stream":h.arraybuffer&&a?"arraybuffer":h.vbArray&&a?"text:vbarray":"text"}function g(a){try{var b=a.status;return null!==b&&0!==b}catch(c){return!1}}var h=a("./capability"),i=a("inherits"),j=a("./response"),k=a("readable-stream"),l=a("to-arraybuffer"),m=j.IncomingMessage,n=j.readyStates,o=b.exports=function(a){var b=this;k.Writable.call(b),b._opts=a,b._body=[],b._headers={},a.auth&&b.setHeader("Authorization","Basic "+new e(a.auth).toString("base64")),Object.keys(a.headers).forEach(function(c){b.setHeader(c,a.headers[c])});var c,d=!0;if("disable-fetch"===a.mode||"timeout"in a)d=!1,c=!0;else if("prefer-streaming"===a.mode)c=!1;else if("allow-wrong-content-type"===a.mode)c=!h.overrideMimeType;else{if(a.mode&&"default"!==a.mode&&"prefer-fast"!==a.mode)throw new Error("Invalid value for opts.mode");c=!0}b._mode=f(c,d),b.on("finish",function(){b._onFinish()})};i(o,k.Writable),o.prototype.setHeader=function(a,b){var c=this,d=a.toLowerCase();-1===p.indexOf(d)&&(c._headers[d]={name:a,value:b})},o.prototype.getHeader=function(a){var b=this;return b._headers[a.toLowerCase()].value},o.prototype.removeHeader=function(a){var b=this;delete b._headers[a.toLowerCase()]},o.prototype._onFinish=function(){var a=this;if(!a._destroyed){var b=a._opts,f=a._headers,g=null;if(("POST"===b.method||"PUT"===b.method||"PATCH"===b.method||"MERGE"===b.method)&&(g=h.blobConstructor?new d.Blob(a._body.map(function(a){return l(a)}),{type:(f["content-type"]||{}).value||""}):e.concat(a._body).toString()),"fetch"===a._mode){var i=Object.keys(f).map(function(a){return[f[a].name,f[a].value]});d.fetch(a._opts.url,{method:a._opts.method,headers:i,body:g||void 0,mode:"cors",credentials:b.withCredentials?"include":"same-origin"}).then(function(b){a._fetchResponse=b,a._connect()},function(b){a.emit("error",b)})}else{var j=a._xhr=new d.XMLHttpRequest;try{j.open(a._opts.method,a._opts.url,!0)}catch(k){return void c.nextTick(function(){a.emit("error",k)})}"responseType"in j&&(j.responseType=a._mode.split(":")[0]),"withCredentials"in j&&(j.withCredentials=!!b.withCredentials),"text"===a._mode&&"overrideMimeType"in j&&j.overrideMimeType("text/plain; charset=x-user-defined"),"timeout"in b&&(j.timeout=b.timeout,j.ontimeout=function(){a.emit("timeout")}),Object.keys(f).forEach(function(a){j.setRequestHeader(f[a].name,f[a].value)}),a._response=null,j.onreadystatechange=function(){switch(j.readyState){case n.LOADING:case n.DONE:a._onXHRProgress()}},"moz-chunked-arraybuffer"===a._mode&&(j.onprogress=function(){a._onXHRProgress()}),j.onerror=function(){a._destroyed||a.emit("error",new Error("XHR error"))};try{j.send(g)}catch(k){return void c.nextTick(function(){a.emit("error",k)})}}}},o.prototype._onXHRProgress=function(){var a=this;g(a._xhr)&&!a._destroyed&&(a._response||a._connect(),a._response._onXHRProgress())},o.prototype._connect=function(){var a=this;a._destroyed||(a._response=new m(a._xhr,a._fetchResponse,a._mode),a._response.on("error",function(b){a.emit("error",b)}),a.emit("response",a._response))},o.prototype._write=function(a,b,c){var d=this;d._body.push(a),c()},o.prototype.abort=o.prototype.destroy=function(){var a=this;a._destroyed=!0,a._response&&(a._response._destroyed=!0),a._xhr&&a._xhr.abort()},o.prototype.end=function(a,b,c){var d=this;"function"==typeof a&&(c=a,a=void 0),k.Writable.prototype.end.call(d,a,b,c)},o.prototype.flushHeaders=function(){},o.prototype.setTimeout=function(){},o.prototype.setNoDelay=function(){},o.prototype.setSocketKeepAlive=function(){};var p=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a("buffer").Buffer)},{"./capability":192,"./response":194,_process:141,buffer:39,inherits:87,"readable-stream":202,"to-arraybuffer":209}],194:[function(a,b,c){(function(b,d,e){var f=a("./capability"),g=a("inherits"),h=a("readable-stream"),i=c.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},j=c.IncomingMessage=function(a,c,d){function g(){j.read().then(function(a){if(!i._destroyed){if(a.done)return void i.push(null);i.push(new e(a.value)),g()}})["catch"](function(a){i.emit("error",a)})}var i=this;if(h.Readable.call(i),i._mode=d,i.headers={},i.rawHeaders=[],i.trailers={},i.rawTrailers=[],i.on("end",function(){b.nextTick(function(){i.emit("close")})}),"fetch"===d){i._fetchResponse=c,i.url=c.url,i.statusCode=c.status,i.statusMessage=c.statusText,c.headers.forEach(function(a,b){i.headers[b.toLowerCase()]=a,i.rawHeaders.push(b,a)});var j=c.body.getReader();g()}else{i._xhr=a,i._pos=0,i.url=a.responseURL,i.statusCode=a.status,i.statusMessage=a.statusText;var k=a.getAllResponseHeaders().split(/\r?\n/);if(k.forEach(function(a){var b=a.match(/^([^:]+):\s*(.*)/);if(b){var c=b[1].toLowerCase();"set-cookie"===c?(void 0===i.headers[c]&&(i.headers[c]=[]),i.headers[c].push(b[2])):void 0!==i.headers[c]?i.headers[c]+=", "+b[2]:i.headers[c]=b[2],i.rawHeaders.push(b[1],b[2])}}),i._charset="x-user-defined",!f.overrideMimeType){var l=i.rawHeaders["mime-type"];if(l){var m=l.match(/;\s*charset=([^;])(;|$)/);m&&(i._charset=m[1].toLowerCase())}i._charset||(i._charset="utf-8")}}};g(j,h.Readable),j.prototype._read=function(){},j.prototype._onXHRProgress=function(){var a=this,b=a._xhr,c=null;switch(a._mode){case"text:vbarray":if(b.readyState!==i.DONE)break;try{c=new d.VBArray(b.responseBody).toArray()}catch(f){}if(null!==c){a.push(new e(c));break}case"text":try{c=b.responseText}catch(f){a._mode="text:vbarray";break}if(c.length>a._pos){var g=c.substr(a._pos);if("x-user-defined"===a._charset){for(var h=new e(g.length),j=0;j<g.length;j++)h[j]=255&g.charCodeAt(j);a.push(h)}else a.push(g,a._charset);a._pos=c.length}break;case"arraybuffer":if(b.readyState!==i.DONE||!b.response)break;c=b.response,a.push(new e(new Uint8Array(c)));break;case"moz-chunked-arraybuffer":if(c=b.response,b.readyState!==i.LOADING||!c)break;a.push(new e(new Uint8Array(c)));break;case"ms-stream":if(c=b.response,b.readyState!==i.LOADING)break;var k=new d.MSStreamReader;k.onprogress=function(){k.result.byteLength>a._pos&&(a.push(new e(new Uint8Array(k.result.slice(a._pos)))),a._pos=k.result.byteLength)},k.onload=function(){a.push(null)},k.readAsArrayBuffer(c)}a._xhr.readyState===i.DONE&&"ms-stream"!==a._mode&&a.push(null)}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a("buffer").Buffer)},{"./capability":192,_process:141,buffer:39,inherits:87,"readable-stream":202}],195:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],196:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":198,"./_stream_writable":200,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],197:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":199,"core-util-is":54,dup:12,inherits:87}],198:[function(a,b,c){(function(c){function d(a,b,c){return"function"==typeof a.prependListener?a.prependListener(b,c):void(a._events&&a._events[b]?F(a._events[b])?a._events[b].unshift(c):a._events[b]=[c,a._events[b]]:a.on(b,c))}function e(b,c){D=D||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof D&&(this.objectMode=this.objectMode||!!b.readableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(N||(N=a("string_decoder/").StringDecoder),this.decoder=new N(b.encoding),this.encoding=b.encoding)}function f(b){return D=D||a("./_stream_duplex"),this instanceof f?(this._readableState=new e(b,this),this.readable=!0,b&&"function"==typeof b.read&&(this._read=b.read),void G.call(this)):new f(b)}function g(a,b,c,d,e){var f=k(b,c);if(f)a.emit("error",f);else if(null===c)b.reading=!1,l(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var g=new Error("stream.push() after EOF");a.emit("error",g)}else if(b.endEmitted&&e){var i=new Error("stream.unshift() after end event");a.emit("error",i)}else{var j;!b.decoder||e||d||(c=b.decoder.write(c),j=!b.objectMode&&0===c.length),e||(b.reading=!1),j||(b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&m(a))),o(a,b)}else e||(b.reading=!1);return h(b)}function h(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function i(a){return a>=P?a=P:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}function j(a,b){return 0>=a||0===b.length&&b.ended?0:b.objectMode?1:a!==a?b.flowing&&b.length?b.buffer.head.data.length:b.length:(a>b.highWaterMark&&(b.highWaterMark=i(a)),a<=b.length?a:b.ended?b.length:(b.needReadable=!0,0))}function k(a,b){var c=null;return I.isBuffer(b)||"string"==typeof b||null===b||void 0===b||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function l(a,b){if(!b.ended){if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,m(a)}}function m(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(M("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?E(n,a):n(a))}function n(a){M("emit readable"),a.emit("readable"),u(a)}function o(a,b){b.readingMore||(b.readingMore=!0,E(p,a,b))}function p(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(M("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function q(a){return function(){var b=a._readableState;M("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&H(a,"data")&&(b.flowing=!0,u(a))}}function r(a){M("readable nexttick read 0"),a.read(0)}function s(a,b){b.resumeScheduled||(b.resumeScheduled=!0,E(t,a,b))}function t(a,b){b.reading||(M("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),u(a),b.flowing&&!b.reading&&a.read(0)}function u(a){var b=a._readableState;for(M("flow",b.flowing);b.flowing&&null!==a.read(););}function v(a,b){if(0===b.length)return null;var c;return b.objectMode?c=b.buffer.shift():!a||a>=b.length?(c=b.decoder?b.buffer.join(""):1===b.buffer.length?b.buffer.head.data:b.buffer.concat(b.length),b.buffer.clear()):c=w(a,b.buffer,b.decoder),c}function w(a,b,c){var d;return a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):d=a===b.head.data.length?b.shift():c?x(a,b):y(a,b),d}function x(a,b){var c=b.head,d=1,e=c.data;for(a-=e.length;c=c.next;){var f=c.data,g=a>f.length?f.length:a;if(e+=g===f.length?f:f.slice(0,a),a-=g,0===a){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}return b.length-=d,e}function y(a,b){var c=J.allocUnsafe(a),d=b.head,e=1;for(d.data.copy(c),a-=d.data.length;d=d.next;){var f=d.data,g=a>f.length?f.length:a;if(f.copy(c,c.length-a,0,g),a-=g,0===a){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}return b.length-=e,c}function z(a){var b=a._readableState;if(b.length>0)throw new Error('"endReadable()" called on non-empty stream');b.endEmitted||(b.ended=!0,E(A,b,a))}function A(a,b){a.endEmitted||0!==a.length||(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function B(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function C(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}b.exports=f;var D,E=a("process-nextick-args"),F=a("isarray");f.ReadableState=e;var G,H=(a("events").EventEmitter,function(a,b){return a.listeners(b).length});!function(){try{G=a("stream")}catch(b){}finally{G||(G=a("events").EventEmitter)}}();var I=a("buffer").Buffer,J=a("buffer-shims"),K=a("core-util-is");K.inherits=a("inherits");var L=a("util"),M=void 0;M=L&&L.debuglog?L.debuglog("stream"):function(){};var N,O=a("./internal/streams/BufferList");K.inherits(f,G),f.prototype.push=function(a,b){var c=this._readableState;return c.objectMode||"string"!=typeof a||(b=b||c.defaultEncoding,b!==c.encoding&&(a=J.from(a,b),b="")),g(this,c,a,b,!1)},f.prototype.unshift=function(a){var b=this._readableState;return g(this,b,a,"",!0)},f.prototype.isPaused=function(){return this._readableState.flowing===!1},f.prototype.setEncoding=function(b){return N||(N=a("string_decoder/").StringDecoder),this._readableState.decoder=new N(b),this._readableState.encoding=b,this};var P=8388608;f.prototype.read=function(a){M("read",a),a=parseInt(a,10);var b=this._readableState,c=a;if(0!==a&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return M("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?z(this):m(this),null;if(a=j(a,b),0===a&&b.ended)return 0===b.length&&z(this),null;var d=b.needReadable;M("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,M("length less than watermark",d)),b.ended||b.reading?(d=!1,M("reading or ended",d)):d&&(M("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=j(c,b)));var e;return e=a>0?v(a,b):null,null===e?(b.needReadable=!0,a=0):b.length-=a,0===b.length&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&z(this)),null!==e&&this.emit("data",e),e},f.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))},f.prototype.pipe=function(a,b){function e(a){M("onunpipe"),a===m&&g()}function f(){M("onend"),a.end()}function g(){M("cleanup"),a.removeListener("close",j),a.removeListener("finish",k),a.removeListener("drain",r),a.removeListener("error",i),a.removeListener("unpipe",e),m.removeListener("end",f),m.removeListener("end",g),m.removeListener("data",h),s=!0,!n.awaitDrain||a._writableState&&!a._writableState.needDrain||r()}function h(b){M("ondata"),t=!1;var c=a.write(b);!1!==c||t||((1===n.pipesCount&&n.pipes===a||n.pipesCount>1&&-1!==C(n.pipes,a))&&!s&&(M("false write response, pause",m._readableState.awaitDrain),m._readableState.awaitDrain++,t=!0),m.pause())}function i(b){M("onerror",b),l(),a.removeListener("error",i),0===H(a,"error")&&a.emit("error",b)}function j(){a.removeListener("finish",k),l()}function k(){M("onfinish"),a.removeListener("close",j),l()}function l(){M("unpipe"),m.unpipe(a)}var m=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=a;break;case 1:n.pipes=[n.pipes,a];break;default:n.pipes.push(a)}n.pipesCount+=1,M("pipe count=%d opts=%j",n.pipesCount,b);var o=(!b||b.end!==!1)&&a!==c.stdout&&a!==c.stderr,p=o?f:g;n.endEmitted?E(p):m.once("end",p),a.on("unpipe",e);var r=q(m);a.on("drain",r);var s=!1,t=!1;return m.on("data",h),d(a,"error",i),a.once("close",j),a.once("finish",k),a.emit("pipe",m),
n.flowing||(M("pipe resume"),m.resume()),a},f.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var f=C(b.pipes,a);return-1===f?this:(b.pipes.splice(f,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},f.prototype.on=function(a,b){var c=G.prototype.on.call(this,a,b);if("data"===a)this._readableState.flowing!==!1&&this.resume();else if("readable"===a){var d=this._readableState;d.endEmitted||d.readableListening||(d.readableListening=d.needReadable=!0,d.emittedReadable=!1,d.reading?d.length&&m(this,d):E(r,this))}return c},f.prototype.addListener=f.prototype.on,f.prototype.resume=function(){var a=this._readableState;return a.flowing||(M("resume"),a.flowing=!0,s(this,a)),this},f.prototype.pause=function(){return M("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(M("pause"),this._readableState.flowing=!1,this.emit("pause")),this},f.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(M("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(M("wrapped data"),b.decoder&&(e=b.decoder.write(e)),(!b.objectMode||null!==e&&void 0!==e)&&(b.objectMode||e&&e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)void 0===this[e]&&"function"==typeof a[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return B(f,function(b){a.on(b,d.emit.bind(d,b))}),d._read=function(b){M("wrapped _read",b),c&&(c=!1,a.resume())},d},f._fromList=v}).call(this,a("_process"))},{"./_stream_duplex":196,"./internal/streams/BufferList":201,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,events:70,inherits:87,isarray:195,"process-nextick-args":140,"string_decoder/":206,util:36}],199:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":196,"core-util-is":54,dup:14,inherits:87}],200:[function(a,b,c){(function(c){function d(){}function e(a,b,c){this.chunk=a,this.encoding=b,this.callback=c,this.next=null}function f(b,c){x=x||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof x&&(this.objectMode=this.objectMode||!!b.writableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var f=b.decodeStrings===!1;this.decodeStrings=!f,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){o(c,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this)}function g(b){return x=x||a("./_stream_duplex"),F.call(g,this)||this instanceof x?(this._writableState=new f(b,this),this.writable=!0,b&&("function"==typeof b.write&&(this._write=b.write),"function"==typeof b.writev&&(this._writev=b.writev)),void B.call(this)):new g(b)}function h(a,b){var c=new Error("write after end");a.emit("error",c),y(b,c)}function i(a,b,c,d){var e=!0,f=!1;return null===c?f=new TypeError("May not write null values to stream"):"string"==typeof c||void 0===c||b.objectMode||(f=new TypeError("Invalid non-string/buffer chunk")),f&&(a.emit("error",f),y(d,f),e=!1),e}function j(a,b,c){return a.objectMode||a.decodeStrings===!1||"string"!=typeof b||(b=E.from(b,c)),b}function k(a,b,c,d,f,g){c||(d=j(b,d,f),D.isBuffer(d)&&(f="buffer"));var h=b.objectMode?1:d.length;b.length+=h;var i=b.length<b.highWaterMark;if(i||(b.needDrain=!0),b.writing||b.corked){var k=b.lastBufferedRequest;b.lastBufferedRequest=new e(d,f,g),k?k.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else l(a,b,!1,h,d,f,g);return i}function l(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function m(a,b,c,d,e){--b.pendingcb,c?y(e,d):e(d),a._writableState.errorEmitted=!0,a.emit("error",d)}function n(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function o(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(n(c),b)m(a,c,d,b,e);else{var f=s(c);f||c.corked||c.bufferProcessing||!c.bufferedRequest||r(a,c),d?z(p,a,c,f,e):p(a,c,f,e)}}function p(a,b,c,d){c||q(a,b),b.pendingcb--,d(),u(a,b)}function q(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function r(a,b){b.bufferProcessing=!0;var c=b.bufferedRequest;if(a._writev&&c&&c.next){var d=b.bufferedRequestCount,e=new Array(d),f=b.corkedRequestsFree;f.entry=c;for(var g=0;c;)e[g]=c,c=c.next,g+=1;l(a,b,!0,b.length,e,"",f.finish),b.pendingcb++,b.lastBufferedRequest=null,f.next?(b.corkedRequestsFree=f.next,f.next=null):b.corkedRequestsFree=new w(b)}else{for(;c;){var h=c.chunk,i=c.encoding,j=c.callback,k=b.objectMode?1:h.length;if(l(a,b,!1,k,h,i,j),c=c.next,b.writing)break}null===c&&(b.lastBufferedRequest=null)}b.bufferedRequestCount=0,b.bufferedRequest=c,b.bufferProcessing=!1}function s(a){return a.ending&&0===a.length&&null===a.bufferedRequest&&!a.finished&&!a.writing}function t(a,b){b.prefinished||(b.prefinished=!0,a.emit("prefinish"))}function u(a,b){var c=s(b);return c&&(0===b.pendingcb?(t(a,b),b.finished=!0,a.emit("finish")):t(a,b)),c}function v(a,b,c){b.ending=!0,u(a,b),c&&(b.finished?y(c):a.once("finish",c)),b.ended=!0,a.writable=!1}function w(a){var b=this;this.next=null,this.entry=null,this.finish=function(c){var d=b.entry;for(b.entry=null;d;){var e=d.callback;a.pendingcb--,e(c),d=d.next}a.corkedRequestsFree?a.corkedRequestsFree.next=b:a.corkedRequestsFree=b}}b.exports=g;var x,y=a("process-nextick-args"),z=!c.browser&&["v0.10","v0.9."].indexOf(c.version.slice(0,5))>-1?setImmediate:y;g.WritableState=f;var A=a("core-util-is");A.inherits=a("inherits");var B,C={deprecate:a("util-deprecate")};!function(){try{B=a("stream")}catch(b){}finally{B||(B=a("events").EventEmitter)}}();var D=a("buffer").Buffer,E=a("buffer-shims");A.inherits(g,B),f.prototype.getBuffer=function(){for(var a=this.bufferedRequest,b=[];a;)b.push(a),a=a.next;return b},function(){try{Object.defineProperty(f.prototype,"buffer",{get:C.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(a){}}();var F;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(F=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(a){return F.call(this,a)?!0:a&&a._writableState instanceof f}})):F=function(a){return a instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(a,b,c){var e=this._writableState,f=!1,g=D.isBuffer(a);return"function"==typeof b&&(c=b,b=null),g?b="buffer":b||(b=e.defaultEncoding),"function"!=typeof c&&(c=d),e.ended?h(this,c):(g||i(this,e,a,c))&&(e.pendingcb++,f=k(this,e,g,a,b,c)),f},g.prototype.cork=function(){var a=this._writableState;a.corked++},g.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.bufferedRequest||r(this,a))},g.prototype.setDefaultEncoding=function(a){if("string"==typeof a&&(a=a.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);return this._writableState.defaultEncoding=a,this},g.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),null!==a&&void 0!==a&&this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||v(this,d,c)}}).call(this,a("_process"))},{"./_stream_duplex":196,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,events:70,inherits:87,"process-nextick-args":140,"util-deprecate":219}],201:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],202:[function(a,b,c){(function(d){var e=function(){try{return a("stream")}catch(b){}}();c=b.exports=a("./lib/_stream_readable.js"),c.Stream=e||c,c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js"),!d.browser&&"disable"===d.env.READABLE_STREAM&&e&&(b.exports=e)}).call(this,a("_process"))},{"./lib/_stream_duplex.js":196,"./lib/_stream_passthrough.js":197,"./lib/_stream_readable.js":198,"./lib/_stream_transform.js":199,"./lib/_stream_writable.js":200,_process:141}],203:[function(a,b,c){var d=a("stream-to-blob");b.exports=function e(a,b,c){return"function"==typeof b?e(a,null,b):void d(a,b,function(a,b){if(a)return c(a);var d=URL.createObjectURL(b);c(null,d)})}},{"stream-to-blob":204}],204:[function(a,b,c){var d=a("once");b.exports=function e(a,b,c){if("function"==typeof b)return e(a,null,b);c=d(c);var f=[];a.on("data",function(a){f.push(a)}).on("end",function(){var a=b?new Blob(f,{type:b}):new Blob(f);c(null,a)}).on("error",c)}},{once:135}],205:[function(a,b,c){(function(c){var d=a("once");b.exports=function(a,b,e){e=d(e);var f=new c(b),g=0;a.on("data",function(a){a.copy(f,g),g+=a.length}).on("end",function(){e(null,f)}).on("error",e)}}).call(this,a("buffer").Buffer)},{buffer:39,once:135}],206:[function(a,b,c){function d(a){if(a&&!i(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){this.charReceived=a.length%2,this.charLength=this.charReceived?2:0}function g(a){this.charReceived=a.length%3,this.charLength=this.charReceived?3:0}var h=a("buffer").Buffer,i=h.isEncoding||function(a){switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},j=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return void(this.write=e)}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};j.prototype.write=function(a){for(var b="";this.charLength;){var c=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,0,c),this.charReceived+=c,this.charReceived<this.charLength)return"";a=a.slice(c,a.length),b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var d=b.charCodeAt(b.length-1);if(!(d>=55296&&56319>=d)){if(this.charReceived=this.charLength=0,0===a.length)return b;break}this.charLength+=this.surrogateSize,b=""}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived),b+=a.toString(this.encoding,0,e);var e=b.length-1,d=b.charCodeAt(e);if(d>=55296&&56319>=d){var f=this.surrogateSize;return this.charLength+=f,this.charReceived+=f,this.charBuffer.copy(this.charBuffer,f,0,f),a.copy(this.charBuffer,0,0,f),b.substring(0,e)}return b},j.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(2>=b&&c>>4==14){this.charLength=3;break}if(3>=b&&c>>3==30){this.charLength=4;break}}this.charReceived=b},j.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:39}],207:[function(a,b,c){var d=a("./thirty-two");c.encode=d.encode,c.decode=d.decode},{"./thirty-two":208}],208:[function(a,b,c){(function(a){function b(a){var b=Math.floor(a.length/5);return a.length%5===0?b:b+1}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",e=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];c.encode=function(c){a.isBuffer(c)||(c=new a(c));for(var e=0,f=0,g=0,h=0,i=new a(8*b(c));e<c.length;){var j=c[e];g>3?(h=j&255>>g,g=(g+5)%8,h=h<<g|(e+1<c.length?c[e+1]:0)>>8-g,e++):(h=j>>8-(g+5)&31,g=(g+5)%8,0===g&&e++),i[f]=d.charCodeAt(h),f++}for(e=f;e<i.length;e++)i[e]=61;return i},c.decode=function(b){var c,d=0,f=0,g=0;a.isBuffer(b)||(b=new a(b));for(var h=new a(Math.ceil(5*b.length/8)),i=0;i<b.length&&61!==b[i];i++){var j=b[i]-48;if(!(j<e.length))throw new Error("Invalid input - it is not base32 encoded string");f=e[j],3>=d?(d=(d+5)%8,0===d?(c|=f,h[g]=c,g++,c=0):c|=255&f<<8-d):(d=(d+5)%8,c|=255&f>>>d,h[g]=c,g++,c=255&f<<8-d)}return h.slice(0,g)}}).call(this,a("buffer").Buffer)},{buffer:39}],209:[function(a,b,c){var d=a("buffer").Buffer;b.exports=function(a){if(a instanceof Uint8Array){if(0===a.byteOffset&&a.byteLength===a.buffer.byteLength)return a.buffer;if("function"==typeof a.buffer.slice)return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}if(d.isBuffer(a)){for(var b=new Uint8Array(a.length),c=a.length,e=0;c>e;e++)b[e]=a[e];return b.buffer}throw new Error("Argument must be a Buffer")}},{buffer:39}],210:[function(a,b,c){(function(c){function d(a){function b(a,b){var c=new f(b);return c.on("warning",e._onWarning),c.on("error",e._onError),c.listen(a),e._internalDHT=!0,c}var e=this;if(!(e instanceof d))return new d(a);if(g.call(e),!a.peerId)throw new Error("Option `peerId` is required");if(!a.infoHash)throw new Error("Option `infoHash` is required");if(!c.browser&&!a.port)throw new Error("Option `port` is required");e.peerId="string"==typeof a.peerId?a.peerId:a.peerId.toString("hex"),e.infoHash="string"==typeof a.infoHash?a.infoHash:a.infoHash.toString("hex"),e._port=a.port,e._userAgent=a.userAgent,e.destroyed=!1,e._announce=a.announce||[],e._intervalMs=a.intervalMs||9e5,e._trackerOpts=null,e._dhtAnnouncing=!1,e._dhtTimeout=!1,e._internalDHT=!1,e._onWarning=function(a){e.emit("warning",a)},e._onError=function(a){e.emit("error",a)},e._onDHTPeer=function(a,b){b.toString("hex")===e.infoHash&&e.emit("peer",a.host+":"+a.port,"dht")},e._onTrackerPeer=function(a){e.emit("peer",a,"tracker")},e._onTrackerAnnounce=function(){e.emit("trackerAnnounce")},a.tracker===!1?e.tracker=null:a.tracker&&"object"==typeof a.tracker?(e._trackerOpts=h(a.tracker),e.tracker=e._createTracker()):e.tracker=e._createTracker(),a.dht===!1||"function"!=typeof f?e.dht=null:a.dht&&"function"==typeof a.dht.addNode?e.dht=a.dht:a.dht&&"object"==typeof a.dht?e.dht=b(a.dhtPort,a.dht):e.dht=b(a.dhtPort),e.dht&&(e.dht.on("peer",e._onDHTPeer),e._dhtAnnounce())}b.exports=d;var e=a("debug")("torrent-discovery"),f=a("bittorrent-dht/client"),g=a("events").EventEmitter,h=a("xtend"),i=a("inherits"),j=a("run-parallel"),k=a("bittorrent-tracker/client");i(d,g),d.prototype.updatePort=function(a){var b=this;a!==b._port&&(b._port=a,b.dht&&b._dhtAnnounce(),b.tracker&&(b.tracker.stop(),b.tracker.destroy(function(){b.tracker=b._createTracker()})))},d.prototype.complete=function(a){this.tracker&&this.tracker.complete(a)},d.prototype.destroy=function(a){var b=this;if(!b.destroyed){b.destroyed=!0,clearTimeout(b._dhtTimeout);var c=[];b.tracker&&(b.tracker.stop(),b.tracker.removeListener("warning",b._onWarning),b.tracker.removeListener("error",b._onError),b.tracker.removeListener("peer",b._onTrackerPeer),b.tracker.removeListener("update",b._onTrackerAnnounce),c.push(function(a){b.tracker.destroy(a)})),b.dht&&b.dht.removeListener("peer",b._onDHTPeer),b._internalDHT&&(b.dht.removeListener("warning",b._onWarning),b.dht.removeListener("error",b._onError),c.push(function(a){b.dht.destroy(a)})),j(c,a),b.dht=null,b.tracker=null,b._announce=null}},d.prototype._createTracker=function(){var a=h(this._trackerOpts,{infoHash:this.infoHash,announce:this._announce,peerId:this.peerId,port:this._port,userAgent:this._userAgent}),b=new k(a);return b.on("warning",this._onWarning),b.on("error",this._onError),b.on("peer",this._onTrackerPeer),b.on("update",this._onTrackerAnnounce),b.setInterval(this._intervalMs),b.start(),b},d.prototype._dhtAnnounce=function(){function a(){return b._intervalMs+Math.floor(Math.random()*b._intervalMs/5)}var b=this;b._dhtAnnouncing||(e("dht announce"),b._dhtAnnouncing=!0,clearTimeout(b._dhtTimeout),b.dht.announce(b.infoHash,b._port,function(c){b._dhtAnnouncing=!1,e("dht announce complete"),c&&b.emit("warning",c),b.emit("dhtAnnounce"),b.destroyed||(b._dhtTimeout=setTimeout(function(){b._dhtAnnounce()},a()),b._dhtTimeout.unref&&b._dhtTimeout.unref())}))}}).call(this,a("_process"))},{_process:141,"bittorrent-dht/client":36,"bittorrent-tracker/client":20,debug:66,events:70,inherits:87,"run-parallel":162,xtend:243}],211:[function(a,b,c){(function(a){function c(a){return this instanceof c?(this.length=a,this.missing=a,this.sources=null,this._chunks=Math.ceil(a/d),this._remainder=a%d||d,this._buffered=0,this._buffer=null,this._cancellations=null,this._reservations=0,void(this._flushed=!1)):new c(a)}b.exports=c;var d=16384;c.BLOCK_LENGTH=d,c.prototype.chunkLength=function(a){return a===this._chunks-1?this._remainder:d},c.prototype.chunkLengthRemaining=function(a){return this.length-a*d},c.prototype.chunkOffset=function(a){return a*d},c.prototype.reserve=function(){return this.init()?this._cancellations.length?this._cancellations.pop():this._reservations<this._chunks?this._reservations++:-1:-1},c.prototype.reserveRemaining=function(){if(!this.init())return-1;if(this._reservations<this._chunks){var a=this._reservations;return this._reservations=this._chunks,a}return-1},c.prototype.cancel=function(a){this.init()&&this._cancellations.push(a)},c.prototype.cancelRemaining=function(a){this.init()&&(this._reservations=a)},c.prototype.get=function(a){return this.init()?this._buffer[a]:null},c.prototype.set=function(a,b,c){if(!this.init())return!1;for(var e=b.length,f=Math.ceil(e/d),g=0;f>g;g++)if(!this._buffer[a+g]){var h=g*d,i=b.slice(h,h+d);this._buffered++,this._buffer[a+g]=i,this.missing-=i.length,-1===this.sources.indexOf(c)&&this.sources.push(c)}return this._buffered===this._chunks},c.prototype.flush=function(){if(!this._buffer||this._chunks!==this._buffered)return null;var b=a.concat(this._buffer,this.length);return this._buffer=null,this._cancellations=null,this.sources=null,this._flushed=!0,b},c.prototype.init=function(){return this._flushed?!1:this._buffer?!0:(this._buffer=new Array(this._chunks),this._cancellations=[],this.sources=[],!0)}}).call(this,a("buffer").Buffer)},{buffer:39}],212:[function(a,b,c){(function(c){var d=a("is-typedarray").strict;b.exports=function(a){if(d(a)){var b=new c(a.buffer);return a.byteLength!==a.buffer.byteLength&&(b=b.slice(a.byteOffset,a.byteOffset+a.byteLength)),b}return new c(a)}}).call(this,a("buffer").Buffer)},{buffer:39,"is-typedarray":91}],213:[function(a,b,c){(function(a){var b=4294967295;c.encodingLength=function(){return 8},c.encode=function(c,d,e){d||(d=new a(8)),e||(e=0);var f=Math.floor(c/b),g=c-f*b;return d.writeUInt32BE(f,e),d.writeUInt32BE(g,e+4),d},c.decode=function(c,d){d||(d=0),c||(c=new a(4)),d||(d=0);var e=c.readUInt32BE(d),f=c.readUInt32BE(d+4);return e*b+f},c.encode.bytes=8,c.decode.bytes=8}).call(this,a("buffer").Buffer)},{buffer:39}],214:[function(a,b,c){function d(a,b){for(var c=1,d=a.length,e=a[0],f=a[0],g=1;d>g;++g)if(f=e,e=a[g],b(e,f)){if(g===c){c++;continue}a[c++]=e}return a.length=c,a}function e(a){for(var b=1,c=a.length,d=a[0],e=a[0],f=1;c>f;++f,e=d)if(e=d,d=a[f],d!==e){if(f===b){b++;continue}a[b++]=d}return a.length=b,a}function f(a,b,c){return 0===a.length?a:b?(c||a.sort(b),d(a,b)):(c||a.sort(),e(a))}b.exports=f},{}],215:[function(a,b,c){function d(a,b){if(!(b>=a.length||0>b)){var c=a.pop();if(b<a.length){var d=a[b];return a[b]=c,d}return c}}b.exports=d},{}],216:[function(a,b,c){function d(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function e(a,b,c){if(a&&j.isObject(a)&&a instanceof d)return a;var e=new d;return e.parse(a,b,c),e}function f(a){return j.isString(a)&&(a=e(a)),a instanceof d?a.format():d.prototype.format.call(a)}function g(a,b){return e(a,!1,!0).resolve(b)}function h(a,b){return a?e(a,!1,!0).resolveObject(b):b}var i=a("punycode"),j=a("./util");c.parse=e,c.resolve=g,c.resolveObject=h,c.format=f,c.Url=d;var k=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,m=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r","\n","	"],o=["{","}","|","\\","^","`"].concat(n),p=["'"].concat(o),q=["%","/","?",";","#"].concat(p),r=["/","?","#"],s=255,t=/^[+a-z0-9A-Z_-]{0,63}$/,u=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=a("querystring");d.prototype.parse=function(a,b,c){if(!j.isString(a))throw new TypeError("Parameter 'url' must be a string, not "+typeof a);var d=a.indexOf("?"),e=-1!==d&&d<a.indexOf("#")?"?":"#",f=a.split(e),g=/\\/g;f[0]=f[0].replace(g,"/"),a=f.join(e);var h=a;if(h=h.trim(),!c&&1===a.split("#").length){var l=m.exec(h);if(l)return this.path=h,this.href=h,this.pathname=l[1],l[2]?(this.search=l[2],b?this.query=y.parse(this.search.substr(1)):this.query=this.search.substr(1)):b&&(this.search="",this.query={}),this}var n=k.exec(h);if(n){n=n[0];var o=n.toLowerCase();this.protocol=o,h=h.substr(n.length)}if(c||n||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var z="//"===h.substr(0,2);!z||n&&w[n]||(h=h.substr(2),this.slashes=!0)}if(!w[n]&&(z||n&&!x[n])){for(var A=-1,B=0;B<r.length;B++){var C=h.indexOf(r[B]);-1!==C&&(-1===A||A>C)&&(A=C)}var D,E;E=-1===A?h.lastIndexOf("@"):h.lastIndexOf("@",A),-1!==E&&(D=h.slice(0,E),h=h.slice(E+1),this.auth=decodeURIComponent(D)),A=-1;for(var B=0;B<q.length;B++){var C=h.indexOf(q[B]);-1!==C&&(-1===A||A>C)&&(A=C)}-1===A&&(A=h.length),this.host=h.slice(0,A),h=h.slice(A),this.parseHost(),this.hostname=this.hostname||"";var F="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!F)for(var G=this.hostname.split(/\./),B=0,H=G.length;H>B;B++){var I=G[B];if(I&&!I.match(t)){for(var J="",K=0,L=I.length;L>K;K++)J+=I.charCodeAt(K)>127?"x":I[K];if(!J.match(t)){var M=G.slice(0,B),N=G.slice(B+1),O=I.match(u);O&&(M.push(O[1]),N.unshift(O[2])),N.length&&(h="/"+N.join(".")+h),this.hostname=M.join(".");break}}}this.hostname.length>s?this.hostname="":this.hostname=this.hostname.toLowerCase(),F||(this.hostname=i.toASCII(this.hostname));var P=this.port?":"+this.port:"",Q=this.hostname||"";this.host=Q+P,this.href+=this.host,F&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!v[o])for(var B=0,H=p.length;H>B;B++){var R=p[B];if(-1!==h.indexOf(R)){var S=encodeURIComponent(R);S===R&&(S=escape(R)),h=h.split(R).join(S)}}var T=h.indexOf("#");-1!==T&&(this.hash=h.substr(T),h=h.slice(0,T));var U=h.indexOf("?");if(-1!==U?(this.search=h.substr(U),this.query=h.substr(U+1),b&&(this.query=y.parse(this.query)),h=h.slice(0,U)):b&&(this.search="",this.query={}),h&&(this.pathname=h),x[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var P=this.pathname||"",V=this.search||"";this.path=P+V}return this.href=this.format(),this},d.prototype.format=function(){var a=this.auth||"";a&&(a=encodeURIComponent(a),a=a.replace(/%3A/i,":"),a+="@");var b=this.protocol||"",c=this.pathname||"",d=this.hash||"",e=!1,f="";this.host?e=a+this.host:this.hostname&&(e=a+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(e+=":"+this.port)),this.query&&j.isObject(this.query)&&Object.keys(this.query).length&&(f=y.stringify(this.query));var g=this.search||f&&"?"+f||"";return b&&":"!==b.substr(-1)&&(b+=":"),this.slashes||(!b||x[b])&&e!==!1?(e="//"+(e||""),c&&"/"!==c.charAt(0)&&(c="/"+c)):e||(e=""),d&&"#"!==d.charAt(0)&&(d="#"+d),g&&"?"!==g.charAt(0)&&(g="?"+g),c=c.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),g=g.replace("#","%23"),b+e+c+g+d},d.prototype.resolve=function(a){return this.resolveObject(e(a,!1,!0)).format()},d.prototype.resolveObject=function(a){if(j.isString(a)){var b=new d;b.parse(a,!1,!0),a=b}for(var c=new d,e=Object.keys(this),f=0;f<e.length;f++){var g=e[f];c[g]=this[g]}if(c.hash=a.hash,""===a.href)return c.href=c.format(),c;if(a.slashes&&!a.protocol){for(var h=Object.keys(a),i=0;i<h.length;i++){var k=h[i];"protocol"!==k&&(c[k]=a[k])}return x[c.protocol]&&c.hostname&&!c.pathname&&(c.path=c.pathname="/"),c.href=c.format(),c}if(a.protocol&&a.protocol!==c.protocol){if(!x[a.protocol]){for(var l=Object.keys(a),m=0;m<l.length;m++){var n=l[m];c[n]=a[n]}return c.href=c.format(),c}if(c.protocol=a.protocol,a.host||w[a.protocol])c.pathname=a.pathname;else{for(var o=(a.pathname||"").split("/");o.length&&!(a.host=o.shift()););a.host||(a.host=""),a.hostname||(a.hostname=""),""!==o[0]&&o.unshift(""),o.length<2&&o.unshift(""),c.pathname=o.join("/")}if(c.search=a.search,c.query=a.query,c.host=a.host||"",c.auth=a.auth,c.hostname=a.hostname||a.host,c.port=a.port,c.pathname||c.search){var p=c.pathname||"",q=c.search||"";c.path=p+q}return c.slashes=c.slashes||a.slashes,c.href=c.format(),c}var r=c.pathname&&"/"===c.pathname.charAt(0),s=a.host||a.pathname&&"/"===a.pathname.charAt(0),t=s||r||c.host&&a.pathname,u=t,v=c.pathname&&c.pathname.split("/")||[],o=a.pathname&&a.pathname.split("/")||[],y=c.protocol&&!x[c.protocol];if(y&&(c.hostname="",c.port=null,c.host&&(""===v[0]?v[0]=c.host:v.unshift(c.host)),c.host="",a.protocol&&(a.hostname=null,a.port=null,a.host&&(""===o[0]?o[0]=a.host:o.unshift(a.host)),a.host=null),t=t&&(""===o[0]||""===v[0])),s)c.host=a.host||""===a.host?a.host:c.host,c.hostname=a.hostname||""===a.hostname?a.hostname:c.hostname,c.search=a.search,c.query=a.query,v=o;else if(o.length)v||(v=[]),v.pop(),v=v.concat(o),c.search=a.search,c.query=a.query;else if(!j.isNullOrUndefined(a.search)){if(y){c.hostname=c.host=v.shift();var z=c.host&&c.host.indexOf("@")>0?c.host.split("@"):!1;z&&(c.auth=z.shift(),c.host=c.hostname=z.shift())}return c.search=a.search,c.query=a.query,j.isNull(c.pathname)&&j.isNull(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.href=c.format(),c}if(!v.length)return c.pathname=null,c.search?c.path="/"+c.search:c.path=null,c.href=c.format(),c;for(var A=v.slice(-1)[0],B=(c.host||a.host||v.length>1)&&("."===A||".."===A)||""===A,C=0,D=v.length;D>=0;D--)A=v[D],"."===A?v.splice(D,1):".."===A?(v.splice(D,1),C++):C&&(v.splice(D,1),C--);if(!t&&!u)for(;C--;C)v.unshift("..");!t||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),B&&"/"!==v.join("/").substr(-1)&&v.push("");var E=""===v[0]||v[0]&&"/"===v[0].charAt(0);if(y){c.hostname=c.host=E?"":v.length?v.shift():"";var z=c.host&&c.host.indexOf("@")>0?c.host.split("@"):!1;z&&(c.auth=z.shift(),c.host=c.hostname=z.shift())}return t=t||c.host&&v.length,t&&!E&&v.unshift(""),v.length?c.pathname=v.join("/"):(c.pathname=null,c.path=null),j.isNull(c.pathname)&&j.isNull(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.auth=a.auth||c.auth,c.slashes=c.slashes||a.slashes,c.href=c.format(),c},d.prototype.parseHost=function(){var a=this.host,b=l.exec(a);b&&(b=b[0],":"!==b&&(this.port=b.substr(1)),a=a.substr(0,a.length-b.length)),a&&(this.hostname=a)}},{"./util":217,punycode:142,querystring:145}],217:[function(a,b,c){b.exports={isString:function(a){return"string"==typeof a},isObject:function(a){return"object"==typeof a&&null!==a},isNull:function(a){return null===a},isNullOrUndefined:function(a){return null==a}}},{}],218:[function(a,b,c){var d=a("bencode"),e=a("bitfield"),f=a("safe-buffer").Buffer,g=a("debug")("ut_metadata"),h=a("events").EventEmitter,i=a("inherits"),j=a("simple-sha1"),k=1e7,l=1e3,m=16384;b.exports=function(a){function b(b){h.call(this),this._wire=b,this._metadataComplete=!1,this._metadataSize=null,this._remainingRejects=null,this._fetching=!1,this._bitfield=new e(0,{grow:l}),f.isBuffer(a)&&this.setMetadata(a)}return i(b,h),b.prototype.name="ut_metadata",b.prototype.onHandshake=function(a,b,c){this._infoHash=a},b.prototype.onExtendedHandshake=function(a){return a.m&&a.m.ut_metadata?a.metadata_size?"number"!=typeof a.metadata_size||k<a.metadata_size||a.metadata_size<=0?this.emit("warning",new Error("Peer gave invalid metadata size")):(this._metadataSize=a.metadata_size,this._numPieces=Math.ceil(this._metadataSize/m),this._remainingRejects=2*this._numPieces,void(this._fetching&&this._requestPieces())):this.emit("warning",new Error("Peer does not have metadata")):this.emit("warning",new Error("Peer does not support ut_metadata"))},b.prototype.onMessage=function(a){var b,c;try{var e=a.toString(),f=e.indexOf("ee")+2;b=d.decode(e.substring(0,f)),c=a.slice(f)}catch(g){return}switch(b.msg_type){case 0:this._onRequest(b.piece);break;case 1:this._onData(b.piece,c,b.total_size);break;case 2:this._onReject(b.piece)}},b.prototype.fetch=function(){this._metadataComplete||(this._fetching=!0,this._metadataSize&&this._requestPieces())},b.prototype.cancel=function(){this._fetching=!1},b.prototype.setMetadata=function(a){if(this._metadataComplete)return!0;g("set metadata");try{var b=d.decode(a).info;b&&(a=d.encode(b))}catch(c){}return this._infoHash&&this._infoHash!==j.sync(a)?!1:(this.cancel(),this.metadata=a,this._metadataComplete=!0,this._metadataSize=this.metadata.length,this._wire.extendedHandshake.metadata_size=this._metadataSize,this.emit("metadata",d.encode({info:d.decode(this.metadata)})),!0)},b.prototype._send=function(a,b){var c=d.encode(a);f.isBuffer(b)&&(c=f.concat([c,b])),this._wire.extended("ut_metadata",c)},b.prototype._request=function(a){this._send({msg_type:0,piece:a})},b.prototype._data=function(a,b,c){var d={msg_type:1,piece:a};"number"==typeof c&&(d.total_size=c),this._send(d,b)},b.prototype._reject=function(a){this._send({msg_type:2,piece:a})},b.prototype._onRequest=function(a){if(!this._metadataComplete)return void this._reject(a);var b=a*m,c=b+m;c>this._metadataSize&&(c=this._metadataSize);var d=this.metadata.slice(b,c);this._data(a,d,this._metadataSize)},b.prototype._onData=function(a,b,c){b.length>m||(b.copy(this.metadata,a*m),this._bitfield.set(a),this._checkDone())},b.prototype._onReject=function(a){this._remainingRejects>0&&this._fetching?(this._request(a),this._remainingRejects-=1):this.emit("warning",new Error('Peer sent "reject" too much'))},b.prototype._requestPieces=function(){this.metadata=f.alloc(this._metadataSize);for(var a=0;a<this._numPieces;a++)this._request(a)},b.prototype._checkDone=function(){for(var a=!0,b=0;b<this._numPieces;b++)if(!this._bitfield.get(b)){a=!1;break}if(a){var c=this.setMetadata(this.metadata);c||this._failedMetadata()}},b.prototype._failedMetadata=function(){this._bitfield=new e(0,{grow:l}),this._remainingRejects-=this._numPieces,this._remainingRejects>0?this._requestPieces():this.emit("warning",new Error("Peer sent invalid metadata"))},b}},{bencode:6,bitfield:8,debug:66,events:70,inherits:87,"safe-buffer":164,"simple-sha1":178}],219:[function(a,b,c){(function(a){function c(a,b){function c(){if(!e){if(d("throwDeprecation"))throw new Error(b);d("traceDeprecation")?console.trace(b):console.warn(b),e=!0}return a.apply(this,arguments)}if(d("noDeprecation"))return a;var e=!1;return c}function d(b){try{if(!a.localStorage)return!1}catch(c){return!1}var d=a.localStorage[b];
return null==d?!1:"true"===String(d).toLowerCase()}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],220:[function(a,b,c){(function(c){function d(a){var b=this;h.call(b),b._tracks=[],b._fragmentSequence=1,b._file=a,b._decoder=null,b._findMoov(0)}function e(a,b){var c=this;c._entries=a,c._countName=b||"count",c._index=0,c._offset=0,c.value=c._entries[0]}function f(){return{version:0,flags:0,entries:[]}}var g=a("binary-search"),h=a("events").EventEmitter,i=a("inherits"),j=a("mp4-stream"),k=a("mp4-box-encoding"),l=a("range-slice-stream");b.exports=d,i(d,h),d.prototype._findMoov=function(a){var b=this;b._decoder&&b._decoder.destroy(),b._decoder=j.decode();var c=b._file.createReadStream({start:a});c.pipe(b._decoder),b._decoder.once("box",function(d){"moov"===d.type?b._decoder.decode(function(a){c.destroy();try{b._processMoov(a)}catch(d){d.message="Cannot parse mp4 file: "+d.message,b.emit("error",d)}}):(c.destroy(),b._findMoov(a+d.length))})},e.prototype.inc=function(){var a=this;a._offset++,a._offset>=a._entries[a._index][a._countName]&&(a._index++,a._offset=0),a.value=a._entries[a._index]},d.prototype._processMoov=function(a){var b=this,d=a.traks;b._tracks=[],b._hasVideo=!1,b._hasAudio=!1;for(var g=0;g<d.length;g++){var h,i,j=d[g],l=j.mdia.minf.stbl,m=l.stsd.entries[0],n=j.mdia.hdlr.handlerType;if("vide"===n&&"avc1"===m.type){if(b._hasVideo)continue;b._hasVideo=!0,h="avc1",m.avcC&&(h+="."+m.avcC.mimeCodec),i='video/mp4; codecs="'+h+'"'}else{if("soun"!==n||"mp4a"!==m.type)continue;if(b._hasAudio)continue;b._hasAudio=!0,h="mp4a",m.esds&&m.esds.mimeCodec&&(h+="."+m.esds.mimeCodec),i='audio/mp4; codecs="'+h+'"'}var o=[],p=0,q=0,r=0,s=0,t=0,u=0,v=new e(l.stts.entries),w=null;l.ctts&&(w=new e(l.ctts.entries));for(var x=0;;){var y=l.stsc.entries[t],z=l.stsz.entries[p],A=v.value.duration,B=w?w.value.compositionOffset:0,C=!0;if(l.stss&&(C=l.stss.entries[x]===p+1),o.push({size:z,duration:A,dts:u,presentationOffset:B,sync:C,offset:s+l.stco.entries[r]}),p++,p>=l.stsz.entries.length)break;if(q++,s+=z,q>=y.samplesPerChunk){q=0,s=0,r++;var D=l.stsc.entries[t+1];D&&r+1>=D.firstChunk&&t++}u+=A,v.inc(),w&&w.inc(),C&&x++}j.mdia.mdhd.duration=0,j.tkhd.duration=0;var E=y.sampleDescriptionId,F={type:"moov",mvhd:a.mvhd,traks:[{tkhd:j.tkhd,mdia:{mdhd:j.mdia.mdhd,hdlr:j.mdia.hdlr,elng:j.mdia.elng,minf:{vmhd:j.mdia.minf.vmhd,smhd:j.mdia.minf.smhd,dinf:j.mdia.minf.dinf,stbl:{stsd:l.stsd,stts:f(),ctts:f(),stsc:f(),stsz:f(),stco:f(),stss:f()}}}}],mvex:{mehd:{fragmentDuration:a.mvhd.duration},trexs:[{trackId:j.tkhd.trackId,defaultSampleDescriptionIndex:E,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0}]}};b._tracks.push({trackId:j.tkhd.trackId,timeScale:j.mdia.mdhd.timeScale,samples:o,currSample:null,currTime:null,moov:F,mime:i})}if(0===b._tracks.length)return void b.emit("error",new Error("no playable tracks"));a.mvhd.duration=0,b._ftyp={type:"ftyp",brand:"iso5",brandVersion:0,compatibleBrands:["iso5"]};var G=k.encode(b._ftyp),H=b._tracks.map(function(a){var b=k.encode(a.moov);return{mime:a.mime,init:c.concat([G,b])}});b.emit("ready",H)},d.prototype.seek=function(a){var b=this;if(!b._tracks)throw new Error("Not ready yet; wait for 'ready' event");b._fileStream&&(b._fileStream.destroy(),b._fileStream=null);var c=-1;if(b._tracks.map(function(d,e){function f(a){g.destroyed||g.box(a.moof,function(c){if(c)return b.emit("error",c);if(!g.destroyed){var h=d.inStream.slice(a.ranges);h.pipe(g.mediaData(a.length,function(a){if(a)return b.emit("error",a);if(!g.destroyed){var c=b._generateFragment(e);return c?void f(c):g.finalize()}}))}})}d.outStream&&d.outStream.destroy(),d.inStream&&(d.inStream.destroy(),d.inStream=null);var g=d.outStream=j.encode(),h=b._generateFragment(e,a);return h?((-1===c||h.ranges[0].start<c)&&(c=h.ranges[0].start),void f(h)):g.finalize()}),c>=0){var d=b._fileStream=b._file.createReadStream({start:c});b._tracks.forEach(function(a){a.inStream=new l(c,{highWaterMark:1e7}),d.pipe(a.inStream)})}return b._tracks.map(function(a){return a.outStream})},d.prototype._findSampleBefore=function(a,b){var c=this,d=c._tracks[a],e=Math.floor(d.timeScale*b),f=g(d.samples,e,function(a,b){var c=a.dts+a.presentationOffset;return c-b});for(-1===f?f=0:0>f&&(f=-f-2);!d.samples[f].sync;)f--;return f};var m=1;d.prototype._generateFragment=function(a,b){var c,d=this,e=d._tracks[a];if(c=void 0!==b?d._findSampleBefore(a,b):e.currSample,c>=e.samples.length)return null;for(var f=e.samples[c].dts,g=0,h=[],i=c;i<e.samples.length;i++){var j=e.samples[i];if(j.sync&&j.dts-f>=e.timeScale*m)break;g+=j.size;var k=h.length-1;0>k||h[k].end!==j.offset?h.push({start:j.offset,end:j.offset+j.size}):h[k].end+=j.size}return e.currSample=i,{moof:d._generateMoof(a,c,i),ranges:h,length:g}},d.prototype._generateMoof=function(a,b,c){for(var d=this,e=d._tracks[a],f=[],g=b;c>g;g++){var h=e.samples[g];f.push({sampleDuration:h.duration,sampleSize:h.size,sampleFlags:h.sync?33554432:16842752,sampleCompositionTimeOffset:h.presentationOffset})}var i={type:"moof",mfhd:{sequenceNumber:d._fragmentSequence++},trafs:[{tfhd:{flags:131072,trackId:e.trackId},tfdt:{baseMediaDecodeTime:e.samples[b].dts},trun:{flags:3841,dataOffset:8,entries:f}}]};return i.trafs[0].trun.dataOffset+=k.encodingLength(i),i}}).call(this,a("buffer").Buffer)},{"binary-search":7,buffer:39,events:70,inherits:87,"mp4-box-encoding":108,"mp4-stream":111,"range-slice-stream":148}],221:[function(a,b,c){var d=a("once"),e=a("end-of-stream"),f=a("fs"),g=function(){},h=function(a){return"function"==typeof a},i=function(a){return f?(a instanceof(f.ReadStream||g)||a instanceof(f.WriteStream||g))&&h(a.close):!1},j=function(a){return a.setHeader&&h(a.abort)},k=function(a,b,c,f){f=d(f);var g=!1;a.on("close",function(){g=!0}),e(a,{readable:b,writable:c},function(a){return a?f(a):(g=!0,void f())});var k=!1;return function(b){return g||k?void 0:(k=!0,i(a)?a.close():j(a)?a.abort():h(a.destroy)?a.destroy():void f(b||new Error("stream was destroyed")))}},l=function(a){a()},m=function(a,b){return a.pipe(b)},n=function(){var a=Array.prototype.slice.call(arguments),b=h(a[a.length-1]||g)&&a.pop()||g;if(Array.isArray(a[0])&&(a=a[0]),a.length<2)throw new Error("pump requires two streams per minimum");var c,d=a.map(function(e,f){var g=f<a.length-1,h=f>0;return k(e,g,h,function(a){c||(c=a),a&&d.forEach(l),g||(d.forEach(l),b(c))})});return a.reduce(m)};b.exports=n},{"end-of-stream":69,fs:36,once:135}],222:[function(a,b,c){function d(a,b,c){var f=this;return this instanceof d?(c=c||{},f.detailedError=null,f._elem=b,f._elemWrapper=new e(b),f._waitingFired=!1,f._trackMeta=null,f._file=a,f._tracks=null,"none"!==f._elem.preload&&f._createMuxer(),f._onError=function(a){f.detailedError=f._elemWrapper.detailedError,f.destroy()},f._onWaiting=function(){f._waitingFired=!0,f._muxer?f._tracks&&f._pump():f._createMuxer()},f._elem.addEventListener("waiting",f._onWaiting),void f._elem.addEventListener("error",f._onError)):new d(a,b,c)}var e=a("mediasource"),f=a("pump"),g=a("./mp4-remuxer");b.exports=d,d.prototype._createMuxer=function(){var a=this;a._muxer=new g(a._file),a._muxer.on("ready",function(b){a._tracks=b.map(function(b){var c=a._elemWrapper.createWriteStream(b.mime);c.on("error",function(b){a._elemWrapper.error(b)});var d={muxed:null,mediaSource:c,initFlushed:!1,onInitFlushed:null};return c.write(b.init,function(a){d.initFlushed=!0,d.onInitFlushed&&d.onInitFlushed(a)}),d}),(a._waitingFired||"auto"===a._elem.preload)&&a._pump()}),a._muxer.on("error",function(b){a._elemWrapper.error(b)})},d.prototype._pump=function(){var a=this,b=a._muxer.seek(a._elem.currentTime,!a._tracks);a._tracks.forEach(function(c,d){var e=function(){c.muxed&&(c.muxed.destroy(),c.mediaSource=a._elemWrapper.createWriteStream(c.mediaSource),c.mediaSource.on("error",function(b){a._elemWrapper.error(b)})),c.muxed=b[d],f(c.muxed,c.mediaSource)};c.initFlushed?e():c.onInitFlushed=function(b){return b?void a._elemWrapper.error(b):void e()}})},d.prototype.destroy=function(){var a=this;a.destroyed||(a.destroyed=!0,a._elem.removeEventListener("waiting",a._onWaiting),a._elem.removeEventListener("error",a._onError),a._tracks&&a._tracks.forEach(function(a){a.muxed.destroy()}),a._elem.src="")}},{"./mp4-remuxer":220,mediasource:94,pump:221}],223:[function(a,b,c){(function(c,d){function e(a){function b(){f.destroyed||(f.ready=!0,f.emit("ready"))}var f=this;return f instanceof e?(m.call(f),a||(a={}),"string"==typeof a.peerId?f.peerId=a.peerId:h.isBuffer(a.peerId)?f.peerId=a.peerId.toString("hex"):f.peerId=h.from(B+u(9).toString("base64")).toString("hex"),f.peerIdBuffer=h.from(f.peerId,"hex"),"string"==typeof a.nodeId?f.nodeId=a.nodeId:h.isBuffer(a.nodeId)?f.nodeId=a.nodeId.toString("hex"):f.nodeId=u(20).toString("hex"),f.nodeIdBuffer=h.from(f.nodeId,"hex"),f._debugId=f.peerId.toString("hex").substring(0,7),f.destroyed=!1,f.listening=!1,f.torrentPort=a.torrentPort||0,f.dhtPort=a.dhtPort||0,f.tracker=void 0!==a.tracker?a.tracker:{},f.torrents=[],f.maxConns=Number(a.maxConns)||55,f._debug("new webtorrent (peerId %s, nodeId %s, port %s)",f.peerId,f.nodeId,f.torrentPort),f.tracker&&("object"!=typeof f.tracker&&(f.tracker={}),a.rtcConfig&&(console.warn("WebTorrent: opts.rtcConfig is deprecated. Use opts.tracker.rtcConfig instead"),f.tracker.rtcConfig=a.rtcConfig),a.wrtc&&(console.warn("WebTorrent: opts.wrtc is deprecated. Use opts.tracker.wrtc instead"),f.tracker.wrtc=a.wrtc),d.WRTC&&!f.tracker.wrtc&&(f.tracker.wrtc=d.WRTC)),"function"==typeof x?f._tcpPool=new x(f):c.nextTick(function(){f._onListening()}),f._downloadSpeed=v(),f._uploadSpeed=v(),a.dht!==!1&&"function"==typeof l?(f.dht=new l(n({nodeId:f.nodeId},a.dht)),f.dht.once("error",function(a){f._destroy(a)}),f.dht.once("listening",function(){var a=f.dht.address();a&&(f.dhtPort=a.port)}),f.dht.setMaxListeners(0),f.dht.listen(f.dhtPort)):f.dht=!1,f.enableWebSeeds=a.webSeeds!==!1,void("function"==typeof p&&null!=a.blocklist?p(a.blocklist,{headers:{"user-agent":"WebTorrent/"+z+" (https://webtorrent.io)"}},function(a,c){return a?f.error("Failed to load blocklist: "+a.message):(f.blocked=c,void b())}):c.nextTick(b))):new e(a)}function f(a){return"object"==typeof a&&null!=a&&"function"==typeof a.pipe}function g(a){return"undefined"!=typeof FileList&&a instanceof FileList}b.exports=e;var h=a("safe-buffer").Buffer,i=a("simple-concat"),j=a("create-torrent"),k=a("debug")("webtorrent"),l=a("bittorrent-dht/client"),m=a("events").EventEmitter,n=a("xtend"),o=a("inherits"),p=a("load-ip-set"),q=a("run-parallel"),r=a("parse-torrent"),s=a("path"),t=a("simple-peer"),u=a("randombytes"),v=a("speedometer"),w=a("zero-fill"),x=a("./lib/tcp-pool"),y=a("./lib/torrent"),z=a("./package.json").version,A=z.match(/([0-9]+)/g).slice(0,2).map(function(a){return w(2,a)}).join(""),B="-WW"+A+"-";o(e,m),e.WEBRTC_SUPPORT=t.WEBRTC_SUPPORT,Object.defineProperty(e.prototype,"downloadSpeed",{get:function(){return this._downloadSpeed()}}),Object.defineProperty(e.prototype,"uploadSpeed",{get:function(){return this._uploadSpeed()}}),Object.defineProperty(e.prototype,"progress",{get:function(){var a=this.torrents.filter(function(a){return 1!==a.progress}),b=a.reduce(function(a,b){return a+b.downloaded},0),c=a.reduce(function(a,b){return a+(b.length||0)},0)||1;return b/c}}),Object.defineProperty(e.prototype,"ratio",{get:function(){var a=this.torrents.reduce(function(a,b){return a+b.uploaded},0),b=this.torrents.reduce(function(a,b){return a+b.received},0)||1;return a/b}}),e.prototype.get=function(a){var b,c,d=this,e=d.torrents.length;if(a instanceof y){for(b=0;e>b;b++)if(c=d.torrents[b],c===a)return c}else{var f;try{f=r(a)}catch(g){}if(!f)return null;if(!f.infoHash)throw new Error("Invalid torrent identifier");for(b=0;e>b;b++)if(c=d.torrents[b],c.infoHash===f.infoHash)return c}return null},e.prototype.download=function(a,b,c){return console.warn("WebTorrent: client.download() is deprecated. Use client.add() instead"),this.add(a,b,c)},e.prototype.add=function(a,b,c){function d(){if(!g.destroyed)for(var a=0,b=g.torrents.length;b>a;a++){var c=g.torrents[a];if(c.infoHash===h.infoHash&&c!==h)return void h._destroy(new Error("Cannot add duplicate torrent "+h.infoHash))}}function e(){g.destroyed||("function"==typeof c&&c(h),g.emit("torrent",h))}function f(){h.removeListener("_infoHash",d),h.removeListener("ready",e),h.removeListener("close",f)}var g=this;if(g.destroyed)throw new Error("client is destroyed");if("function"==typeof b)return g.add(a,null,b);g._debug("add"),b=b?n(b):{};var h=new y(a,g,b);return g.torrents.push(h),h.once("_infoHash",d),h.once("ready",e),h.once("close",f),h},e.prototype.seed=function(a,b,c){function d(a){var b=[function(b){a.load(k,b)}];h.dht&&b.push(function(b){a.once("dhtAnnounce",b)}),q(b,function(b){return h.destroyed?void 0:b?a._destroy(b):void e(a)})}function e(a){h._debug("on seed"),"function"==typeof c&&c(a),a.emit("seed"),h.emit("seed",a)}var h=this;if(h.destroyed)throw new Error("client is destroyed");if("function"==typeof b)return h.seed(a,null,b);h._debug("seed"),b=b?n(b):{},"string"==typeof a&&(b.path=s.dirname(a)),b.createdBy||(b.createdBy="WebTorrent/"+A);var k,l=h.add(null,b,d);return g(a)&&(a=Array.prototype.slice.call(a)),Array.isArray(a)||(a=[a]),q(a.map(function(a){return function(b){f(a)?i(a,b):b(null,a)}}),function(a,c){return h.destroyed?void 0:a?l._destroy(a):void j.parseInput(c,b,function(a,d){if(!h.destroyed){if(a)return l._destroy(a);k=d.map(function(a){return a.getStream}),j(c,b,function(a,b){if(!h.destroyed){if(a)return l._destroy(a);var c=h.get(b);c?l._destroy(new Error("Cannot add duplicate torrent "+c.infoHash)):l._onTorrentId(b)}})}})}),l},e.prototype.remove=function(a,b){this._debug("remove");var c=this.get(a);if(!c)throw new Error("No torrent with id "+a);this._remove(a,b)},e.prototype._remove=function(a,b){var c=this.get(a);c&&(this.torrents.splice(this.torrents.indexOf(c),1),c.destroy(b))},e.prototype.address=function(){return this.listening?this._tcpPool?this._tcpPool.server.address():{address:"0.0.0.0",family:"IPv4",port:0}:null},e.prototype.destroy=function(a){if(this.destroyed)throw new Error("client already destroyed");this._destroy(null,a)},e.prototype._destroy=function(a,b){var c=this;c._debug("client destroy"),c.destroyed=!0;var d=c.torrents.map(function(a){return function(b){a.destroy(b)}});c._tcpPool&&d.push(function(a){c._tcpPool.destroy(a)}),c.dht&&d.push(function(a){c.dht.destroy(a)}),q(d,b),a&&c.emit("error",a),c.torrents=[],c._tcpPool=null,c.dht=null},e.prototype._onListening=function(){if(this._debug("listening"),this.listening=!0,this._tcpPool){var a=this._tcpPool.server.address();a&&(this.torrentPort=a.port)}this.emit("listening")},e.prototype._debug=function(){var a=[].slice.call(arguments);a[0]="["+this._debugId+"] "+a[0],k.apply(null,a)}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/tcp-pool":36,"./lib/torrent":228,"./package.json":241,_process:141,"bittorrent-dht/client":36,"create-torrent":55,debug:66,events:70,inherits:87,"load-ip-set":36,"parse-torrent":137,path:138,randombytes:147,"run-parallel":162,"safe-buffer":164,"simple-concat":165,"simple-peer":167,speedometer:190,xtend:243,"zero-fill":245}],224:[function(a,b,c){function d(a,b){g.Readable.call(this,b),this.destroyed=!1,this._torrent=a._torrent;var c=b&&b.start||0,d=b&&b.end&&b.end<a.length?b.end:a.length-1,e=a._torrent.pieceLength;this._startPiece=(c+a.offset)/e|0,this._endPiece=(d+a.offset)/e|0,this._piece=this._startPiece,this._offset=c+a.offset-this._startPiece*e,this._missing=d-c+1,this._reading=!1,this._notifying=!1,this._criticalLength=Math.min(1048576/e|0,2)}b.exports=d;var e=a("debug")("webtorrent:file-stream"),f=a("inherits"),g=a("readable-stream");f(d,g.Readable),d.prototype._read=function(){this._reading||(this._reading=!0,this._notify())},d.prototype._notify=function(){var a=this;if(a._reading&&0!==a._missing){if(!a._torrent.bitfield.get(a._piece))return a._torrent.critical(a._piece,a._piece+a._criticalLength);if(!a._notifying){a._notifying=!0;var b=a._piece;a._torrent.store.get(b,function(c,d){if(a._notifying=!1,!a.destroyed){if(c)return a._destroy(c);e("read %s (length %s) (err %s)",b,d.length,c&&c.message),a._offset&&(d=d.slice(a._offset),a._offset=0),a._missing<d.length&&(d=d.slice(0,a._missing)),a._missing-=d.length,e("pushing buffer of length %s",d.length),a._reading=!1,a.push(d),0===a._missing&&a.push(null)}}),a._piece+=1}}},d.prototype.destroy=function(a){this._destroy(null,a)},d.prototype._destroy=function(a,b){this.destroyed||(this.destroyed=!0,this._torrent.destroyed||this._torrent.deselect(this._startPiece,this._endPiece,!0),a&&this.emit("error",a),this.emit("close"),b&&b())}},{debug:66,inherits:87,"readable-stream":239}],225:[function(a,b,c){(function(c){function d(a,b){f.call(this),this._torrent=a,this._destroyed=!1,this.name=b.name,this.path=b.path,this.length=b.length,this.offset=b.offset,this.done=!1;var c=b.offset,d=c+b.length-1;this._startPiece=c/this._torrent.pieceLength|0,this._endPiece=d/this._torrent.pieceLength|0,0===this.length&&(this.done=!0,this.emit("done"))}b.exports=d;var e=a("end-of-stream"),f=a("events").EventEmitter,g=a("./file-stream"),h=a("inherits"),i=a("path"),j=a("render-media"),k=a("readable-stream"),l=a("stream-to-blob"),m=a("stream-to-blob-url"),n=a("stream-with-known-length-to-buffer");h(d,f),Object.defineProperty(d.prototype,"downloaded",{get:function(){if(!this._torrent.bitfield)return 0;for(var a=0,b=this._startPiece;b<=this._endPiece;++b)if(this._torrent.bitfield.get(b))a+=this._torrent.pieceLength;else{var c=this._torrent.pieces[b];a+=c.length-c.missing}return a}}),d.prototype.select=function(a){0!==this.length&&this._torrent.select(this._startPiece,this._endPiece,a)},d.prototype.deselect=function(){0!==this.length&&this._torrent.deselect(this._startPiece,this._endPiece,!1)},d.prototype.createReadStream=function(a){var b=this;if(0===this.length){var d=new k.PassThrough;return c.nextTick(function(){d.end()}),d}var f=new g(b,a);return b._torrent.select(f._startPiece,f._endPiece,!0,function(){f._notify()}),e(f,function(){b._destroyed||b._torrent.destroyed||b._torrent.deselect(f._startPiece,f._endPiece,!0)}),f},d.prototype.getBuffer=function(a){n(this.createReadStream(),this.length,a)},d.prototype.getBlob=function(a){if("undefined"==typeof window)throw new Error("browser-only method");l(this.createReadStream(),this._getMimeType(),a)},d.prototype.getBlobURL=function(a){if("undefined"==typeof window)throw new Error("browser-only method");m(this.createReadStream(),this._getMimeType(),a)},d.prototype.appendTo=function(a,b,c){if("undefined"==typeof window)throw new Error("browser-only method");j.append(this,a,b,c)},d.prototype.renderTo=function(a,b,c){if("undefined"==typeof window)throw new Error("browser-only method");j.render(this,a,b,c)},d.prototype._getMimeType=function(){return j.mime[i.extname(this.name).toLowerCase()]},d.prototype._destroy=function(){this._destroyed=!0,this._torrent=null}}).call(this,a("_process"))},{"./file-stream":224,_process:141,"end-of-stream":69,events:70,inherits:87,path:138,"readable-stream":239,"render-media":159,"stream-to-blob":204,"stream-to-blob-url":203,"stream-with-known-length-to-buffer":205}],226:[function(a,b,c){function d(a,b){var c=this;c.id=a,c.type=b,g("new Peer %s",a),c.addr=null,c.conn=null,c.swarm=null,c.wire=null,c.connected=!1,c.destroyed=!1,c.timeout=null,c.retries=0,c.sentHandshake=!1}function e(){}var f=a("unordered-array-remove"),g=a("debug")("webtorrent:peer"),h=a("bittorrent-protocol"),i=a("./webconn"),j=5e3,k=25e3,l=25e3;c.createWebRTCPeer=function(a,b){var c=new d(a.id,"webrtc");return c.conn=a,c.swarm=b,c.conn.connected?c.onConnect():(c.conn.once("connect",function(){c.onConnect()}),c.conn.once("error",function(a){c.destroy(a)}),c.startConnectTimeout()),c},c.createTCPIncomingPeer=function(a){var b=a.remoteAddress+":"+a.remotePort,c=new d(b,"tcpIncoming");return c.conn=a,c.addr=b,c.onConnect(),c},c.createTCPOutgoingPeer=function(a,b){var c=new d(a,"tcpOutgoing");return c.addr=a,c.swarm=b,c},c.createWebSeedPeer=function(a,b){var c=new d(a,"webSeed");return c.swarm=b,c.conn=new i(a,b),c.onConnect(),c},d.prototype.onConnect=function(){var a=this;if(!a.destroyed){a.connected=!0,g("Peer %s connected",a.id),clearTimeout(a.connectTimeout);var b=a.conn;b.once("end",function(){a.destroy()}),b.once("close",function(){a.destroy()}),b.once("finish",function(){a.destroy()}),b.once("error",function(b){a.destroy(b)});var c=a.wire=new h;c.type=a.type,c.once("end",function(){a.destroy()}),c.once("close",function(){a.destroy()}),c.once("finish",function(){a.destroy()}),c.once("error",function(b){a.destroy(b)}),c.once("handshake",function(b,c){a.onHandshake(b,c)}),a.startHandshakeTimeout(),b.pipe(c).pipe(b),a.swarm&&!a.sentHandshake&&a.handshake()}},d.prototype.onHandshake=function(a,b){var c=this;if(c.swarm&&!c.destroyed){if(c.swarm.destroyed)return c.destroy(new Error("swarm already destroyed"));if(a!==c.swarm.infoHash)return c.destroy(new Error("unexpected handshake info hash for this swarm"));if(b===c.swarm.peerId)return c.destroy(new Error("refusing to connect to ourselves"));g("Peer %s got handshake %s",c.id,a),clearTimeout(c.handshakeTimeout),c.retries=0;var d=c.addr;!d&&c.conn.remoteAddress&&(d=c.conn.remoteAddress+":"+c.conn.remotePort),c.swarm._onWire(c.wire,d),c.swarm&&!c.swarm.destroyed&&(c.sentHandshake||c.handshake())}},d.prototype.handshake=function(){var a=this,b={dht:a.swarm["private"]?!1:!!a.swarm.client.dht};a.wire.handshake(a.swarm.infoHash,a.swarm.client.peerId,b),a.sentHandshake=!0},d.prototype.startConnectTimeout=function(){var a=this;clearTimeout(a.connectTimeout),a.connectTimeout=setTimeout(function(){a.destroy(new Error("connect timeout"))},"webrtc"===a.type?k:j),a.connectTimeout.unref&&a.connectTimeout.unref()},d.prototype.startHandshakeTimeout=function(){var a=this;clearTimeout(a.handshakeTimeout),a.handshakeTimeout=setTimeout(function(){a.destroy(new Error("handshake timeout"))},l),a.handshakeTimeout.unref&&a.handshakeTimeout.unref()},d.prototype.destroy=function(a){var b=this;if(!b.destroyed){b.destroyed=!0,b.connected=!1,g("destroy %s (error: %s)",b.id,a&&(a.message||a)),clearTimeout(b.connectTimeout),clearTimeout(b.handshakeTimeout);var c=b.swarm,d=b.conn,h=b.wire;b.swarm=null,b.conn=null,b.wire=null,c&&h&&f(c.wires,c.wires.indexOf(h)),d&&(d.on("error",e),d.destroy()),h&&h.destroy(),c&&c.removePeer(b.id)}}},{"./webconn":229,"bittorrent-protocol":9,debug:66,"unordered-array-remove":215}],227:[function(a,b,c){function d(a){var b=this;b._torrent=a,b._numPieces=a.pieces.length,b._pieces=[],b._onWire=function(a){b.recalculate(),b._initWire(a)},b._onWireHave=function(a){b._pieces[a]+=1},b._onWireBitfield=function(){b.recalculate()},b._torrent.wires.forEach(function(a){b._initWire(a)}),b._torrent.on("wire",b._onWire),b.recalculate()}function e(){return!0}b.exports=d,d.prototype.getRarestPiece=function(a){a||(a=e);for(var b=[],c=1/0,d=0;d<this._numPieces;++d)if(a(d)){var f=this._pieces[d];f===c?b.push(d):c>f&&(b=[d],c=f)}return b.length>0?b[Math.random()*b.length|0]:-1},d.prototype.destroy=function(){var a=this;a._torrent.removeListener("wire",a._onWire),a._torrent.wires.forEach(function(b){a._cleanupWireEvents(b)}),a._torrent=null,a._pieces=null,a._onWire=null,a._onWireHave=null,a._onWireBitfield=null},d.prototype._initWire=function(a){var b=this;a._onClose=function(){b._cleanupWireEvents(a);for(var c=0;c<this._numPieces;++c)b._pieces[c]-=a.peerPieces.get(c)},a.on("have",b._onWireHave),a.on("bitfield",b._onWireBitfield),a.once("close",a._onClose)},d.prototype.recalculate=function(){var a;for(a=0;a<this._numPieces;++a)this._pieces[a]=0;var b=this._torrent.wires.length;for(a=0;b>a;++a)for(var c=this._torrent.wires[a],d=0;d<this._numPieces;++d)this._pieces[d]+=c.peerPieces.get(d)},d.prototype._cleanupWireEvents=function(a){a.removeListener("have",this._onWireHave),a.removeListener("bitfield",this._onWireBitfield),a._onClose&&a.removeListener("close",a._onClose),a._onClose=null}},{}],228:[function(a,b,c){(function(c,d){function e(a,b,c){p.call(this),this._debugId="unknown infohash",this.client=b,this.announce=c.announce,this.urlList=c.urlList,this.path=c.path,this._store=c.store||t,this._getAnnounceOpts=c.getAnnounceOpts,this.strategy=c.strategy||"sequential",this.maxWebConns=c.maxWebConns||4,this._rechokeNumSlots=c.uploads===!1||0===c.uploads?0:+c.uploads||10,this._rechokeOptimisticWire=null,this._rechokeOptimisticTime=0,this._rechokeIntervalId=null,this.ready=!1,this.destroyed=!1,this.paused=!1,this.done=!1,this.metadata=null,this.store=null,this.files=[],this.pieces=[],this._amInterested=!1,this._selections=[],this._critical=[],this.wires=[],this._queue=[],this._peers={},this._peersLength=0,this.received=0,this.uploaded=0,this._downloadSpeed=I(),this._uploadSpeed=I(),this._servers=[],this._xsRequests=[],this._fileModtimes=c.fileModtimes,null!==a&&this._onTorrentId(a),this._debug("new torrent")}function f(a,b){return 2+Math.ceil(b*a.downloadSpeed()/E.BLOCK_LENGTH)}function g(a,b,c){return 1+Math.ceil(b*a.downloadSpeed()/c)}function h(a){return Math.random()*a|0}function i(){}b.exports=e;var j,k=a("addr-to-ip-port"),l=a("bitfield"),m=a("chunk-store-stream/write"),n=a("debug")("webtorrent:torrent"),o=a("torrent-discovery"),p=a("events").EventEmitter,q=a("xtend"),r=a("xtend/mutable"),s=a("fs"),t=a("fs-chunk-store"),u=a("simple-get"),v=a("immediate-chunk-store"),w=a("inherits"),x=a("multistream"),y=a("net"),z=a("os"),A=a("run-parallel"),B=a("run-parallel-limit"),C=a("parse-torrent"),D=a("path"),E=a("torrent-piece"),F=a("pump"),G=a("random-iterate"),H=a("simple-sha1"),I=a("speedometer"),J=a("uniq"),K=a("ut_metadata"),L=a("ut_pex"),M=a("./file"),N=a("./peer"),O=a("./rarity-map"),P=a("./server"),Q=131072,R=3e4,S=5e3,T=3*E.BLOCK_LENGTH,U=.5,V=1,W=1e4,X=2,Y=2,Z=[1e3,5e3,15e3],$=a("../package.json").version,_="WebTorrent/"+$+" (https://webtorrent.io)";try{j=D.join(s.statSync("/tmp")&&"/tmp","webtorrent")}catch(aa){j=D.join("function"==typeof z.tmpdir?z.tmpdir():"/","webtorrent")}w(e,p),Object.defineProperty(e.prototype,"timeRemaining",{get:function(){return this.done?0:0===this.downloadSpeed?1/0:(this.length-this.downloaded)/this.downloadSpeed*1e3}}),Object.defineProperty(e.prototype,"downloaded",{get:function(){if(!this.bitfield)return 0;for(var a=0,b=0,c=this.pieces.length;c>b;++b)if(this.bitfield.get(b))a+=b===c-1?this.lastPieceLength:this.pieceLength;else{var d=this.pieces[b];a+=d.length-d.missing}return a}}),Object.defineProperty(e.prototype,"downloadSpeed",{get:function(){return this._downloadSpeed()}}),Object.defineProperty(e.prototype,"uploadSpeed",{get:function(){return this._uploadSpeed()}}),Object.defineProperty(e.prototype,"progress",{get:function(){return this.length?this.downloaded/this.length:0}}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this.uploaded/(this.received||1)}}),Object.defineProperty(e.prototype,"numPeers",{get:function(){return this.wires.length}}),Object.defineProperty(e.prototype,"torrentFileBlobURL",{get:function(){if("undefined"==typeof window)throw new Error("browser-only property");return this.torrentFile?URL.createObjectURL(new Blob([this.torrentFile],{type:"application/x-bittorrent"})):null}}),Object.defineProperty(e.prototype,"_numQueued",{get:function(){return this._queue.length+(this._peersLength-this._numConns)}}),Object.defineProperty(e.prototype,"_numConns",{get:function(){var a=this,b=0;for(var c in a._peers)a._peers[c].connected&&(b+=1);return b}}),Object.defineProperty(e.prototype,"swarm",{get:function(){return console.warn("WebTorrent: `torrent.swarm` is deprecated. Use `torrent` directly instead."),this}}),e.prototype._onTorrentId=function(a){var b=this;if(!b.destroyed){var d;try{d=C(a)}catch(e){}d?(b.infoHash=d.infoHash,b._debugId=d.infoHash.toString("hex").substring(0,7),c.nextTick(function(){b.destroyed||b._onParsedTorrent(d)})):C.remote(a,function(a,c){return b.destroyed?void 0:a?b._destroy(a):void b._onParsedTorrent(c)})}},e.prototype._onParsedTorrent=function(a){var b=this;if(!b.destroyed){if(b._processParsedTorrent(a),!b.infoHash)return b._destroy(new Error("Malformed torrent data: No info hash"));b.path||(b.path=D.join(j,b.infoHash)),b._rechokeIntervalId=setInterval(function(){b._rechoke()},W),b._rechokeIntervalId.unref&&b._rechokeIntervalId.unref(),b.emit("_infoHash",b.infoHash),b.destroyed||(b.emit("infoHash",b.infoHash),b.destroyed||(b.client.listening?b._onListening():b.client.once("listening",function(){b._onListening()})))}},e.prototype._processParsedTorrent=function(a){this._debugId=a.infoHash.toString("hex").substring(0,7),this.announce&&(a.announce=a.announce.concat(this.announce)),this.client.tracker&&d.WEBTORRENT_ANNOUNCE&&!this["private"]&&(a.announce=a.announce.concat(d.WEBTORRENT_ANNOUNCE)),this.urlList&&(a.urlList=a.urlList.concat(this.urlList)),J(a.announce),J(a.urlList),r(this,a),this.magnetURI=C.toMagnetURI(a),this.torrentFile=C.toTorrentFile(a)},e.prototype._onListening=function(){function a(a){f._destroy(a)}function b(a){"string"==typeof a&&f.done||f.addPeer(a)}function c(){f.emit("trackerAnnounce"),0===f.numPeers&&f.emit("noPeers","tracker")}function d(){f.emit("dhtAnnounce"),0===f.numPeers&&f.emit("noPeers","dht")}function e(a){f.emit("warning",a)}var f=this;if(!f.discovery&&!f.destroyed){var g=f.client.tracker;g&&(g=q(f.client.tracker,{getAnnounceOpts:function(){var a={uploaded:f.uploaded,downloaded:f.downloaded,left:Math.max(f.length-f.downloaded,0)};return f.client.tracker.getAnnounceOpts&&r(a,f.client.tracker.getAnnounceOpts()),f._getAnnounceOpts&&r(a,f._getAnnounceOpts()),a}})),f.discovery=new o({infoHash:f.infoHash,announce:f.announce,peerId:f.client.peerId,dht:!f["private"]&&f.client.dht,tracker:g,port:f.client.torrentPort,userAgent:_}),f.discovery.on("error",a),f.discovery.on("peer",b),f.discovery.on("trackerAnnounce",c),f.discovery.on("dhtAnnounce",d),f.discovery.on("warning",e),f.info?f._onMetadata(f):f.xs&&f._getMetadataFromServer()}},e.prototype._getMetadataFromServer=function(){function a(a,c){function d(d,e,f){if(b.destroyed)return c(null);if(b.metadata)return c(null);if(d)return b.emit("warning",new Error("http error from xs param: "+a)),c(null);if(200!==e.statusCode)return b.emit("warning",new Error("non-200 status code "+e.statusCode+" from xs param: "+a)),c(null);var g;try{g=C(f)}catch(d){}return g?g.infoHash!==b.infoHash?(b.emit("warning",new Error("got torrent file with incorrect info hash from xs param: "+a)),c(null)):(b._onMetadata(g),void c(null)):(b.emit("warning",new Error("got invalid torrent file from xs param: "+a)),c(null))}if(0!==a.indexOf("http://")&&0!==a.indexOf("https://"))return b.emit("warning",new Error("skipping non-http xs param: "+a)),c(null);var e,f={url:a,method:"GET",headers:{"user-agent":_}};try{e=u.concat(f,d)}catch(g){return b.emit("warning",new Error("skipping invalid url xs param: "+a)),c(null)}b._xsRequests.push(e)}var b=this,c=Array.isArray(b.xs)?b.xs:[b.xs],d=c.map(function(b){return function(c){a(b,c)}});A(d)},e.prototype._onMetadata=function(a){var b=this;if(!b.metadata&&!b.destroyed){b._debug("got metadata"),b._xsRequests.forEach(function(a){a.abort()}),b._xsRequests=[];var c;if(a&&a.infoHash)c=a;else try{c=C(a)}catch(d){return b._destroy(d)}b._processParsedTorrent(c),b.metadata=b.torrentFile,b.client.enableWebSeeds&&b.urlList.forEach(function(a){b.addWebSeed(a)}),0!==b.pieces.length&&b.select(0,b.pieces.length-1,!1),b._rarityMap=new O(b),b.store=new v(new b._store(b.pieceLength,{torrent:{infoHash:b.infoHash},files:b.files.map(function(a){return{path:D.join(b.path,a.path),length:a.length,offset:a.offset}}),length:b.length})),b.files=b.files.map(function(a){return new M(b,a)}),b._hashes=b.pieces,b.pieces=b.pieces.map(function(a,c){var d=c===b.pieces.length-1?b.lastPieceLength:b.pieceLength;return new E(d)}),b._reservations=b.pieces.map(function(){return[]}),b.bitfield=new l(b.pieces.length),b.wires.forEach(function(a){
a.ut_metadata&&a.ut_metadata.setMetadata(b.metadata),b._onWireWithMetadata(a)}),b._debug("verifying existing torrent data"),b._fileModtimes&&b._store===t?b.getFileModtimes(function(a,c){if(a)return b._destroy(a);var d=b.files.map(function(a,d){return c[d]===b._fileModtimes[d]}).every(function(a){return a});if(d){for(var e=0;e<b.pieces.length;e++)b._markVerified(e);b._onStore()}else b._verifyPieces()}):b._verifyPieces(),b.emit("metadata")}},e.prototype.getFileModtimes=function(a){var b=this,c=[];B(b.files.map(function(a,d){return function(e){s.stat(D.join(b.path,a.path),function(a,b){return a&&"ENOENT"!==a.code?e(a):(c[d]=b&&b.mtime.getTime(),void e(null))})}}),Y,function(d){b._debug("done getting file modtimes"),a(d,c)})},e.prototype._verifyPieces=function(){var a=this;B(a.pieces.map(function(b,d){return function(b){return a.destroyed?b(new Error("torrent is destroyed")):void a.store.get(d,function(e,f){return a.destroyed?b(new Error("torrent is destroyed")):e?c.nextTick(b,null):void H(f,function(c){if(a.destroyed)return b(new Error("torrent is destroyed"));if(c===a._hashes[d]){if(!a.pieces[d])return;a._debug("piece verified %s",d),a._markVerified(d)}else a._debug("piece invalid %s",d);b(null)})})}}),Y,function(b){return b?a._destroy(b):(a._debug("done verifying"),void a._onStore())})},e.prototype._markVerified=function(a){this.pieces[a]=null,this._reservations[a]=null,this.bitfield.set(a,!0)},e.prototype._onStore=function(){var a=this;a.destroyed||(a._debug("on store"),a.ready=!0,a.emit("ready"),a._checkDone(),a._updateSelections())},e.prototype.destroy=function(a){var b=this;b._destroy(null,a)},e.prototype._destroy=function(a,b){var c=this;if(!c.destroyed){c.destroyed=!0,c._debug("destroy"),c.client._remove(c),clearInterval(c._rechokeIntervalId),c._xsRequests.forEach(function(a){a.abort()}),c._rarityMap&&c._rarityMap.destroy();for(var d in c._peers)c.removePeer(d);c.files.forEach(function(a){a instanceof M&&a._destroy()});var e=c._servers.map(function(a){return function(b){a.destroy(b)}});c.discovery&&e.push(function(a){c.discovery.destroy(a)}),c.store&&e.push(function(a){c.store.close(a)}),A(e,b),a&&(0===c.listenerCount("error")?c.client.emit("error",a):c.emit("error",a)),c.emit("close"),c.client=null,c.files=[],c.discovery=null,c.store=null,c._rarityMap=null,c._peers=null,c._servers=null,c._xsRequests=null}},e.prototype.addPeer=function(a){var b=this;if(b.destroyed)throw new Error("torrent is destroyed");if(!b.infoHash)throw new Error("addPeer() must not be called before the `infoHash` event");if(b.client.blocked){var c;if("string"==typeof a){var d;try{d=k(a)}catch(e){return b._debug("ignoring peer: invalid %s",a),b.emit("invalidPeer",a),!1}c=d[0]}else"string"==typeof a.remoteAddress&&(c=a.remoteAddress);if(c&&b.client.blocked.contains(c))return b._debug("ignoring peer: blocked %s",a),"string"!=typeof a&&a.destroy(),b.emit("blockedPeer",a),!1}var f=!!b._addPeer(a);return f?b.emit("peer",a):b.emit("invalidPeer",a),f},e.prototype._addPeer=function(a){var b=this;if(b.destroyed)return"string"!=typeof a&&a.destroy(),null;if("string"==typeof a&&!b._validAddr(a))return b._debug("ignoring peer: invalid %s",a),null;var c=a&&a.id||a;if(b._peers[c])return b._debug("ignoring peer: duplicate (%s)",c),"string"!=typeof a&&a.destroy(),null;if(b.paused)return b._debug("ignoring peer: torrent is paused"),"string"!=typeof a&&a.destroy(),null;b._debug("add peer %s",c);var d;return d="string"==typeof a?N.createTCPOutgoingPeer(a,b):N.createWebRTCPeer(a,b),b._peers[d.id]=d,b._peersLength+=1,"string"==typeof a&&(b._queue.push(d),b._drain()),d},e.prototype.addWebSeed=function(a){if(this.destroyed)throw new Error("torrent is destroyed");if(!/^https?:\/\/.+/.test(a))return this.emit("warning",new Error("ignoring invalid web seed: "+a)),void this.emit("invalidPeer",a);if(this._peers[a])return this.emit("warning",new Error("ignoring duplicate web seed: "+a)),void this.emit("invalidPeer",a);this._debug("add web seed %s",a);var b=N.createWebSeedPeer(a,this);this._peers[b.id]=b,this._peersLength+=1,this.emit("peer",a)},e.prototype._addIncomingPeer=function(a){var b=this;return b.destroyed?a.destroy(new Error("torrent is destroyed")):b.paused?a.destroy(new Error("torrent is paused")):(this._debug("add incoming peer %s",a.id),b._peers[a.id]=a,void(b._peersLength+=1))},e.prototype.removePeer=function(a){var b=this,c=a&&a.id||a;a=b._peers[c],a&&(this._debug("removePeer %s",c),delete b._peers[c],b._peersLength-=1,a.destroy(),b._drain())},e.prototype.select=function(a,b,c,d){var e=this;if(e.destroyed)throw new Error("torrent is destroyed");if(0>a||a>b||e.pieces.length<=b)throw new Error("invalid selection ",a,":",b);c=Number(c)||0,e._debug("select %s-%s (priority %s)",a,b,c),e._selections.push({from:a,to:b,offset:0,priority:c,notify:d||i}),e._selections.sort(function(a,b){return b.priority-a.priority}),e._updateSelections()},e.prototype.deselect=function(a,b,c){var d=this;if(d.destroyed)throw new Error("torrent is destroyed");c=Number(c)||0,d._debug("deselect %s-%s (priority %s)",a,b,c);for(var e=0;e<d._selections.length;++e){var f=d._selections[e];if(f.from===a&&f.to===b&&f.priority===c){d._selections.splice(e,1);break}}d._updateSelections()},e.prototype.critical=function(a,b){var c=this;if(c.destroyed)throw new Error("torrent is destroyed");c._debug("critical %s-%s",a,b);for(var d=a;b>=d;++d)c._critical[d]=!0;c._updateSelections()},e.prototype._onWire=function(a,b){var d=this;if(d._debug("got wire %s (%s)",a._debugId,b||"Unknown"),a.on("download",function(a){d.destroyed||(d.received+=a,d._downloadSpeed(a),d.client._downloadSpeed(a),d.emit("download",a),d.client.emit("download",a))}),a.on("upload",function(a){d.destroyed||(d.uploaded+=a,d._uploadSpeed(a),d.client._uploadSpeed(a),d.emit("upload",a),d.client.emit("upload",a))}),d.wires.push(a),b){var e=k(b);a.remoteAddress=e[0],a.remotePort=e[1]}d.client.dht&&d.client.dht.listening&&a.on("port",function(c){if(!d.destroyed&&!d.client.dht.destroyed){if(!a.remoteAddress)return d._debug("ignoring PORT from peer with no address");if(0===c||c>65536)return d._debug("ignoring invalid PORT from peer");d._debug("port: %s (from %s)",c,b),d.client.dht.addNode({host:a.remoteAddress,port:c})}}),a.on("timeout",function(){d._debug("wire timeout (%s)",b),a.destroy()}),a.setTimeout(R,!0),a.setKeepAlive(!0),a.use(K(d.metadata)),a.ut_metadata.on("warning",function(a){d._debug("ut_metadata warning: %s",a.message)}),d.metadata||(a.ut_metadata.on("metadata",function(a){d._debug("got metadata via ut_metadata"),d._onMetadata(a)}),a.ut_metadata.fetch()),"function"!=typeof L||d["private"]||(a.use(L()),a.ut_pex.on("peer",function(a){d.done||(d._debug("ut_pex: got peer: %s (from %s)",a,b),d.addPeer(a))}),a.ut_pex.on("dropped",function(a){var c=d._peers[a];c&&!c.connected&&(d._debug("ut_pex: dropped peer: %s (from %s)",a,b),d.removePeer(a))}),a.once("close",function(){a.ut_pex.reset()})),d.emit("wire",a,b),d.metadata&&c.nextTick(function(){d._onWireWithMetadata(a)})},e.prototype._onWireWithMetadata=function(a){function b(){e.destroyed||a.destroyed||(e._numQueued>2*(e._numConns-e.numPeers)&&a.amInterested?a.destroy():(f=setTimeout(b,S),f.unref&&f.unref()))}function c(){if(a.peerPieces.buffer.length===e.bitfield.buffer.length){for(d=0;d<e.pieces.length;++d)if(!a.peerPieces.get(d))return;a.isSeeder=!0,a.choke()}}var d,e=this,f=null;a.on("bitfield",function(){c(),e._update()}),a.on("have",function(){c(),e._update()}),a.once("interested",function(){a.unchoke()}),a.once("close",function(){clearTimeout(f)}),a.on("choke",function(){clearTimeout(f),f=setTimeout(b,S),f.unref&&f.unref()}),a.on("unchoke",function(){clearTimeout(f),e._update()}),a.on("request",function(b,c,d,f){return d>Q?a.destroy():void(e.pieces[b]||e.store.get(b,{offset:c,length:d},f))}),a.bitfield(e.bitfield),a.interested(),a.peerExtensions.dht&&e.client.dht&&e.client.dht.listening&&a.port(e.client.dht.address().port),"webSeed"!==a.type&&(f=setTimeout(b,S),f.unref&&f.unref()),a.isSeeder=!1,c()},e.prototype._updateSelections=function(){var a=this;a.ready&&!a.destroyed&&(c.nextTick(function(){a._gcSelections()}),a._updateInterest(),a._update())},e.prototype._gcSelections=function(){for(var a=this,b=0;b<a._selections.length;++b){for(var c=a._selections[b],d=c.offset;a.bitfield.get(c.from+c.offset)&&c.from+c.offset<c.to;)c.offset+=1;d!==c.offset&&c.notify(),c.to===c.from+c.offset&&a.bitfield.get(c.from+c.offset)&&(a._selections.splice(b,1),b-=1,c.notify(),a._updateInterest())}a._selections.length||a.emit("idle")},e.prototype._updateInterest=function(){var a=this,b=a._amInterested;a._amInterested=!!a._selections.length,a.wires.forEach(function(b){a._amInterested?b.interested():b.uninterested()}),b!==a._amInterested&&(a._amInterested?a.emit("interested"):a.emit("uninterested"))},e.prototype._update=function(){var a=this;if(!a.destroyed)for(var b,c=G(a.wires);b=c();)a._updateWire(b)},e.prototype._updateWire=function(a){function b(b,c,d,e){return function(f){return f>=b&&c>=f&&!(f in d)&&a.peerPieces.get(f)&&(!e||e(f))}}function c(){if(!a.requests.length)for(var c=h._selections.length;c--;){var d,e=h._selections[c];if("rarest"===h.strategy)for(var f=e.from+e.offset,g=e.to,i=g-f+1,j={},k=0,l=b(f,g,j);i>k&&(d=h._rarityMap.getRarestPiece(l),!(0>d));){if(h._request(a,d,!1))return;j[d]=!0,k+=1}else for(d=e.to;d>=e.from+e.offset;--d)if(a.peerPieces.get(d)&&h._request(a,d,!1))return}}function d(){var b=a.downloadSpeed()||1;if(b>T)return function(){return!0};var c=Math.max(1,a.requests.length)*E.BLOCK_LENGTH/b,d=10,e=0;return function(a){if(!d||h.bitfield.get(a))return!0;for(var f=h.pieces[a].missing;e<h.wires.length;e++){var g=h.wires[e],i=g.downloadSpeed();if(!(T>i)&&!(b>=i)&&g.peerPieces.get(a)&&!((f-=i*c)>0))return d--,!1}return!0}}function e(a){for(var b=a,c=a;c<h._selections.length&&h._selections[c].priority;c++)b=c;var d=h._selections[a];h._selections[a]=h._selections[b],h._selections[b]=d}function g(c){if(a.requests.length>=j)return!0;for(var f=d(),g=0;g<h._selections.length;g++){var i,k=h._selections[g];if("rarest"===h.strategy)for(var l=k.from+k.offset,m=k.to,n=m-l+1,o={},p=0,q=b(l,m,o,f);n>p&&(i=h._rarityMap.getRarestPiece(q),!(0>i));){for(;h._request(a,i,h._critical[i]||c););if(!(a.requests.length<j))return k.priority&&e(g),!0;o[i]=!0,p++}else for(i=k.from+k.offset;i<=k.to;i++)if(a.peerPieces.get(i)&&f(i)){for(;h._request(a,i,h._critical[i]||c););if(!(a.requests.length<j))return k.priority&&e(g),!0}}return!1}var h=this;if(!a.peerChoking){if(!a.downloaded)return c();var i=f(a,U);if(!(a.requests.length>=i)){var j=f(a,V);g(!1)||g(!0)}}},e.prototype._rechoke=function(){function a(a,b){return a.downloadSpeed!==b.downloadSpeed?b.downloadSpeed-a.downloadSpeed:a.uploadSpeed!==b.uploadSpeed?b.uploadSpeed-a.uploadSpeed:a.wire.amChoking!==b.wire.amChoking?a.wire.amChoking?1:-1:a.salt-b.salt}var b=this;if(b.ready){b._rechokeOptimisticTime>0?b._rechokeOptimisticTime-=1:b._rechokeOptimisticWire=null;var c=[];b.wires.forEach(function(a){a.isSeeder||a===b._rechokeOptimisticWire||c.push({wire:a,downloadSpeed:a.downloadSpeed(),uploadSpeed:a.uploadSpeed(),salt:Math.random(),isChoked:!0})}),c.sort(a);for(var d=0,e=0;e<c.length&&d<b._rechokeNumSlots;++e)c[e].isChoked=!1,c[e].wire.peerInterested&&(d+=1);if(!b._rechokeOptimisticWire&&e<c.length&&b._rechokeNumSlots){var f=c.slice(e).filter(function(a){return a.wire.peerInterested}),g=f[h(f.length)];g&&(g.isChoked=!1,b._rechokeOptimisticWire=g.wire,b._rechokeOptimisticTime=X)}c.forEach(function(a){a.wire.amChoking!==a.isChoked&&(a.isChoked?a.wire.choke():a.wire.unchoke())})}},e.prototype._hotswap=function(a,b){var c=this,d=a.downloadSpeed();if(d<E.BLOCK_LENGTH)return!1;if(!c._reservations[b])return!1;var e=c._reservations[b];if(!e)return!1;var f,g,h=1/0;for(g=0;g<e.length;g++){var i=e[g];if(i&&i!==a){var j=i.downloadSpeed();j>=T||2*j>d||j>h||(f=i,h=j)}}if(!f)return!1;for(g=0;g<e.length;g++)e[g]===f&&(e[g]=null);for(g=0;g<f.requests.length;g++){var k=f.requests[g];k.piece===b&&c.pieces[b].cancel(k.offset/E.BLOCK_LENGTH|0)}return c.emit("hotswap",f,a,b),!0},e.prototype._request=function(a,b,d){function e(){c.nextTick(function(){h._update()})}var h=this,i=a.requests.length,j="webSeed"===a.type;if(h.bitfield.get(b))return!1;var k=j?Math.min(g(a,V,h.pieceLength),h.maxWebConns):f(a,V);if(i>=k)return!1;var l=h.pieces[b],m=j?l.reserveRemaining():l.reserve();if(-1===m&&d&&h._hotswap(a,b)&&(m=j?l.reserveRemaining():l.reserve()),-1===m)return!1;var n=h._reservations[b];n||(n=h._reservations[b]=[]);var o=n.indexOf(null);-1===o&&(o=n.length),n[o]=a;var p=l.chunkOffset(m),q=j?l.chunkLengthRemaining(m):l.chunkLength(m);return a.request(b,p,q,function r(c,d){if(!h.destroyed){if(!h.ready)return h.once("ready",function(){r(c,d)});if(n[o]===a&&(n[o]=null),l!==h.pieces[b])return e();if(c)return h._debug("error getting piece %s (offset: %s length: %s) from %s: %s",b,p,q,a.remoteAddress+":"+a.remotePort,c.message),j?l.cancelRemaining(m):l.cancel(m),void e();if(h._debug("got piece %s (offset: %s length: %s) from %s",b,p,q,a.remoteAddress+":"+a.remotePort),!l.set(m,d,a))return e();var f=l.flush();H(f,function(a){if(!h.destroyed){if(a===h._hashes[b]){if(!h.pieces[b])return;h._debug("piece verified %s",b),h.pieces[b]=null,h._reservations[b]=null,h.bitfield.set(b,!0),h.store.put(b,f),h.wires.forEach(function(a){a.have(b)}),h._checkDone()&&!h.destroyed&&h.discovery.complete()}else h.pieces[b]=new E(l.length),h.emit("warning",new Error("Piece "+b+" failed verification"));e()}})}}),!0},e.prototype._checkDone=function(){var a=this;if(!a.destroyed){a.files.forEach(function(b){if(!b.done){for(var c=b._startPiece;c<=b._endPiece;++c)if(!a.bitfield.get(c))return;b.done=!0,b.emit("done"),a._debug("file done: "+b.name)}});for(var b=!0,c=0;c<a._selections.length;c++){for(var d=a._selections[c],e=d.from;e<=d.to;e++)if(!a.bitfield.get(e)){b=!1;break}if(!b)break}return!a.done&&b&&(a.done=!0,a._debug("torrent done: "+a.infoHash),a.emit("done")),a._gcSelections(),b}},e.prototype.load=function(a,b){var c=this;if(c.destroyed)throw new Error("torrent is destroyed");if(!c.ready)return c.once("ready",function(){c.load(a,b)});Array.isArray(a)||(a=[a]),b||(b=i);var d=new x(a),e=new m(c.store,c.pieceLength);F(d,e,function(a){return a?b(a):(c.pieces.forEach(function(a,b){c.pieces[b]=null,c._reservations[b]=null,c.bitfield.set(b,!0)}),c._checkDone(),void b(null))})},e.prototype.createServer=function(a){if("function"!=typeof P)throw new Error("node.js-only method");if(this.destroyed)throw new Error("torrent is destroyed");var b=new P(this,a);return this._servers.push(b),b},e.prototype.pause=function(){this.destroyed||(this._debug("pause"),this.paused=!0)},e.prototype.resume=function(){this.destroyed||(this._debug("resume"),this.paused=!1,this._drain())},e.prototype._debug=function(){var a=[].slice.call(arguments);a[0]="["+this.client._debugId+"] ["+this._debugId+"] "+a[0],n.apply(null,a)},e.prototype._drain=function(){var a=this;if(this._debug("_drain numConns %s maxConns %s",a._numConns,a.client.maxConns),!("function"!=typeof y.connect||a.destroyed||a.paused||a._numConns>=a.client.maxConns)){this._debug("drain (%s queued, %s/%s peers)",a._numQueued,a.numPeers,a.client.maxConns);var b=a._queue.shift();if(b){this._debug("tcp connect attempt to %s",b.addr);var c=k(b.addr),d={host:c[0],port:c[1]},e=b.conn=y.connect(d);e.once("connect",function(){b.onConnect()}),e.once("error",function(a){b.destroy(a)}),b.startConnectTimeout(),e.on("close",function(){if(!a.destroyed){if(b.retries>=Z.length)return void a._debug("conn %s closed: will not re-add (max %s attempts)",b.addr,Z.length);var c=Z[b.retries];a._debug("conn %s closed: will re-add to queue in %sms (attempt %s)",b.addr,c,b.retries+1);var d=setTimeout(function(){var c=a._addPeer(b.addr);c&&(c.retries=b.retries+1)},c);d.unref&&d.unref()}})}}},e.prototype._validAddr=function(a){var b;try{b=k(a)}catch(c){return!1}var d=b[0],e=b[1];return e>0&&65535>e&&!("127.0.0.1"===d&&e===this.client.torrentPort)}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../package.json":241,"./file":225,"./peer":226,"./rarity-map":227,"./server":36,_process:141,"addr-to-ip-port":2,bitfield:8,"chunk-store-stream/write":52,debug:66,events:70,fs:37,"fs-chunk-store":105,"immediate-chunk-store":86,inherits:87,multistream:123,net:36,os:36,"parse-torrent":137,path:138,pump:231,"random-iterate":146,"run-parallel":162,"run-parallel-limit":161,"simple-get":166,"simple-sha1":178,speedometer:190,"torrent-discovery":210,"torrent-piece":211,uniq:214,ut_metadata:218,ut_pex:36,xtend:243,"xtend/mutable":244}],229:[function(a,b,c){function d(a,b){k.call(this),this.url=a,this.webPeerId=j.sync(a),this._torrent=b,this._init()}b.exports=d;var e=a("bitfield"),f=a("safe-buffer").Buffer,g=a("debug")("webtorrent:webconn"),h=a("simple-get"),i=a("inherits"),j=a("simple-sha1"),k=a("bittorrent-protocol"),l=a("../package.json").version;i(d,k),d.prototype._init=function(){var a=this;a.setKeepAlive(!0),a.once("handshake",function(b,c){if(!a.destroyed){a.handshake(b,a.webPeerId);for(var d=a._torrent.pieces.length,f=new e(d),g=0;d>=g;g++)f.set(g,!0);a.bitfield(f)}}),a.once("interested",function(){g("interested"),a.unchoke()}),a.on("uninterested",function(){g("uninterested")}),a.on("choke",function(){g("choke")}),a.on("unchoke",function(){g("unchoke")}),a.on("bitfield",function(){g("bitfield")}),a.on("request",function(b,c,d,e){g("request pieceIndex=%d offset=%d length=%d",b,c,d),a.httpRequest(b,c,d,e)})},d.prototype.httpRequest=function(a,b,c,d){var e,i=this,j=a*i._torrent.pieceLength,k=j+b,m=k+c-1,n=i._torrent.files;if(n.length<=1)e=[{url:i.url,start:k,end:m}];else{var o=n.filter(function(a){return a.offset<=m&&a.offset+a.length>k});if(o.length<1)return d(new Error("Could not find file corresponnding to web seed range request"));e=o.map(function(a){var b=a.offset+a.length-1,c=i.url+("/"===i.url[i.url.length-1]?"":"/")+a.path;return{url:c,fileOffsetInRange:Math.max(a.offset-k,0),start:Math.max(k-a.offset,0),end:Math.min(b,m-a.offset)}})}var p,q=0,r=!1;e.length>1&&(p=f.alloc(c)),e.forEach(function(f){function i(a,b){return a.statusCode<200||a.statusCode>=300?(r=!0,d(new Error("Unexpected HTTP status code "+a.statusCode))):(g("Got data of length %d",b.length),void(1===e.length?d(null,b):(b.copy(p,f.fileOffsetInRange),++q===e.length&&d(null,p))))}var j=f.url,k=f.start,m=f.end;g("Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d",j,a,b,c,k,m);var n={url:j,method:"GET",headers:{"user-agent":"WebTorrent/"+l+" (https://webtorrent.io)",range:"bytes="+k+"-"+m}};h.concat(n,function(a,b,c){return r?void 0:a?"undefined"==typeof window||j.startsWith(window.location.origin+"/")?(r=!0,d(a)):h.head(j,function(b,c){if(!r){if(b)return r=!0,d(b);if(c.statusCode<200||c.statusCode>=300)return r=!0,d(new Error("Unexpected HTTP status code "+c.statusCode));if(c.url===j)return r=!0,d(a);n.url=c.url,h.concat(n,function(a,b,c){return r?void 0:a?(r=!0,d(a)):void i(b,c)})}}):void i(b,c)})})},d.prototype.destroy=function(){k.prototype.destroy.call(this),this._torrent=null}},{"../package.json":241,bitfield:8,"bittorrent-protocol":9,debug:66,inherits:87,"safe-buffer":164,"simple-get":166,"simple-sha1":178}],230:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{dup:10}],231:[function(a,b,c){arguments[4][221][0].apply(c,arguments)},{dup:221,"end-of-stream":69,fs:36,once:135}],232:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"./_stream_readable":234,"./_stream_writable":236,"core-util-is":54,dup:11,inherits:87,"process-nextick-args":140}],233:[function(a,b,c){arguments[4][12][0].apply(c,arguments)},{"./_stream_transform":235,"core-util-is":54,dup:12,inherits:87}],234:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{"./_stream_duplex":232,"./internal/streams/BufferList":237,"./internal/streams/stream":238,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:13,events:70,inherits:87,isarray:230,"process-nextick-args":140,"string_decoder/":240,util:36}],235:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"./_stream_duplex":232,"core-util-is":54,dup:14,inherits:87}],236:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"./_stream_duplex":232,"./internal/streams/stream":238,_process:141,buffer:39,"buffer-shims":38,"core-util-is":54,dup:15,inherits:87,"process-nextick-args":140,"util-deprecate":219}],237:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:16}],238:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{dup:17,events:70}],239:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{"./lib/_stream_duplex.js":232,"./lib/_stream_passthrough.js":233,"./lib/_stream_readable.js":234,"./lib/_stream_transform.js":235,"./lib/_stream_writable.js":236,dup:18}],240:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{buffer:39,"buffer-shims":38,dup:19}],241:[function(a,b,c){b.exports={version:"0.98.18"}},{}],242:[function(a,b,c){function d(a,b){function c(){for(var b=new Array(arguments.length),c=0;c<b.length;c++)b[c]=arguments[c];var d=a.apply(this,b),e=b[b.length-1];return"function"==typeof d&&d!==e&&Object.keys(e).forEach(function(a){d[a]=e[a]}),d}if(a&&b)return d(a)(b);if("function"!=typeof a)throw new TypeError("need wrapper function");return Object.keys(a).forEach(function(b){c[b]=a[b]}),c}b.exports=d},{}],243:[function(a,b,c){function d(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];for(var d in c)e.call(c,d)&&(a[d]=c[d])}return a}b.exports=d;var e=Object.prototype.hasOwnProperty},{}],244:[function(a,b,c){function d(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)e.call(c,d)&&(a[d]=c[d])}return a}b.exports=d;var e=Object.prototype.hasOwnProperty},{}],245:[function(a,b,c){b.exports=function d(a,b,c){return void 0===b?function(b,c){return d(a,b,c)}:(void 0===c&&(c="0"),a-=b.toString().length,a>0?new Array(a+(/\./.test(b)?2:1)).join(c)+b:b+"")}},{}]},{},[1]);var authServices=angular.module("AuthServices",["ngResource"]);authServices.config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]),authServices.factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS","UserService",function(a,b,c,d){return{request:function(a){var b=d.getCurrentUser(),c=b?b.auth:null;return c&&(a.headers.authorization=c),a},responseError:function(d){return a.$broadcast({401:c.notAuthenticated,403:c.notAuthorized,419:c.sessionTimeout,440:c.sessionTimeout}[d.status],d),b.reject(d)}}}]),authServices.factory("AuthService",["$http","UserService","localStorageService","ENDPOINT_URI",function(a,b,c,d){var e={};return e.login=function(c){return a.post(d+"login",c).then(function(a){return b.setCurrentUser(a.data)})},e.isAuthenticated=function(){return!!b.getCurrentUser()},e.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),e.isAuthenticated()&&-1!==a.indexOf(b.getCurrentUser().role)},e.logout=function(){return b.deleteCurrentUser()},e.init=function(){return b.getCurrentUser()},e}]),authServices.service("UserService",["localStorageService",function(a){var b=this,c=null;b.deleteCurrentUser=function(){return c=null,a.remove("user"),c},b.setCurrentUser=function(b){return c=b,a.set("user",b),c},b.getCurrentUser=function(){return c||(c=a.get("user")),c}}]);var resources=angular.module("Resources",["ngResource"]);resources.factory("DhtFactory",["$resource","ENDPOINT_URI",function(a,b){return a(b+"dht/:dhtId",{dhtId:"@_id"},{get:{method:"GET",headers:{"Cache-Control":"no-cache"}},update:{method:"PUT"}})}]),resources.factory("UsersFactory",["$resource","ENDPOINT_URI",function(a,b){return a(b+"users")}]),resources.factory("ConversationsFactory",["$resource","ENDPOINT_URI",function(a,b){return a(b+'conversations?embedded={"user_id":1}')}]);var services=angular.module("Services",[]);services.factory("MessagesFactory",["$localForage","$q","lodash",function(a,b,c){function d(a){for(var b=0,c=a.length;c>b;b++)a[b]=[]}function e(){d(i.my),d(i.control),i.other.splice(0),i.otherControl.splice(0)}function f(a,b){return Math.log(b)/Math.log(a)}function g(a,b,c,d){if("control"===c.type&&a===c.sender){var e=i.getLevelFromLength(c.content.infoHashes.length);i.control[e].push({infoHash:b,message:c})}else"control"===c.type?i.otherControl.push({infoHash:b,message:c}):a===c.sender?(d=d||0,i.my[d].push({infoHash:b,message:c})):i.other.push({infoHash:b,message:c})}const h=5;var i={};return i.my=[[],[],[],[],[],[],[]],i.control=[[],[],[],[],[],[],[]],i.other=[],i.otherControl=[],i.getLevelFromLength=function(a){return Math.floor(f(h,a))},i.numberOfMessagesForLevel=function(a){return Math.pow(h,a+1)},i.init=function(c){return e(),b(function(b){a.iterate(function(a,b){g(c,b,a)}).then(function(){b()})})},i.add=function(b,c,d,e){g(d,b,c,e),a.setItem(b,c)},i.moveLevelUp=function(a){i.my[a+1]=c.concat(i.my[a+1],i.my[a]),i.my[a]=[]},i.removeControlMessagesFromLevel=function(b){a.removeItem(c.map(i.control[b],"infoHash")),i.control[b]=[]},i.removeControlMessagesByInfoHash=function(b){function d(a,b){return a.infoHash===b}c.pullAllWith(i.otherControl,b,d),c.forEach(i.control,function(a){c.pullAllWith(a,b,d)}),a.removeItem(b)},i.getMessagesByInfoHash=function(a,b,d){d=d||0;var e=c.filter(a[d],function(a){return c.includes(b,a.infoHash)});return e},i.changeLevelForMessages=function(a,b,d,e){c.pullAll(a[b],e),a[d]=c.concat(a[d],e)},i.getAll=function(){return c.concat(c.flatten(i.my),i.other)},i.getMessagesAndControl=function(){return c.concat(c.flatten(i.my),c.flatten(i.control),i.other,i.otherControl)},i.clearAll=function(){return b(function(b){a.clear().then(function(){b()})})},i}]),angular.module("webtorrentClientApp").controller("MainCtrl",["$scope","$rootScope","USER_ROLES","AUTH_EVENTS","AuthService","UserService","$location","TorrentFactory",function(a,b,c,d,e,f,g,h){a.currentUser={},a.isAuthenticated=function(){return e.isAuthenticated()};var i=function(){a.currentUser=f.getCurrentUser()};b.$on(d.loginSuccess,function(){a.currentUser=f.getCurrentUser()}),b.$on(d.notAuthenticated,function(){a.currentUser=f.deleteCurrentUser(),g.path("/login")}),a.logoutClick=function(){a.currentUser=e.logout(),h.exit(),g.path("/")},i()}]),angular.module("webtorrentClientApp").controller("AboutCtrl",function(){}),angular.module("webtorrentClientApp").controller("LoginCtrl",["$scope","$rootScope","AUTH_EVENTS","AuthService","UserService","$location",function(a,b,c,d,e,f){a.credentialsInput={},a.usernames=["moz","chrome","oper","h1","h2","h3","h4","test1","test2","test3"];var g="@wp.pl",h="password";a.fillCredentials=function(b){a.credentialsInput.email=b+g,a.credentialsInput.password=h},a.login=function(a){d.login(a).then(function(){b.$broadcast(c.loginSuccess),f.path("/messenger")},function(){b.$broadcast(c.loginFailed)})}}]),function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){angular.module("webtorrentClientApp").controller("MessengerCtrl",["$scope","$interval","$window","DhtFactory","UsersFactory","ConversationsFactory","MessagesFactory","TorrentFactory","lodash","UserService",function(a,b,c,d,e,f,g,h,i,j){function k(a){d.save({},{infohash:"new"}).$promise.then(function(b){var c={conversation_id:a,user_id:j.getCurrentUser().id,user_dht_id:b._id};f.save({},c,function(){p()})})}const l=2e3;var m=function(){a.my=g.my,a.con=g.control,a.otherControl=g.otherControl,a.ot=g.other,a.conversationIdInput="",a.textInput="",a.dhtIdsInConversations={},a.getConversation=g.getAll,a.getTorrents=h.getAllTorrents,a.getLastInfoHashes=h.getLastInfoHashes,a.myConversations=[],a.currentConversationId=0,a.friendsInConversations={},a.myDhtId=""},n=function(b){f.get({where:{conversation_id:b}},function(c){var d=b;a.friendsInConversations[d]=i.map(c._items,function(a){return{user_dht_id:a.user_dht_id,username:a.user_id.username}}),a.dhtIdsInConversations[d]=i.map(c._items,"user_dht_id")})},o=function(){f.get({where:{user_id:j.getCurrentUser().id}},function(b){b._items.length>0&&(a.myConversations=b._items,a.currentConversationId=a.myConversations[0].conversation_id,a.myDhtId=a.myConversations[0].user_dht_id,i.forEach(a.myConversations,function(a){n(a.conversation_id)}),h.init(a.myDhtId))})},p=function(){m(),o()};a.checkMessages=function(){h.checkMessages(a.dhtIdsInConversations)},a.sendMessage=function(){h.sendMessage(a.textInput),a.textInput=""},a.joinConversation=function(){a.conversationIdInput&&""!==a.conversationIdInput&&k(a.conversationIdInput)},a.createNewConversation=function(){k("dummy")},a.clearStorageAndRefresh=function(){g.clearAll().then(function(){c.location.reload()})},a.truncate=function(a,b){return b=b||9,i.truncate(a,{length:b})};var q=b(function(){a.checkMessages()},l),r=b(function(){n(a.currentConversationId)},6e4),s=b(function(){},1e3);a.$on("$destroy",function(){b.cancel(r),r=void 0,b.cancel(q),q=void 0,b.cancel(s),s=void 0}),a.copySuccess=function(){console.log("Copied!")},a.copyFail=function(a){console.error("Error!",a)},p()}])},{}]},{},[1]),angular.module("webtorrentClientApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/login.html",'<div class="container login-container"> <div ng-show="error" class="alert alert-danger"> <p>{{error}}</p> </div> <form class="form-signin" ng-submit="login(credentialsInput)"> <h2 class="form-signin-heading">Please sign in</h2> <label for="inputEmail" class="sr-only">Email address</label> <input ng-model="credentialsInput.email" id="inputEmail" class="form-control" placeholder="Email address" required autofocus> <label for="inputPassword" class="sr-only">Password</label> <input ng-model="credentialsInput.password" type="password" id="inputPassword" class="form-control" placeholder="Password" required> <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button> </form> <span ng-repeat="username in usernames"> <button class="btn btn-secondary" ng-click="fillCredentials(username)">{{username}}</button> </span> </div> <!-- /container -->'),a.put("views/main.html","<p>main</p>"),a.put("views/messenger.html",'<div class="wrap"> <aside> <div class="container" scroll-glue> <div ng-show="currentConversationId"> <p>conversation ID:</p> <form class="send-message-form" role="form"> <div class="input-group"> <input type="text" ng-model="currentConversationId" class="form-control"> <span class="input-group-btn"> <button class="btn btn-secondary" clipboard supported="supported" text="currentConversationId" on-copied="copySuccess()" on-error="copyFail(err)">Copy</button> </span> </div> </form> <p>friends in conversation:</p> <ol ng-repeat="friendsList in friendsInConversations"> <li ng-repeat="item in friendsList"> {{item.username}} {{item.user_dht_id}} </li> </ol> </div> <div ng-hide="currentConversationId"> <form> <input id="conversationIdInput" ng-model="conversationIdInput" type="text" class="form-control" autocomplete="off" placeholder="conversation ID"> <button class="btn btn-secondary" ng-click="joinConversation()">Join</button> <button class="btn btn-secondary" ng-click="createNewConversation()">Create new</button> </form> </div> <!--myConversations<br>--> <!--{{myConversations}}--> <!--<br><br>--> <!--conversationsDhts<br>--> <!--{{dhtIdsInConversations}}--> <!--<br><br>--> <!--friendsInConversations<br>--> <!--{{friendsInConversations[currentConversationId]}}--> <!--<br><br>--> <button class="btn btn-secondary" ng-click="checkMessages()">check</button> <button class="btn btn-secondary" ng-click="clearStorageAndRefresh()">clear&refresh</button> <br> <table class="table"> <tr> <th>m</th> <td ng-repeat="m in my">{{m.length}}</td> </tr> <tr> <th>ctrl</th> <td ng-repeat="m in con">{{m.length}}</td> </tr> <tr> <th>ot</th> <td>{{ot.length}}</td> </tr> <tr> <th>otCtrl</th> <td>{{otherControl.length}}</td> </tr> </table> <!--<ul ng-repeat="m in otherControl">--> <!--<li>{{m.length}}</li>--> <!--</ul>--> <!--ot--> <!--<ul ng-repeat="m in ot">--> <!--<li>{{m.length}}</li>--> <!--</ul>--> <p>torrents {{getTorrents().length}}</p> <ol> <li ng-repeat="torrent in getTorrents() | orderBy:\'infoHash\'"> <span class="color-block" ng-style="{\'background-color\':\'#\'+torrent.infoHash.substring(0,6)}">&nbsp</span> {{truncate(torrent.infoHash)}} prs: {{torrent.numPeers}} </li> </ol> <p>last infoHashes {{getLastInfoHashes().length}}</p> <ol> <li ng-repeat="ih in getLastInfoHashes() | orderBy:\'infohash\'"> <span class="color-block" ng-style="{\'background-color\':\'#\'+ih.infohash.substring(0,6)}">&nbsp</span> {{truncate(ih.infohash)}} </li> </ol> </div> </aside> <article> <section class="conversation" scroll-glue> <section class="module"> <!--todo wiadomość jako component--> <ol class="discussion"> <li ng-repeat="item in getConversation() | orderBy:\'message.timestamp\'" ng-class="myDhtId===item.message.sender ? \'self\' : \'other\'"> <div class="avatar"> <img ng-src="images/avatar.20e7fec0.gif"> </div> <div class="messages"> <div> <span>{{$index + 1}}&nbsp;&nbsp;&nbsp;</span> <span class="message-content" id="message{{$index}}">{{item.message.content}}</span> </div> <time ng-repeat="sentBy in friendsInConversations[currentConversationId] | filter:item.message.sender">{{sentBy.username}} • {{item.message.timestamp | date:\'H:mm:ss\'}}</time><br> <time> <span class="color-block" ng-style="{\'background-color\':\'#\'+item.infoHash.substring(0,6)}">&nbsp</span> {{truncate(item.infoHash)}} • <span class="color-block" ng-style="{\'background-color\':\'#\'+item.message.previousInfoHash.substring(0,6)}">&nbsp</span> {{truncate(item.message.previousInfoHash)}} </time> </div> </li> </ol> </section> </section> <div class="bottom-input"> <div> <form class="send-message-form" role="form" ng-submit="sendMessage()"> <div class="input-group"> <input ng-model="textInput" type="text" class="form-control" id="inputMessage" placeholder="Type message..." autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-secondary" type="submit">Send!</button> </span> </div> </form> </div> </div> </article> </div>');
}]);